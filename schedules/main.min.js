var config={notes:"App assumes that there are either MonToFri or MonToSat schedules.\nApp assumes that courses are: 2x1 hour blocks, 2x90 minute blocks, 2 hour blocks, 3 hour blocks or 1 hour clinics.\nApp assumes all courses start on the hour.",uriTypes:{csv:"data:text/csv;charset=utf-8,%EF%BB%BF",json:"data:application/json;charset=utf-8",txt:"data:text/plain;charset=utf-8"},maxHrsPerDay:4,maxHours:12,uiTimeInputStartHr:9,uiScheduleNumOfHrsPerDay:9,courseNameNumLength:4,csvStr:{courseCat:"교과목명",courseNum:"수강 번호",courseTime:"시간",courseRm:"강의실",courseTchr:"강사명",oldNum:"수강 번호1",newNum:"수강 번호2"},alphabet:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],monToSatKr:["월","화","수","목","금","토"],monToSatEn:["M","T","W","Th","F","S"],pdfBlankHr:"7:50-8:40",pdfCourseColors:["","blue","crimson","green","purple","darkorange"],scheduleRowPixelHeight:18},stats={},courseData={},scheduleData={},csvStrings={courseCat:config.csvStr.courseCat,courseNum:config.csvStr.courseNum,courseTime:config.csvStr.courseTime,courseRm:config.csvStr.courseRm,courseTchr:config.csvStr.courseTchr,oldNum:config.csvStr.oldNum,newNum:config.csvStr.newNum};function docElId(elId){return document.getElementById(elId)}function templateStats(){stats={catData:[],indexData:{courses:[],schedules:[],klinics:[],depts:[]},settings:{deptGrps:[],deptGrpsSetBy:"day",maxHours:config.maxHours,maxHrsPerDay:config.maxHrsPerDay,maxSeqHrs:3,overrides:{maxHours:!1,maxHrsPerDay:!1,maxSeqHrs:!1,deptGrps:!0,multiCats:!1}},teachers:[],tempCparam:"",tempKlinic:{kbtn:"",isHeld:!1},lastSearchItem:""}}function isObjEmpty(obj){return null===obj||"object"!=typeof obj||0===Object.keys(obj).length}function emptyContent(parentEl){for(;parentEl.hasChildNodes();){for(;parentEl.lastChild.hasChildNodes();)parentEl.lastChild.removeChild(parentEl.lastChild.lastChild);parentEl.removeChild(parentEl.lastChild)}}function uniqueValues(arr){for(var j,filtered=[],len=arr.length,i=0;i<len;i++){for(j=i+1;j<len;j++)arr[i]===arr[j]&&(j=++i);filtered.push(arr[i])}return filtered}function uniqueObjs(arrayOfObjs,propString){for(var j,filtered=[],len=arrayOfObjs.length,i=0;i<len;i++){for(j=i+1;j<len;j++)arrayOfObjs[i][propString].toLowerCase()===arrayOfObjs[j][propString].toLowerCase()&&(j=++i);filtered.push(arrayOfObjs[i])}return filtered}function uniqueArrOfObjs(arrayOfObjs,propString){for(var j,filtered=[],len=arrayOfObjs.length,i=0;i<len;i++){for(j=i+1;j<len;j++)arrayOfObjs[i][propString]===arrayOfObjs[j][propString]&&(j=++i);filtered.push(arrayOfObjs[i])}return filtered}function objKeyFromPropVal(val,obj){for(var key in obj)if(obj[key].name===val)return key;return!1}function deptsToObj(str){return{shortcode:str,description:""}}function getUniqueDepartments(){for(var statsRef,everyDepartment=[],uniqueDepts=[],len=stats.indexData.courses.length,i=0;i<len;i++)statsRef=stats.indexData.courses[i],everyDepartment.push(courseData[statsRef].dept);for(everyDepartment.sort(),everyDepartment=uniqueValues(everyDepartment),i=0;i<everyDepartment.length;i++)uniqueDepts.push(deptsToObj(everyDepartment[i]));return uniqueDepts}function setDefaultCsvString(propName){return config.csvStr[propName]}function updateCsvString(elId){var str=cleanMultiWsWithSingleWs(cleanDngrChars(docElId(elId).value)),propName=findCsvStringFromMap(elId);void 0!==propName&&str.length?csvStrings[propName]=str:csvStrings[propName]=setDefaultCsvString(propName),docElId(elId).placeholder=csvStrings[propName],docElId(elId).value=csvStrings[propName]}function deptGroupIndex(courseDept){for(var arr,grps=[],len=stats.settings.deptGrps.length,i=0;i<len;i++)-1!==(arr=stats.settings.deptGrps[i]).indexOf(courseDept)&&grps.push(arr);return grps}function findcRefByCourseName(inputValue){for(var cRef,statsRef,len=stats.indexData.courses.length,i=0;i<len;i++)if(statsRef=stats.indexData.courses[i],courseData[statsRef].name===inputValue){cRef=statsRef;break}return cRef}function findCsvStringFromMap(elId){return{strHdr1:"courseCat",strHdr2:"courseRm",strHdr3:"courseTime",strHdr4:"courseNum",strHdr5:"oldNum",strHdr6:"newNum"}[elId]}function getMaxHrsFromUser(){var maxHrsSched=Number(docElId("hrsPerSchedule").value),maxHrsDay=Number(docElId("hrsPerDay").value);1<=maxHrsSched&&maxHrsSched<=5*config.uiScheduleNumOfHrsPerDay&&(stats.settings.maxHours=maxHrsSched),1<=maxHrsDay&&maxHrsDay<=config.uiScheduleNumOfHrsPerDay&&(stats.settings.maxHrsPerDay=maxHrsDay)}function maxSeqHrstwo(){stats.settings.maxSeqHrs=2}function maxSeqHrsthree(){stats.settings.maxSeqHrs=3}function deptGrpsDaily(){stats.settings.deptGrpsSetBy="day"}function deptGrpsWeekly(){stats.settings.deptGrpsSetBy="week"}function multiCatsYes(){stats.settings.overrides.multiCats=!0}function multiCatsNo(){stats.settings.overrides.multiCats=!1}function cleanDngrChars(str){return str.replace(/[,=<>$/'"&\t]/g,"")}function cleanDngrCharsAndWs(str){return str.replace(/[,=<>$/'"&\t\s]/g,"")}function cleanKrCharsOnly(str){return str.replace(/[^\u3130-\u318F\uAC00-\uD7AF]/gim,"")}function cleanNameCharsOnly(str){return str.replace(/[^a-zA-Z\-\u3130-\u318F\uAC00-\uD7AF\s]/gim,"")}function cleanTrimTrailingWs(str){return str.replace(/[\s\t]+$/,"")}function cleanRemoveKrChars(str){return str.replace(/[\u3130-\u318F\uAC00-\uD7AF]/g,"")}function cleanRemoveAllWs(str){return str.replace(/\s/g,"")}function cleanAlphaNumericAndDashOnlyChars(str){return str.replace(/[^a-zA-Z0-9\-]/gim,"")}function cleanClssLstRemove(clsNmes,rmvStr){rmvStr=new RegExp("(?:^|\\s)"+rmvStr+"(?!\\S)","g");return clsNmes.replace(rmvStr,"")}function cleanMultiWsWithSingleWs(str){return str.replace(/\s+/g," ")}function cleanNumCharsOnly(str){return str.replace(/[^0-9]/g,"")}function cleanWsReturnUnderscores(str){return str.replace(/\s/g,"_")}function regExChkInputReturnColorStr(val,rgxStr){var color="";return color=new RegExp(rgxStr,"g").test(val)?color:"#d62c1a"}function buildDefaultScheduleUiArr(val){val=new Array(config.uiScheduleNumOfHrsPerDay).fill(val);return JSON.parse(JSON.stringify(new Array(6).fill(val)))}function exitParsingScreen(){removeLoadListeners(),initMainUiListeners()}function fromScratch(){getConfigFromParsingScreen(),templateStats(),loadStateFromData(!1),exitParsingScreen()}function collisionChk(sParam,cParam,pos){sParam=courseData[scheduleData[sParam].cRef[pos]],pos=courseData[cParam];return!(sParam.dayhr[0].identical(pos.dayhr[0])||sParam.dayhr[1].identical(pos.dayhr[1])||sParam.dayhr[1].identical(pos.dayhr[0])||sParam.dayhr[0].identical(pos.dayhr[1]))}function thirdHrCollisionChk(sParam,cParam,pos){sParam=courseData[scheduleData[sParam].cRef[pos]],pos=courseData[cParam],cParam=[];if("threehour"===pos.duration){if(cParam.push(pos.dayhr[0][0]),cParam.push(pos.dayhr[0][1]+1),sParam.dayhr[0].identical(cParam)||sParam.dayhr[1].identical(cParam))return!1}else if(cParam.push(sParam.dayhr[0][0]),cParam.push(sParam.dayhr[0][1]+1),"threehour"===sParam.duration&&(pos.dayhr[0].identical(cParam)||pos.dayhr[1].identical(cParam)))return!1;return!0}function allowFollowException(sParam,cParam,pos){for(var posRef=courseData[scheduleData[sParam].cRef[pos]],cObjRef=courseData[cParam],targetFollow=[[cObjRef.dayhr[0][0],cObjRef.dayhr[0][1]+1],[cObjRef.dayhr[1][0],cObjRef.dayhr[1][1]+1]],cRefFollow=[[posRef.dayhr[0][0],posRef.dayhr[0][1]+1],[posRef.dayhr[1][0],posRef.dayhr[1][1]+1]],i=0;i<2;i++){if(targetFollow[i].identical(posRef.dayhr[0]))return!0===cObjRef.allowFollow[i]&&!1===posRef.allowFollow[0];if(targetFollow[i].identical(posRef.dayhr[1]))return!0===cObjRef.allowFollow[i]&&!1===posRef.allowFollow[1];if(cRefFollow[i].identical(cObjRef.dayhr[0]))return!0===posRef.allowFollow[i]&&!1===cObjRef.allowFollow[0];if(cRefFollow[i].identical(cObjRef.dayhr[1]))return!0===posRef.allowFollow[i]&&!1===cObjRef.allowFollow[1]}return!0}function allowFollowChk(sParam,cParam,pos){var posRef=courseData[scheduleData[sParam].cRef[pos]],cObjRef=courseData[cParam];return cObjRef.hasOwnProperty("allowFollow")?posRef.hasOwnProperty("allowFollow")?allowFollowException(sParam,cParam,pos):!((sParam=[[cObjRef.dayhr[0][0],cObjRef.dayhr[0][1]+1],[cObjRef.dayhr[1][0],cObjRef.dayhr[1][1]+1]])[0].identical(posRef.dayhr[0])||sParam[1].identical(posRef.dayhr[1])||sParam[1].identical(posRef.dayhr[0])||sParam[0].identical(posRef.dayhr[1])):!(posRef.hasOwnProperty("allowFollow")&&(cParam=[[posRef.dayhr[0][0],posRef.dayhr[0][1]+1],[posRef.dayhr[1][0],posRef.dayhr[1][1]+1]],cObjRef.dayhr[0].identical(cParam[0])||cObjRef.dayhr[1].identical(cParam[1])||cObjRef.dayhr[1].identical(cParam[0])||cObjRef.dayhr[0].identical(cParam[1])))}function notAssignedChk(cParam){return""===courseData[cParam].assgn}function dayOffChk(sParam,cParam){return courseData[cParam].dayhr[0][0]!==scheduleData[sParam].dayOff&&courseData[cParam].dayhr[1][0]!==scheduleData[sParam].dayOff}function calculateHrsForMaxHrsChk(sParam){for(var cObjRef,countedHrs=0,len=scheduleData[sParam].cRef.length,i=0;i<len;i++)"CLINIC"!==(cObjRef=courseData[scheduleData[sParam].cRef[i]]).cat&&("ninety"===cObjRef.duration||"threehour"===cObjRef.duration?countedHrs+=1.5:countedHrs+=1);return 2*countedHrs}function maxHrsChk(sParam,cParam){var maxLimit=Number(stats.settings.maxHours),toBeAssgnd=2;return!0===stats.settings.overrides.maxHours||"CLINIC"===courseData[cParam].cat||("ninety"!==courseData[cParam].duration&&"threehour"!==courseData[cParam].duration||(toBeAssgnd=3),calculateHrsForMaxHrsChk(sParam)+toBeAssgnd<=maxLimit)}function canAssignHereChk(sParam,cParam){return-1===scheduleData[sParam].cRef.indexOf(cParam)}function tooManyHrs(elem){return elem>Number(stats.settings.maxHrsPerDay)}function maxHoursInOneDay(sParam,cParam){var daySumHrs,cObjRef,sArr,dy0,dy1,dyA,dyB,i;if(!0===stats.settings.overrides.maxHrsPerDay)return!0;if("CLINIC"===courseData[cParam].cat)return!0;for(daySumHrs=[0,0,0,0,0,0],sArr=scheduleData[sParam].cRef,dy0=courseData[cParam].dayhr[0][0],dy1=courseData[cParam].dayhr[1][0],i=0;i<sArr.length;i++)"CLINIC"!==(cObjRef=courseData[sArr[i]]).cat&&(dyA=cObjRef.dayhr[0][0],dyB=cObjRef.dayhr[1][0],dy0===dyA||dy0===dyB||dy1===dyA||dy1===dyB)&&(daySumHrs[dyA]+=1,daySumHrs[dyB]+=1,"threehour"===cObjRef.duration)&&(daySumHrs[dyA]+=1);return daySumHrs[dy0]+=1,daySumHrs[dy1]+=1,"threehour"===cObjRef.duration&&(daySumHrs[dy0]+=1),!daySumHrs.some(tooManyHrs)}function chkSequence(hrsSequence,is2or3Hr,is3Hr){var hrsRef,i,ii,allowSeq=!0,len=hrsSequence.length;if(2===stats.settings.maxSeqHrs)if(is3Hr){for(i=0;i<len;i++)for(hrsRef=hrsSequence[i],ii=0;ii<hrsRef.length-2;ii++)if(1===hrsRef[ii]&&hrsRef[ii]===hrsRef[ii+1]&&hrsRef[ii+1]===hrsRef[ii+2]&&hrsRef[ii+2]===hrsRef[ii+3]){allowSeq=!1;break}}else for(i=0;i<len;i++)for(hrsRef=hrsSequence[i],ii=0;ii<hrsRef.length-1;ii++)if(1===hrsRef[ii]&&hrsRef[ii]===hrsRef[ii+1]&&hrsRef[ii+1]===hrsRef[ii+2]){allowSeq=!1;break}if(3===stats.settings.maxSeqHrs)if(is2or3Hr){for(i=0;i<len;i++)for(hrsRef=hrsSequence[i],ii=0;ii<hrsRef.length-3;ii++)if(1===hrsRef[ii]&&hrsRef[ii]===hrsRef[ii+1]&&hrsRef[ii+1]===hrsRef[ii+2]&&hrsRef[ii+2]===hrsRef[ii+3]&&hrsRef[ii+3]===hrsRef[ii+4]){allowSeq=!1;break}}else for(i=0;i<len;i++)for(hrsRef=hrsSequence[i],ii=0;ii<hrsRef.length-2;ii++)if(1===hrsRef[ii]&&hrsRef[ii]===hrsRef[ii+1]&&hrsRef[ii+1]===hrsRef[ii+2]&&hrsRef[ii+2]===hrsRef[ii+3]){allowSeq=!1;break}return allowSeq}function sequentialHrsChk(sParam,cParam){var cObjRef,dy0,dy1,hr0,dyA,dyB,hrA,hrB,i,hrsSequence=buildDefaultScheduleUiArr(0),is2or3Hr=!1,is3Hr=!1;if(!0===stats.settings.overrides.maxSeqHrs)return!0;if("CLINIC"===courseData[cParam].cat)return!0;for(dy0=courseData[cParam].dayhr[0][0],dy1=courseData[cParam].dayhr[1][0],hr0=courseData[cParam].dayhr[0][1],cParam=courseData[cParam].dayhr[1][1],i=0;i<scheduleData[sParam].cRef.length;i++)"CLINIC"!==(cObjRef=courseData[scheduleData[sParam].cRef[i]]).cat&&(dyA=cObjRef.dayhr[0][0],dyB=cObjRef.dayhr[1][0],hrA=cObjRef.dayhr[0][1],hrB=cObjRef.dayhr[1][1],dy0===dyA||dy0===dyB||dy1===dyA||dy1===dyB)&&(hrsSequence[dyA][hrA]+=1,hrsSequence[dyB][hrB]+=1,"threehour"===cObjRef.duration)&&(hrsSequence[dyA][hrA+1]+=1);return hrsSequence[dy0][hr0]+=1,hrsSequence[dy1][cParam]+=1,"twohour"===cObjRef.duration&&(is2or3Hr=!0),"threehour"===cObjRef.duration&&(hrsSequence[dy0][hr0+1]+=1,is3Hr=is2or3Hr=!0),chkSequence(hrsSequence,is2or3Hr,is3Hr)}function chkNoSatCollision(sParam,cParam){cParam=courseData[cParam];return!!scheduleData[sParam].hasOwnProperty("isSat")||5!==cParam.dayhr[0][0]&&5!==cParam.dayhr[1][0]&&!scheduleData[sParam].hasOwnProperty("isSat")}function allowDeptGroup(sParam,cParam){var deptGrpsWithTargetDept,theseAssgndDepts,cObjRef,sObjLen,count,dy0,dy1,dyA,dyB,i,ii;if(!stats.settings.deptGrps.length)return!0;if(!0===stats.settings.overrides.deptGrps)return!0;if("CLINIC"===courseData[cParam].cat)return!0;for(deptGrpsWithTargetDept=deptGroupIndex(courseData[cParam].dept),theseAssgndDepts=[],sObjLen=scheduleData[sParam].cRef.length,i=0;i<sObjLen;i++)"CLINIC"!==(cObjRef=courseData[scheduleData[sParam].cRef[i]]).cat&&("week"===stats.settings.deptGrpsSetBy&&theseAssgndDepts.push(cObjRef.dept),"day"===stats.settings.deptGrpsSetBy)&&(dy0=cObjRef.dayhr[0][0],dy1=cObjRef.dayhr[1][0],dyA=courseData[cParam].dayhr[0][0],dyB=courseData[cParam].dayhr[1][0],dy0!==dyA&&dy0!==dyB&&dy1!==dyA&&dy1!==dyB||theseAssgndDepts.push(cObjRef.dept));for(theseAssgndDepts.push(courseData[cParam].dept),uniqueValues(theseAssgndDepts),i=0;i<deptGrpsWithTargetDept.length;i++){for(ii=count=0;ii<theseAssgndDepts.length;ii++)deptGrpsWithTargetDept[i].includes(theseAssgndDepts[ii])&&count++;if(count===theseAssgndDepts.length)return!0}return!1}function atomicMakeAssignment(schedule,course){scheduleData[schedule].cRef.push(course),courseData[course].assgn=schedule}function atomicRemoveAssignment(schedule,course){courseData[course].assgn="",scheduleData[schedule].cRef.splice(scheduleData[schedule].cRef.indexOf(course),1)}function makeAssignment(schedule,course){var availCount,len,i;if(scheduleData[schedule].cRef.length){if(!1!==canAssignHereChk(schedule,course)&&!1!==notAssignedChk(course)&&!1!==maxHrsChk(schedule,course)&&!1!==dayOffChk(schedule,course)&&!1!==maxHoursInOneDay(schedule,course)&&!1!==sequentialHrsChk(schedule,course)&&!1!==chkNoSatCollision(schedule,course)){for(len=scheduleData[schedule].cRef.length,i=availCount=0;i<len&&(collisionChk(schedule,course,i)&&allowFollowChk(schedule,course,i)&&thirdHrCollisionChk(schedule,course,i));i++)availCount++;availCount===len&&allowDeptGroup(schedule,course)&&atomicMakeAssignment(schedule,course)}}else notAssignedChk(course)&&dayOffChk(schedule,course)&&chkNoSatCollision(schedule,course)&&atomicMakeAssignment(schedule,course)}function removeAssignment(schedule,course){if(!scheduleData[schedule].cRef.length)throw new Error("Internal error: Attempted to remove an assignment that was never made: s"+schedule+", c"+course);courseData[course].assgn===schedule&&-1!==scheduleData[schedule].cRef.indexOf(course)&&atomicRemoveAssignment(schedule,course)}function changeDayOff(sParam,newDayOff){var arrayOfCollisions,i,arrRef=scheduleData[sParam].cRef;if(scheduleData[sParam].dayOff=Number(newDayOff),!arrRef.length)return[];for(arrayOfCollisions=[],i=0;i<arrRef.length;i++)dayOffChk(sParam,arrRef[i])||arrayOfCollisions.push(arrRef[i]);for(i=0;i<arrayOfCollisions.length;i++)removeAssignment(sParam,arrayOfCollisions[i]);return arrayOfCollisions}function hasSameCategory(sParam,cParam){var noOfCatKlinics,i,arrRef=scheduleData[sParam].cRef,catChk=!1;if(!0===stats.settings.overrides.multiCats)return!0;if("CLINIC"===courseData[cParam].cat)return!0;if(!arrRef.length)return!0;for(i=noOfCatKlinics=0;i<arrRef.length;i++)if("CLINIC"===courseData[arrRef[i]].cat)noOfCatKlinics++;else if(courseData[arrRef[i]].cat===courseData[cParam].cat){catChk=!0;break}return catChk=noOfCatKlinics===arrRef.length?!0:catChk}function createOneSchedule(day){var newSchedule="s1",dataSize=stats.indexData.schedules.length;return(dataSize||0<dataSize)&&(newSchedule="s"+(Number(stats.indexData.schedules[dataSize-1].substring(1))+1)),scheduleData[newSchedule]={},scheduleData[newSchedule].cRef=[],scheduleData[newSchedule].dayOff=6,scheduleData[newSchedule].display="","Sat"===day&&(scheduleData[newSchedule].isSat="yes"),stats.indexData.schedules.push(newSchedule),updateScheduleDisplayNumbers(!1),newSchedule}function destroyOneSchedule(sParam){var i;if(scheduleData[sParam].cRef.length)for(i=scheduleData[sParam].cRef.length-1;0<=i;i--)removeAssignment(sParam,scheduleData[sParam].cRef[i]);stats.indexData.schedules.splice(stats.indexData.schedules.indexOf(sParam),1),delete scheduleData[sParam],updateScheduleDisplayNumbers(!0)}function getErrorsForCreateNewCat(idx,newCat){window.mscAlert({title:"",subtitle:["Please enter an appropriate name.",'"CLINIC" is a reserved category name!',"The name: "+newCat+" already exists.\nPlease choose a unique name."][idx]})}function createNewCat(bool,newCat){var newCatArr,i;if(!0===bool){if(""===(newCat=cleanMultiWsWithSingleWs(cleanDngrChars(newCat))))return void getErrorsForCreateNewCat(0);if("clinic"===newCat.toLowerCase())return void getErrorsForCreateNewCat(1);if(stats.catData.length)for(i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===newCat)return void getErrorsForCreateNewCat(2,newCat)}newCatArr=[newCat,0,buildDefaultScheduleUiArr(0)],stats.catData.push(newCatArr),displayNewCat(stats.catData.length),!0===bool&&(window.mscAlert({title:"",subtitle:newCat+" has been added to the list of categories."}),docElId("definenewcat").value="",exitMakeNewCat()),populateNewCourseCats()}function defineNewCourseStrings(dParam){var valObj={},newTimes="",idx1=docElId("newhrsone").selectedIndex,newRmB=docElId("newcourseroomB").value;return valObj.newName=docElId("newcoursename").value,valObj.newRm={},valObj.newRm.a=docElId("newcourseroom").value,valObj.newCat=docElId("newcoursecat").options[docElId("newcoursecat").selectedIndex].value,valObj.newDept=docElId("newcoursedept").options[docElId("newcoursedept").selectedIndex].value,newTimes+=""+docElId("newdayone").options[docElId("newdayone").selectedIndex].value+docElId("newhrsone").options[idx1].value,"twohour"!==dParam&&"threehour"!==dParam&&(newTimes+=","+docElId("newdaytwo").options[docElId("newdaytwo").selectedIndex].value+docElId("newhrstwo").options[docElId("newhrstwo").selectedIndex].value),"twohour"===dParam&&(newTimes+="-"+(idx1+10)+":50"),"threehour"===dParam&&(newTimes+="-"+(idx1+11)+":50"),valObj.newTimes=newTimes,valObj.newName=cleanNumCharsOnly(valObj.newName),valObj.newRm.a=cleanAlphaNumericAndDashOnlyChars(valObj.newRm.a),""!==(newRmB=cleanAlphaNumericAndDashOnlyChars(newRmB))&&newRmB!==valObj.newRm.a&&(valObj.newRm.b=newRmB),valObj}function getNewDayHrMap(dParam){var allowFollow=[],dayHr=[[0,0],[0,0]],idx1=docElId("newhrsone").selectedIndex,idx2=docElId("newhrstwo").selectedIndex,day1=docElId("newdayone").selectedIndex,day2=docElId("newdaytwo").selectedIndex;return dayHr[0][0]=day1,"ninety"===dParam?(dayHr[1][0]=day2,idx1%2==1?(dayHr[0][1]=(idx1-1)/2,allowFollow.push(Boolean(!1))):(dayHr[0][1]=idx1/2,allowFollow.push(Boolean(!0))),idx2%2==1?(dayHr[1][1]=(idx2-1)/2,allowFollow.push(Boolean(!1))):(dayHr[1][1]=idx2/2,allowFollow.push(Boolean(!0)))):(dayHr[0][1]=idx1,"twohour"===dParam?(dayHr[1][0]=day1,dayHr[1][1]=idx1+1):"threehour"===dParam?(dayHr[1][0]=day1,dayHr[1][1]=idx1+2):(dayHr[1][0]=day2,dayHr[1][1]=idx2)),[dayHr,allowFollow]}function defineNewCourseDuration(){return docElId("durationninety").checked?"ninety":docElId("durationtwo").checked?"twohour":docElId("durationthree").checked?"threehour":"onehour"}function removeNewCourseArrays(){stats.newDepts=[],stats.newKlinicDefs=[],stats.newCourses=[],stats.overwriteCourses=[],delete stats.newDepts,delete stats.newKlinicDefs,delete stats.newCourses,delete stats.overwriteCourses}function prepInsertNewCoursesFromCSV(){var i,ii;for(getNewDeptsFromCSV(),i=stats.newCourses.length-1;0<=i;i--)for(ii=0;ii<stats.indexData.courses.length;ii++)if(stats.newCourses[i].name===courseData[stats.indexData.courses[ii]].name){stats.overwriteCourses.push(stats.newCourses[i]),stats.newCourses.splice(i,1);break}stats.overwriteCourses.length?window.mscConfirm({title:"Overwrite courses?",subtitle:'Some of the courses you are attempting to upload have names (IDs) that currently exist. Choose: "Ok" to overwrite the existing courses, or cancel this action.',onOk:function(){insertNewCoursesFromCSV(!0)},onCancel:function(){removeNewCourseArrays()}}):insertNewCoursesFromCSV(!1)}function deleteCourseNoWarning(cParam){var domEl,i;for(notAssignedChk(cParam)||removeAssignmentViaUI(courseData[cParam].assgn,cParam),stats.indexData.courses.splice(stats.indexData.courses.indexOf(cParam),1),emptyContent(domEl=docElId("contain"+cParam)),domEl.parentNode.removeChild(domEl),i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===courseData[cParam].cat){--stats.catData[i][1],--stats.catData[i][2][courseData[cParam].dayhr[0][0]][courseData[cParam].dayhr[0][1]],"CLINIC"!==courseData[cParam].cat&&--stats.catData[i][2][courseData[cParam].dayhr[1][0]][courseData[cParam].dayhr[1][1]],"threehour"===courseData[cParam].duration&&--stats.catData[i][2][courseData[cParam].dayhr[0][0]][courseData[cParam].dayhr[0][1]+1];break}delete courseData[cParam]}function mergeCats(catOne,catTwo){for(var catOneIndex,catTwoIndex,cObjRef,ii,len=stats.indexData.courses.length,i=0;i<len;i++)(cObjRef=courseData[stats.indexData.courses[i]]).cat===catTwo&&(cObjRef.cat=catOne);for(i=0;i<stats.catData.length;i++)stats.catData[i][0]===catOne?catOneIndex=i:stats.catData[i][0]===catTwo&&(catTwoIndex=i);if(null==catOneIndex)throw new Error("Internal error: Attempting to read a category that doesn't exist!");if(null==catTwoIndex)throw new Error("Internal error: Attempting to read a category that doesn't exist!");for(stats.catData[catOneIndex][1]+=stats.catData[catTwoIndex][1],i=0;i<stats.catData[catOneIndex][2].length;i++)for(ii=0;ii<stats.catData[catOneIndex][2][i].length;ii++)stats.catData[catOneIndex][2][i][ii]+=stats.catData[catTwoIndex][2][i][ii];for(stats.catData[catTwoIndex][0]="$deleted"+[catTwoIndex+1],updateDisplayAllCourses(),updateAllCatListsOnSchedules(catOne),i=0;i<stats.catData.length;i++)showEl("catedt"+[i+1]);showHideEl("catref"+(catOneIndex+1))}function getErrorsForSaveNewCatName(idx){window.mscAlert({title:"",subtitle:["Please choose an appropriate name!",'"CLINIC" is a reserved category name!'][idx]})}function saveNewCatName(catNumber){var frag,firstSpan,secondSpan,recycleSpan,newText,cObjRef,i,ctgryIndex=Number(catNumber)-1,catVal=cleanMultiWsWithSingleWs(cleanDngrChars(docElId("catchg"+catNumber).value)),len=stats.indexData.courses.length;if(""===catVal)getErrorsForSaveNewCatName(0);else if(null!=stats.catData[ctgryIndex]&&!Number.isNaN(Number(ctgryIndex)))if(stats.catData[ctgryIndex][0]===catVal)hideCatEdit(catNumber);else{for(i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===catVal&&ctgryIndex!==i)return"clinic"===catVal.toLowerCase()?void getErrorsForSaveNewCatName(1):void window.mscConfirm({title:"Merge!",subtitle:'This action will move courses from: "'+stats.catData[ctgryIndex][0]+'" and place them under: "'+stats.catData[i][0]+'".\nThe category "'+stats.catData[ctgryIndex][0]+'" will be deleted.\nThis action cannot be undone. Proceed?',onOk:function(){mergeCats(stats.catData[i][0],stats.catData[ctgryIndex][0])},onCancel:function(){}});for(i=0;i<len;i++)(cObjRef=courseData[stats.indexData.courses[i]]).cat===stats.catData[ctgryIndex][0]&&(cObjRef.cat=""+catVal);stats.catData[ctgryIndex][0]=""+catVal,emptyContent(docElId("catref"+catNumber)),frag=document.createDocumentFragment(),firstSpan=document.createElement("span"),secondSpan=document.createElement("span"),recycleSpan=document.createElement("span"),newText=document.createTextNode(stats.catData[ctgryIndex][0]),firstSpan.id="catedt"+catNumber,firstSpan.className="catedt btn-xs btn-warning pull-left nodisplay",firstSpan.textContent="Edit",secondSpan.id="bldr"+catNumber,secondSpan.className="autobuilder pull-right icon-flash nodisplay",recycleSpan.id="recycle"+catNumber,recycleSpan.className="pull-right recycler icon-recycle",frag.appendChild(firstSpan),frag.appendChild(newText),frag.appendChild(secondSpan),frag.appendChild(recycleSpan),docElId("catref"+catNumber).appendChild(frag),6<Number(stats.catData[ctgryIndex][1])&&showEl("bldr"+catNumber),docElId("catchg"+catNumber).value=catVal,hideCatEdit(catNumber),updateAllCatListsOnSchedules(catVal)}}function updateAllCatListsOnSchedules(catVal){for(var cObjRef,len=stats.indexData.courses.length,i=0;i<len;i++)(cObjRef=courseData[stats.indexData.courses[i]]).cat===catVal&&""!==cObjRef.assgn&&updateCatListOnSchedule(cObjRef.assgn)}function triggerCatDelete(catNumber){var ctgryIndex=Number(catNumber)-1;window.mscConfirm({title:"Warning",subtitle:"This action will also delete all courses under the category:\n"+stats.catData[ctgryIndex][0]+".\nThis action cannot be undone. Proceed?",onOk:function(){destroyCategory(ctgryIndex)},onCancel:function(){}})}function destroyCategory(ctgryIndex){var i,catName=stats.catData[ctgryIndex][0];if(null!=stats.catData[ctgryIndex]&&!Number.isNaN(Number(ctgryIndex))){for(i=stats.indexData.courses.length-1;0<=i&&0<stats.catData[ctgryIndex][1];i--)courseData[stats.indexData.courses[i]].cat===catName&&deleteCourseNoWarning(stats.indexData.courses[i]);"CLINIC"===catName&&(stats.indexData.klinics=[]),stats.catData[ctgryIndex][0]="$deleted"+[ctgryIndex+1],disableUIforDeletedCat(ctgryIndex+1)}}function destroyOneCourse(cParam){window.mscConfirm({title:"Delete course?",subtitle:"Are you sure you want to delete this course?\nThis action cannot be undone!",onOk:function(){deleteCourseNoWarning(cParam)},onCancel:function(){}})}function purgeCoursesAndReset(){var i,len=stats.indexData.schedules.length;if(len)for(i=0;i<len;i++)recycleOneSchedule("reset"+stats.indexData.schedules[i]);emptyContent(docElId("references")),courseData={},stats.catData=[],stats.indexData.courses=[]}function purgeAllCourses(){window.mscConfirm({title:"Purge?",subtitle:"This action will remove all courses and categories.\nSettings, teachers, departments, groups and clinic definitions will all remain intact.\nThis action cannot be undone! Proceed?",onOk:function(){purgeCoursesAndReset()},onCancel:function(){}})}function removeAssignmentUsingcParam(cParam){""!==courseData[cParam].assgn&&removeAssignmentViaUI(courseData[cParam].assgn,cParam)}function removeAssignmentUsingsParam(elTokens){var sParam="s"+elTokens[0];0!==elTokens[1]&&(elTokens="c"+elTokens[1],-1!==scheduleData[sParam].cRef.indexOf(elTokens))&&removeAssignmentViaUI(sParam,elTokens)}function resetDayOff(el){var sParam=el.substring(4),el=Number(el.substring(3,4));el===scheduleData[sParam].dayOff&&(docElId("off"+el+sParam).style.color="",scheduleData[sParam].dayOff=6)}function setNewDayOff(el){var i,sParam=clickedDayOff(el),collidedCourses=changeDayOff(sParam,Number(el.substring(3,4)));if(collidedCourses.length)for(i=collidedCourses.length-1;0<=i;i--)toggleColorsOnOff(sParam,collidedCourses[i],"off"),"CLINIC"===courseData[collidedCourses[i]].cat&&deleteCourseNoWarning(collidedCourses[i]);updateCatListOnSchedule(sParam),checkTooFewCourses(sParam)}function rotateToNextAvailableCourse(sParam,dayHrId,currentcParam){var assgnId,i;for(stopKlinicInterfering(),assgnId="nada",i=stats.indexData.courses.indexOf(currentcParam);i<stats.indexData.courses.length;i++)if(stats.indexData.courses[i]!==currentcParam&&notAssignedChk(stats.indexData.courses[i])&&!0===clickedElIsMatch(stats.indexData.courses[i],dayHrId)&&!0===hasSameCategory(sParam,stats.indexData.courses[i])){if(removeAssignmentViaUI(sParam,currentcParam),makeAssignment(sParam,stats.indexData.courses[i]),!canAssignHereChk(sParam,stats.indexData.courses[i]))return assgnId=stats.indexData.courses[i];makeAssignment(sParam,currentcParam),toggleColorsOnOff(sParam,currentcParam,"on")}return assgnId}function clickedElIsMatch(cParam,dayHrId){var isMatch=!1,cParam=courseData[cParam];return"threehour"===cParam.duration&&[cParam.dayhr[0][0],cParam.dayhr[0][1]+1].identical(dayHrId)&&(isMatch=!0),isMatch=cParam.dayhr[0].identical(dayHrId)||cParam.dayhr[1].identical(dayHrId)?!0:isMatch}function fillTimeWithFirstChoice(sParam,dayHrId){var assgnId,len,statsRef,i;for(stopKlinicInterfering(),assgnId="nada",len=stats.indexData.courses.length,i=0;i<len;i++)if(notAssignedChk(statsRef=stats.indexData.courses[i])&&!0===clickedElIsMatch(statsRef,dayHrId)&&!0===hasSameCategory(sParam,statsRef)&&(makeAssignment(sParam,statsRef),!canAssignHereChk(sParam,statsRef)))return assgnId=statsRef;return assgnId}function removeAssignmentViaUI(sParam,cParam){removeAssignment(sParam,cParam),toggleColorsOnOff(sParam,cParam,"off"),updateCatListOnSchedule(sParam),checkTooFewCourses(sParam)}function fillTimeWithUserSelectedCourse(sParam,cParam){return!!notAssignedChk(cParam)&&!0===hasSameCategory(sParam,cParam)&&(makeAssignment(sParam,cParam),!canAssignHereChk(sParam,cParam))}function setAssignmentViaUI(sParam,cParam){var sParam="s"+sParam,canAssign=fillTimeWithUserSelectedCourse(sParam,cParam);!0===canAssign&&(toggleColorsOnOff(sParam,cParam,"on"),updateCatListOnSchedule(sParam),checkTooFewCourses(sParam)),!1===canAssign&&"CLINIC"===courseData[cParam].cat&&deleteCourseNoWarning(cParam),stats.tempCparam=""}function getCatListForSchedule(sParam){var cObjRef,uniqueCats,i,listOfCats="",assgndCats=[],arrRef=scheduleData[sParam].cRef;if(!arrRef.length)return"";for(i=0;i<arrRef.length;i++)"CLINIC"!==(cObjRef=courseData[arrRef[i]]).cat&&assgndCats.push(cObjRef.cat);if(!assgndCats.length)return"";for(assgndCats.sort(),listOfCats+=(uniqueCats=uniqueValues(assgndCats))[0],i=1;i<uniqueCats.length;i++)listOfCats+=", "+uniqueCats[i];return listOfCats}function removeScheduleOnMscOk(sParam){var i,releasedCourses=scheduleData[sParam].cRef.slice(),thisSchedule=docElId(""+sParam);for(emptyContent(thisSchedule),thisSchedule.parentElement.removeChild(thisSchedule),destroyOneSchedule(sParam),i=0;i<releasedCourses.length;i++)toggleCourseRef(releasedCourses[i])}function removeScheduleFromDisplay(el){var sParam=el.substring(3);window.mscConfirm({title:"Delete schedule?",subtitle:"Are you sure you want to delete this schedule?\nThis action cannot be undone!",onOk:function(){removeScheduleOnMscOk(sParam)},onCancel:function(){}})}function displayNewEmptySchedule(day){var newScheduleId=createOneSchedule(day);newScheduleUI(newScheduleId,day),checkTooFewCourses(newScheduleId)}function recycleOneSchedule(elId){var i,sParam=elId.substring(5);if(scheduleData[sParam].cRef.length)for(i=scheduleData[sParam].cRef.length-1;0<=i;i--)"CLINIC"===courseData[scheduleData[sParam].cRef[i]].cat?deleteCourseNoWarning(scheduleData[sParam].cRef[i]):removeAssignmentViaUI(sParam,scheduleData[sParam].cRef[i]);for(scheduleData[sParam].dayOff=6,i=0;i<5;i++)docElId("off"+i+sParam).style.color="";scheduleData[sParam].hasOwnProperty("isSat")&&(docElId("off5"+sParam).style.color=""),scheduleData[sParam].hasOwnProperty("tchr")&&""!==scheduleData[sParam].tchr&&clearAssgndtchr(sParam)}function recycleOneCat(elId){var schedulesToClean,i,catIndex=Number(elId.substring(7))-1,cat=stats.catData[catIndex][0];if(!0===catExists(cat)){for(schedulesToClean=[],docElId("courselist"+elId.substring(7)).setAttribute("class","hide"),i=stats.indexData.courses.length-1;0<=i;i--)courseData[stats.indexData.courses[i]].cat===cat&&""!==courseData[stats.indexData.courses[i]].assgn&&(schedulesToClean.push(courseData[stats.indexData.courses[i]].assgn),"CLINIC"===cat?deleteCourseNoWarning(stats.indexData.courses[i]):removeAssignmentViaUI(courseData[stats.indexData.courses[i]].assgn,stats.indexData.courses[i]));if(schedulesToClean.length)for(schedulesToClean=uniqueValues(schedulesToClean),i=0;i<schedulesToClean.length;i++)0===scheduleData[schedulesToClean[i]].cRef.length&&recycleOneSchedule("reset"+schedulesToClean[i])}}function checkTooFewCourses(sParam){var thisStyle=docElId(""+sParam);!scheduleData[sParam].cRef.length||calculateHrsForMaxHrsChk(sParam)<stats.settings.maxHours-1?(thisStyle.style.borderColor="#3498db",thisStyle.style.color="#3498db"):(thisStyle.style.borderColor="",thisStyle.style.color=""),thisStyle.firstChild.style.fontWeight="700"}function setEditingDefaultVals(cParam){var depart,i,cObjRef=courseData[cParam];if("CLINIC"!==cObjRef.cat){for(depart=docElId("edrdept-"+cParam),i=0;i<depart.options.length;i++)if(cObjRef.dept===depart.options[i].value){depart.selectedIndex=i;break}docElId("edrday1-"+cParam).selectedIndex=cObjRef.dayhr[0][0],docElId("edrday2-"+cParam).selectedIndex=cObjRef.dayhr[1][0],"ninety"===cObjRef.duration?(!1===cObjRef.allowFollow[0]?docElId("edrstart1-"+cParam).options.length>2*cObjRef.dayhr[0][1]+1?docElId("edrstart1-"+cParam).selectedIndex=2*cObjRef.dayhr[0][1]+1:docElId("edrstart1-"+cParam).selectedIndex=docElId("edrstart1-"+cParam).options.length-1:docElId("edrstart1-"+cParam).selectedIndex=2*cObjRef.dayhr[0][1],!1===cObjRef.allowFollow[1]?docElId("edrstart2-"+cParam).options.length>2*cObjRef.dayhr[1][1]+1?docElId("edrstart2-"+cParam).selectedIndex=2*cObjRef.dayhr[1][1]+1:docElId("edrstart2-"+cParam).selectedIndex=docElId("edrstart2-"+cParam).options.length-1:docElId("edrstart2-"+cParam).selectedIndex=2*cObjRef.dayhr[1][1]):(docElId("edrstart1-"+cParam).selectedIndex=cObjRef.dayhr[0][1],docElId("edrstart2-"+cParam).selectedIndex=cObjRef.dayhr[1][1]),showEditingControls(cParam)}}function isSameDayHrSelected(cParam){var geniusChk,cObjRef=courseData[cParam];return"twohour"!==cObjRef.duration&&"threehour"!==cObjRef.duration&&((geniusChk=[[],[]])[0].push(docElId("edrday1-"+cParam).selectedIndex),geniusChk[1].push(docElId("edrday2-"+cParam).selectedIndex),"ninety"===cObjRef.duration?(geniusChk[0].push(Math.floor(docElId("edrstart1-"+cParam).selectedIndex)/2),geniusChk[1].push(Math.floor(docElId("edrstart2-"+cParam).selectedIndex)/2)):(geniusChk[0].push(docElId("edrstart1-"+cParam).selectedIndex),geniusChk[1].push(docElId("edrstart2-"+cParam).selectedIndex)),!!geniusChk[0].identical(geniusChk[1]))}function reAssignAfterChange(sParam,cParam){"CLINIC"===courseData[cParam].cat||""===sParam||(makeAssignment(sParam,cParam),canAssignHereChk(sParam,cParam))||(toggleColorsOnOff(sParam,cParam,"on"),updateCatListOnSchedule(sParam),checkTooFewCourses(sParam,cParam))}function prepUI(){updateSettingsUI(),populateNewCourseOpts(),displayAllCourseRefs(),createStatsGrid("stats-grid","g_d"),createStatsGrid("klinics-grid","gk_d")}function loadStateFromData(bool){var stsRef,sOrcObjRef,i;for(hideEl("parsing"),prepUI(),i=0;i<stats.indexData.schedules.length;i++)stsRef=stats.indexData.schedules[i],(sOrcObjRef=scheduleData[stsRef]).hasOwnProperty("isSat")?newScheduleUI(stsRef,"Sat"):newScheduleUI(stsRef,"MtoF");if(!0===bool){for(i=0;i<stats.indexData.courses.length;i++)stsRef=stats.indexData.courses[i],""!==(sOrcObjRef=courseData[stsRef]).assgn&&toggleColorsOnOff(sOrcObjRef.assgn,stsRef,"init");for(i=0;i<stats.indexData.schedules.length;i++)stsRef=stats.indexData.schedules[i],sOrcObjRef=scheduleData[stsRef],updateCatListOnSchedule(stsRef),6!==sOrcObjRef.dayOff&&(docElId("off"+sOrcObjRef.dayOff+stsRef).style.color="#2c3e50"),sOrcObjRef.hasOwnProperty("tchr")&&""!==sOrcObjRef.tchr&&(docElId("tchrset"+stsRef).textContent=sOrcObjRef.tchr);updateSettingsInputVals(),setOverrideControls()}for(i=0;i<stats.indexData.schedules.length;i++)checkTooFewCourses(stats.indexData.schedules[i]);displayUpdatedKlinicBtns()}function populateNewCourseOpts(){populateNewCourseCats(),populateNewCourseDepts(),populateClassTimes("onehour")}function chkDeptGrpsAfterEdit(){var allDepartments,i;if(stats.settings.deptGrps.length){for(allDepartments=[],i=0;i<stats.indexData.depts.length;i++)allDepartments.push(stats.indexData.depts[i].shortcode);for(i=stats.settings.deptGrps.length-1;0<=i;i--)(isObjEmpty(stats.settings.deptGrps[i])||allDepartments.identical(stats.settings.deptGrps[i].sort()))&&stats.settings.deptGrps.splice(i,1)}stats.settings.deptGrps.length?stats.settings.overrides.deptGrps=!1:stats.settings.overrides.deptGrps=!0,docElId("newgroupid").dataset.grpindex=stats.settings.deptGrps.length}function openSettings(){getAllDeptsOnUI(),rebuildDeptGrpString(),hideEl("displayOverrides"),hideEl("left"),hideEl("right"),initSettingsListeners()}function populateNewCourseNameInputs(arr){for(var cRefFound,i=arr.length-1;0<=i;i--)null!=(cRefFound=findcRefByCourseName(arr[i][0]))&&(arr[i][0]=cRefFound);for(i=0;i<arr.length;i++)try{docElId("newName-"+arr[i][0]).value=arr[i][1]}catch(e){continue}}function chkNewCourseValue(newVal){for(var statsRef,len=stats.indexData.courses.length,i=0;i<len;i++)if(statsRef=stats.indexData.courses[i],newVal===courseData[statsRef].name&&""===docElId("newName-"+statsRef).value)return!1;return!0}function errorsForVerifyNewCourseNames(idx,cName){window.mscAlert({title:"",subtitle:["The new name for course: "+cName+" must be a four digit number.","The course name: "+cName+"\nbelongs to another existing course!\nNew course names cannot be duplicates of existing course names.","Please check that each course has a new unique name.\nSome new course names are being duplicated."][idx]})}function verifyNewCourseNames(){for(var statsRef,newVal,uniqueNewNames,someBlanks=!1,duplicatesArr=[],len=stats.indexData.courses.length,i=0;i<len;i++)if(statsRef=stats.indexData.courses[i],"CLINIC"!==courseData[statsRef].cat)if(""===(newVal=docElId("newName-"+statsRef).value))someBlanks=!0;else{if(""!==newVal&&(newVal.length!==config.courseNameNumLength||Number(newVal)<1||Number.isNaN(Number(newVal))))return void errorsForVerifyNewCourseNames(0,courseData[statsRef].name);if(!0!==chkNewCourseValue(newVal))return void errorsForVerifyNewCourseNames(1,newVal);duplicatesArr.push(newVal)}duplicatesArr.sort(),uniqueNewNames=uniqueValues(duplicatesArr),duplicatesArr.length!==uniqueNewNames.length?errorsForVerifyNewCourseNames(2):!0!==someBlanks?changeAllCourseNames():window.mscConfirm({title:"",subtitle:"Some fields have been left blank.\nCourses with blank fields will not be renamed.\nContinue?",cancelText:"Cancel",onOk:function(){changeAllCourseNames()},onCancel:function(){}})}function changeAllCourseNames(){for(var cObjRef,statsRef,newVal,len=stats.indexData.courses.length,i=0;i<len;i++)statsRef=stats.indexData.courses[i],"CLINIC"!==(cObjRef=courseData[statsRef]).cat&&""!==(newVal=docElId("newName-"+statsRef).value)&&(cObjRef.name=newVal,""!==cObjRef.assgn&&(toggleColorsOnOff(cObjRef.assgn,statsRef,"off"),toggleColorsOnOff(cObjRef.assgn,statsRef,"on")),rebuildcReference(statsRef));closeRenamingCourses()}function calculateBuildSize(buildSize,satBuildSize){return[buildSize=Math.ceil((Math.ceil(buildSize)-Math.ceil(satBuildSize))/(Number(stats.settings.maxHours)/2))+1,satBuildSize=Math.ceil(satBuildSize/(Number(stats.settings.maxHours)/2))+1]}function countExistingSchedules(){for(var statsRef,monToFriCount=0,satCount=0,len=stats.indexData.schedules.length,i=0;i<len;i++)statsRef=stats.indexData.schedules[i],scheduleData[statsRef].hasOwnProperty("isSat")?satCount++:monToFriCount++;return[monToFriCount,satCount]}function defineInitBlankSchedules(bool){for(var returnVals,noOfExistingMonToFri,noOfExistingSat,buildSize=0,satBuildSize=0,i=0;i<stats.catData.length;i++)buildSize+=stats.catData[i][1],satBuildSize+=stats.catData[i][2][5].reduce(function(a,b){return a+b},0);if(returnVals=calculateBuildSize(buildSize,satBuildSize),!0===bool){if(0<returnVals[0])for(i=0;i<returnVals[0];i++)createOneSchedule("MtoF");if(0<returnVals[1])for(i=0;i<returnVals[1];i++)createOneSchedule("Sat")}else{if(noOfExistingMonToFri=returnVals[0]-1-countExistingSchedules[0],noOfExistingSat=returnVals[1]-1-countExistingSchedules[0],0<noOfExistingMonToFri)for(i=0;i<noOfExistingMonToFri;i++)createOneSchedule("MtoF");if(0<noOfExistingSat)for(i=0;i<noOfExistingSat;i++)createOneSchedule("Sat")}}function setCssScheduleRowPixelHeight(){var height=65+config.scheduleRowPixelHeight*(config.uiScheduleNumOfHrsPerDay+1),heightShowTchr=65+config.scheduleRowPixelHeight*(config.uiScheduleNumOfHrsPerDay+1)+25,height="#schedule-instances>div{min-height:"+height+"px;height:"+height+"px;max-height:"+height+"px;} #schedule-instances>div.show-teacher{min-height:"+heightShowTchr+"px;height:"+heightShowTchr+"px;max-height:"+heightShowTchr+"px;}",heightShowTchr=document.createElement("style");heightShowTchr.type="text/css",heightShowTchr.styleSheet?heightShowTchr.styleSheet.cssText=height:heightShowTchr.appendChild(document.createTextNode(height)),document.getElementsByTagName("head")[0].appendChild(heightShowTchr)}function setScheduleInputDefaultValues(){docElId("hrsPerSchedule").value=""+config.maxHours,docElId("hrsPerSchedule").max=""+5*config.uiScheduleNumOfHrsPerDay,docElId("hrsPerDay").value=""+config.maxHrsPerDay,docElId("hrsPerDay").max=""+config.uiScheduleNumOfHrsPerDay}function initCoreApp(){setCssScheduleRowPixelHeight(),setScheduleInputDefaultValues(),initCsvUpdateHdrs(),initLoadListeners()}function groupStatsArr(catsHrs){return catsHrs.map(function(e,i){return i%3==0?catsHrs.slice(i,i+3):null}).filter(function(e){return e})}function finishBuildStats(catsHrs,indexKeys,hasPassedChks){stats.catData=groupStatsArr(catsHrs),stats.indexData={},stats.indexData.courses=indexKeys,stats.indexData.schedules=[],stats.indexData.depts=getUniqueDepartments(),!0===Array.isArray(hasPassedChks)?stats.indexData.klinics=hasPassedChks:stats.indexData.klinics=[],stats.teachers=[],stats.tempCparam="",stats.tempKlinic={kbtn:"",isHeld:!1},stats.lastSearchItem="",stats.settings={maxHours:config.maxHours,maxHrsPerDay:config.maxHrsPerDay,maxSeqHrs:3,deptGrps:[[]],deptGrpsSetBy:"day",overrides:{maxHours:!1,maxHrsPerDay:!1,maxSeqHrs:!1,deptGrps:!0,multiCats:!1}},stats.settings.deptGrps=[]}function buildStats(){var cObjRef,uiArr,catsHrs=[],indexKeys=[],hasPassedChks=preFlightBuildStats();if(!1!==hasPassedChks){try{Object.keys(courseData).forEach(function(key){indexKeys.push(""+key),cObjRef=courseData[key],-1===catsHrs.indexOf(cObjRef.cat)?(catsHrs.push(cObjRef.cat),catsHrs.push(1),uiArr=buildDefaultScheduleUiArr(0),catsHrs.push(uiArr)):catsHrs[catsHrs.indexOf(cObjRef.cat)+1]+=1,catsHrs[catsHrs.indexOf(cObjRef.cat)+2][cObjRef.dayhr[0][0]][cObjRef.dayhr[0][1]]+=1,"CLINIC"!==cObjRef.cat&&(catsHrs[catsHrs.indexOf(cObjRef.cat)+2][cObjRef.dayhr[1][0]][cObjRef.dayhr[1][1]]+=1),"threehour"===cObjRef.duration&&(catsHrs[catsHrs.indexOf(cObjRef.cat)+2][cObjRef.dayhr[0][0]][cObjRef.dayhr[0][1]+1]+=1)}),finishBuildStats(catsHrs,indexKeys,hasPassedChks),defineInitBlankSchedules(!0),loadStateFromData(!1)}catch(e){return stats={},courseData={},scheduleData={},resetTheWholeUI(),void window.mscAlert({title:"Error",subtitle:"The .csv file you have supplied contains unexpected formatting and/or data."})}exitParsingScreen()}}function sumCatDataHrs(){for(var cObjRef,catRef,ii,iii,len=stats.catData.length,catsSum=buildDefaultScheduleUiArr(0),catsAssigned=buildDefaultScheduleUiArr(0),catsNOTassigned=buildDefaultScheduleUiArr(0),i=0;i<len;i++)if("CLINIC"!==(catRef=stats.catData[i])[0]&&"$deleted"!==catRef[0].substring(0,8)){for(ii=0;ii<catRef[2].length;ii++)for(iii=0;iii<catRef[2][ii].length;iii++)catsSum[ii][iii]+=catRef[2][ii][iii];for(ii=0;ii<stats.indexData.courses.length;ii++)(cObjRef=courseData[stats.indexData.courses[ii]]).cat===catRef[0]&&""===cObjRef.assgn&&(catsNOTassigned[cObjRef.dayhr[0][0]][cObjRef.dayhr[0][1]]+=1,catsNOTassigned[cObjRef.dayhr[1][0]][cObjRef.dayhr[1][1]]+=1,"threehour"===cObjRef.duration)&&(catsNOTassigned[cObjRef.dayhr[1][0]][cObjRef.dayhr[1][1]+1]+=1)}for(i=0;i<catsAssigned.length;i++)for(ii=0;ii<catsAssigned[i].length;ii++)catsAssigned[i][ii]=catsSum[i][ii]-catsNOTassigned[i][ii];return[catsAssigned,catsNOTassigned]}function sumKlinicDataHrs(){for(var catRef,ii,iii,len=stats.catData.length,klinicSum=buildDefaultScheduleUiArr(0),i=0;i<len;i++)if("CLINIC"===(catRef=stats.catData[i])[0])for(ii=0;ii<catRef[2].length;ii++)for(iii=0;iii<catRef[2][ii].length;iii++)klinicSum[ii][iii]+=catRef[2][ii][iii];return klinicSum}function populateGridStats(){for(var elId,ii,catStats=sumCatDataHrs(),klinicStats=sumKlinicDataHrs(),i=0;i<catStats[0].length;i++)for(ii=0;ii<catStats[0][i].length;ii++)docElId(elId="g_d"+i+"t"+ii).textContent=catStats[0][i][ii],0<catStats[1][i][ii]&&(docElId(elId).textContent+=" ("+catStats[1][i][ii]+")");for(i=0;i<klinicStats.length;i++)for(ii=0;ii<klinicStats[i].length;ii++)docElId(elId="gk_d"+i+"t"+ii).textContent=klinicStats[i][ii]}function defineTimeArrForCreateStatsGrid(){for(var hr,timeArr=[],arrLen=config.uiScheduleNumOfHrsPerDay,i=0;i<arrLen;i++)hr=config.uiTimeInputStartHr+i,timeArr.push(hr+":00");return timeArr}function createStatsGrid(containerId,elId){var tr,td,i,ii,timeArr=defineTimeArrForCreateStatsGrid(),monToSat=config.monToSatKr,containerId=docElId(containerId),frag=document.createDocumentFragment(),tbl=document.createElement("TABLE"),tHed=document.createElement("THEAD"),tBdy=document.createElement("TBODY"),tr1=document.createElement("TR"),td1=document.createElement("TD");for(emptyContent(containerId),tbl.className="table table-bordered table-condensed",tr1.className="unbordered",tr1.appendChild(td1),i=0;i<monToSat.length;i++)(td=document.createElement("TD")).textContent=monToSat[i],tr1.appendChild(td);for(tBdy.appendChild(tr1),i=0;i<timeArr.length;i++){for(tr=document.createElement("TR"),ii=0;ii<=monToSat.length;ii++)td=document.createElement("TD"),0===ii?(td.className="unbordered text-right",td.textContent=timeArr[i]+"  "):td.id=""+elId+(ii-1)+"t"+i,tr.appendChild(td);tBdy.appendChild(tr)}tbl.appendChild(tHed),tbl.appendChild(tBdy),frag.appendChild(tbl),containerId.appendChild(frag)}function getCourseStatsByCat(cat){for(var cObjRef,assignedSum=0,catSum=0,catStr="",len=stats.indexData.courses.length,i=0;i<len;i++)cat===(cObjRef=courseData[stats.indexData.courses[i]]).cat&&(""!==cObjRef.assgn&&assignedSum++,catSum++);return catStr+=0<catSum-assignedSum?cat+": "+assignedSum+" ("+(catSum-assignedSum)+")\n":cat+": "+assignedSum+"\n"}function getKlinicStatsByDefinition(){for(var kObj,cObjRef,klinicDefs=[],klinicStr="",len=stats.indexData.courses.length,kLen=stats.indexData.klinics.length,i=0;i<kLen;i++)(kObj={}).name=stats.indexData.klinics[i].name,kObj.count=0,klinicDefs.push(kObj);for(i=0;i<len;i++)"CLINIC"===(cObjRef=courseData[stats.indexData.courses[i]]).cat&&-1!==(cObjRef=klinicDefs.map(function(el){return el.name}).indexOf(cObjRef.name))&&(klinicDefs[cObjRef].count+=1);for(i=0;i<klinicDefs.length;i++)klinicStr+=klinicDefs[i].name+": "+klinicDefs[i].count+"\n";return klinicStr}function populateCatStats(){for(var catStr="",len=stats.catData.length,i=0;i<len;i++)"$deleted"!==stats.catData[i][0].substring(0,8)&&"CLINIC"!==stats.catData[i][0]&&(catStr+=getCourseStatsByCat(stats.catData[i][0]));docElId("coursesByCat").textContent=catStr,docElId("coursesByDef").textContent=getKlinicStatsByDefinition()||""}function viewStats(){populateGridStats(),populateCatStats(),showStats()}function initCsvUpdateHdrs(){docElId("updateHdrsA").addEventListener("click",toggleUpdateCsvA,{capture:!1,passive:!0}),docElId("updateHdrsB").addEventListener("click",toggleUpdateCsvB,{capture:!1,passive:!0})}function initLoadListeners(){docElId("csv-file").addEventListener("change",handleCourseFile,{capture:!1,passive:!0}),docElId("json-file").addEventListener("change",handleJSONFile,{capture:!1,passive:!0}),docElId("configStartHr").addEventListener("change",changeConfigAtParsingScreen,{capture:!1,passive:!0}),docElId("savedsession").addEventListener("click",chkLocalStorage,{capture:!1,passive:!0}),docElId("newsession").addEventListener("click",fromScratch,{capture:!1,passive:!0}),docElId("helpfileA").addEventListener("click",showInfoA,{capture:!1,passive:!0}),docElId("helpfile1").addEventListener("click",hideInfoA,{capture:!1,passive:!0})}function removeLoadListeners(){docElId("csv-file").removeEventListener("change",handleCourseFile,{capture:!1,passive:!0}),docElId("json-file").removeEventListener("change",handleJSONFile,{capture:!1,passive:!0}),docElId("configStartHr").removeEventListener("change",changeConfigAtParsingScreen,{capture:!1,passive:!0}),docElId("savedsession").removeEventListener("click",chkLocalStorage,{capture:!1,passive:!0}),docElId("newsession").removeEventListener("click",fromScratch,{capture:!1,passive:!0}),docElId("helpfileA").removeEventListener("click",showInfoA,{capture:!1,passive:!0}),docElId("helpfile1").removeEventListener("click",hideInfoA,{capture:!1,passive:!0})}function initNewCourseListeners(){docElId("deptEDIT").addEventListener("click",findInDepts,{capture:!1,passive:!0}),docElId("deptEDIT-file").addEventListener("change",handleDeptsFile,{capture:!1,passive:!0}),docElId("csv-freshfile").addEventListener("change",handleAddedCourses,{capture:!1,passive:!0}),docElId("deptopenL").addEventListener("click",showEDITdepts,{capture:!1,passive:!0}),docElId("save-deptEDIT").addEventListener("click",saveUpdatedDepts,{capture:!1,passive:!0}),docElId("deptEDITadd").addEventListener("click",newBlankDept,{capture:!1,passive:!0}),docElId("exit-deptEDIT").addEventListener("click",exitEDITdepts,{capture:!1,passive:!0}),docElId("newcourseform").addEventListener("click",findInMakeNewCourse,{capture:!1,passive:!0}),docElId("newcoursename").addEventListener("input",inputCourseCode,{capture:!1,passive:!0}),docElId("newcourseroom").addEventListener("input",inputRmNum,{capture:!1,passive:!0}),docElId("durationone").addEventListener("click",durationone,{capture:!1,passive:!0}),docElId("durationninety").addEventListener("click",durationninety,{capture:!1,passive:!0}),docElId("durationtwo").addEventListener("click",durationtwo,{capture:!1,passive:!0}),docElId("durationthree").addEventListener("click",durationthree,{capture:!1,passive:!0})}function removeNewCourseListeners(){docElId("deptEDIT").removeEventListener("click",findInDepts,{capture:!1,passive:!0}),docElId("deptEDIT-file").removeEventListener("change",handleDeptsFile,{capture:!1,passive:!0}),docElId("csv-freshfile").removeEventListener("change",handleAddedCourses,{capture:!1,passive:!0}),docElId("deptopenL").removeEventListener("click",showEDITdepts,{capture:!1,passive:!0}),docElId("save-deptEDIT").removeEventListener("click",saveUpdatedDepts,{capture:!1,passive:!0}),docElId("deptEDITadd").removeEventListener("click",newBlankDept,{capture:!1,passive:!0}),docElId("exit-deptEDIT").removeEventListener("click",exitEDITdepts,{capture:!1,passive:!0}),docElId("newcourseform").removeEventListener("click",findInMakeNewCourse,{capture:!1,passive:!0}),docElId("newcoursename").removeEventListener("input",inputCourseCode,{capture:!1,passive:!0}),docElId("newcourseroom").removeEventListener("input",inputRmNum,{capture:!1,passive:!0}),docElId("durationone").removeEventListener("click",durationone,{capture:!1,passive:!0}),docElId("durationninety").removeEventListener("click",durationninety,{capture:!1,passive:!0}),docElId("durationtwo").removeEventListener("click",durationtwo,{capture:!1,passive:!0}),docElId("durationthree").removeEventListener("click",durationthree,{capture:!1,passive:!0})}function initTchrListeners(){docElId("exit-tchrs").addEventListener("click",exitUpdateTchrs,{capture:!1,passive:!0}),docElId("save-tchrs").addEventListener("click",saveUpdatedTchrs,{capture:!1,passive:!0}),docElId("alltchrs").addEventListener("click",findInTchrs,{capture:!1,passive:!0}),docElId("tchrs-file").addEventListener("change",handleTeacherFile,{capture:!1,passive:!0}),docElId("tchradd").addEventListener("click",newBlankTchr,{capture:!1,passive:!0})}function removeTchrListeners(){docElId("exit-tchrs").removeEventListener("click",exitUpdateTchrs,{capture:!1,passive:!0}),docElId("save-tchrs").removeEventListener("click",saveUpdatedTchrs,{capture:!1,passive:!0}),docElId("alltchrs").removeEventListener("click",findInTchrs,{capture:!1,passive:!0}),docElId("tchrs-file").removeEventListener("change",handleTeacherFile,{capture:!1,passive:!0}),docElId("tchradd").removeEventListener("click",newBlankTchr,{capture:!1,passive:!0})}function initKlinicListeners(){docElId("exitklinicchanges").addEventListener("click",exitUpdateKlinics,{capture:!1,passive:!0}),docElId("saveklinicchanges").addEventListener("click",saveUpdatedKlinics,{capture:!1,passive:!0}),docElId("klinic-section").addEventListener("click",findInKlinics,{capture:!1,passive:!0}),docElId("klinicadd").addEventListener("click",newBlankKlinic,{capture:!1,passive:!0})}function removeKlinicListeners(){docElId("exitklinicchanges").removeEventListener("click",exitUpdateKlinics,{capture:!1,passive:!0}),docElId("saveklinicchanges").removeEventListener("click",saveUpdatedKlinics,{capture:!1,passive:!0}),docElId("klinic-section").removeEventListener("click",findInKlinics,{capture:!1,passive:!0}),docElId("klinicadd").removeEventListener("click",newBlankKlinic,{capture:!1,passive:!0})}function initStatsListener(){docElId("exit-stats").addEventListener("click",hideStats,{capture:!1,passive:!0})}function removeStatsListener(){docElId("exit-stats").removeEventListener("click",hideStats,{capture:!1,passive:!0})}function tchrShowToggleOn(){docElId("showteachers").removeEventListener("click",hideTchrsForEditing,{capture:!1,passive:!0}),docElId("showteachers").addEventListener("click",showTchrsForEditing,{capture:!1,passive:!0}),docElId("showteachers").textContent="Show"}function tchrShowToggleOff(){docElId("showteachers").removeEventListener("click",showTchrsForEditing,{capture:!1,passive:!0}),docElId("showteachers").addEventListener("click",hideTchrsForEditing,{capture:!1,passive:!0}),docElId("showteachers").textContent="Hide"}function initMainUiListeners(){docElId("leftsidesettings").addEventListener("click",findInLeftMainUi,{capture:!1,passive:!0}),docElId("uploadnewCNames").addEventListener("change",handleRenamedCourses,{capture:!1,passive:!0}),docElId("rightsidesettings").addEventListener("click",findInRightMainUi,{capture:!1,passive:!0}),docElId("schedule-instances").addEventListener("click",findInMap,{capture:!1,passive:!0}),docElId("references").addEventListener("click",findInList,{capture:!1,passive:!0}),docElId("searchcourses").addEventListener("input",searchCourses,{capture:!1,passive:!0}),docElId("showteachers").addEventListener("click",showTchrsForEditing,{capture:!1,passive:!0}),docElId("deptGrpsDaily").addEventListener("click",deptGrpsDaily,{capture:!1,passive:!0}),docElId("deptGrpsWeekly").addEventListener("click",deptGrpsWeekly,{capture:!1,passive:!0}),docElId("mlticatsyes").addEventListener("click",multiCatsYes,{capture:!1,passive:!0}),docElId("mlticatsno").addEventListener("click",multiCatsNo,{capture:!1,passive:!0}),docElId("startedr").addEventListener("click",editorHandlerOn,{capture:!1,passive:!0}),docElId("helpfileB").addEventListener("click",showInfoB,{capture:!1,passive:!0}),docElId("helpfile1").addEventListener("click",hideInfoB,{capture:!1,passive:!0}),docElId("view-stats").addEventListener("click",viewStats,{capture:!1,passive:!0}),docElId("klinicHold").addEventListener("click",holdKlinic,{capture:!1,passive:!0})}function initSettingsListeners(){docElId("deptEDIT").addEventListener("click",findInDepts,{capture:!1,passive:!0}),docElId("deptEDIT-file").addEventListener("change",handleDeptsFile,{capture:!1,passive:!0}),docElId("deptopenR").addEventListener("click",showEDITdepts,{capture:!1,passive:!0}),docElId("save-deptEDIT").addEventListener("click",saveUpdatedDepts,{capture:!1,passive:!0}),docElId("deptEDITadd").addEventListener("click",newBlankDept,{capture:!1,passive:!0}),docElId("exit-deptEDIT").addEventListener("click",exitEDITdepts,{capture:!1,passive:!0}),docElId("jsonSettings-file").addEventListener("change",handleJSONSettingsReset,{capture:!1,passive:!0}),docElId("alldepartments").addEventListener("click",findInDeptGroup,{capture:!1,passive:!0}),docElId("newgroupid").addEventListener("click",findInScheduleSettings,{capture:!1,passive:!0}),docElId("allgroups").addEventListener("click",deleteDeptGroupViaUI,{capture:!1,passive:!0}),docElId("seqHrsTwo").addEventListener("click",maxSeqHrstwo,{capture:!1,passive:!0}),docElId("seqHrsThree").addEventListener("click",maxSeqHrsthree,{capture:!1,passive:!0}),docElId("hrsPerSchedule").addEventListener("input",chkHrsPerScheduleInput,{capture:!1,passive:!0}),docElId("hrsPerDay").addEventListener("input",chkHrsPerDayInput,{capture:!1,passive:!0}),docElId("save-settings").addEventListener("click",closeSettingsScreen,{capture:!1,passive:!0}),showEl("setting-section")}function removeSettingsListeners(){docElId("deptEDIT").removeEventListener("click",findInDepts,{capture:!1,passive:!0}),docElId("deptEDIT-file").removeEventListener("change",handleDeptsFile,{capture:!1,passive:!0}),docElId("deptopenR").removeEventListener("click",showEDITdepts,{capture:!1,passive:!0}),docElId("save-deptEDIT").removeEventListener("click",saveUpdatedDepts,{capture:!1,passive:!0}),docElId("deptEDITadd").removeEventListener("click",newBlankDept,{capture:!1,passive:!0}),docElId("exit-deptEDIT").removeEventListener("click",exitEDITdepts,{capture:!1,passive:!0}),docElId("jsonSettings-file").removeEventListener("change",handleJSONSettingsReset,{capture:!1,passive:!0}),docElId("alldepartments").removeEventListener("click",findInDeptGroup,{capture:!1,passive:!0}),docElId("newgroupid").removeEventListener("click",findInScheduleSettings,{capture:!1,passive:!0}),docElId("allgroups").removeEventListener("click",deleteDeptGroupViaUI,{capture:!1,passive:!0}),docElId("seqHrsTwo").removeEventListener("click",maxSeqHrstwo,{capture:!1,passive:!0}),docElId("seqHrsThree").removeEventListener("click",maxSeqHrsthree,{capture:!1,passive:!0}),docElId("hrsPerSchedule").removeEventListener("input",chkHrsPerScheduleInput,{capture:!1,passive:!0}),docElId("hrsPerDay").removeEventListener("input",chkHrsPerDayInput,{capture:!1,passive:!0}),docElId("save-settings").removeEventListener("click",closeSettingsScreen,{capture:!1,passive:!0})}function editorHandlerOn(){openEditing(),docElId("startedr").removeEventListener("click",editorHandlerOn,{capture:!1,passive:!0}),docElId("startedr").addEventListener("click",editorHandlerOff,{capture:!1,passive:!0}),docElId("startedr").textContent="Close",showEl("addnewcourse"),showEl("renamer"),showEl("purger"),showEl("openklinics"),hideEl("klinicscontainer"),hideEl("klinicHolder")}function editorHandlerOff(){closeEditing(),docElId("startedr").removeEventListener("click",editorHandlerOff,{capture:!1,passive:!0}),docElId("startedr").addEventListener("click",editorHandlerOn,{capture:!1,passive:!0}),docElId("startedr").textContent="",hideEl("renamer"),hideEl("newCNames"),hideEl("addnewcourse"),hideEl("purger"),hideEl("openklinics"),displayUpdatedKlinicBtns(),catExists("CLINIC")&&showEl("klinicscontainer")}function catExists(cat){for(var exists=!1,i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===cat){exists=!0;break}return exists}function getScheduleIdsForAutoBldr(){for(var sObjRef,scheduleArr=[],len=stats.indexData.schedules.length,i=0;i<len;i++)(sObjRef=scheduleData[stats.indexData.schedules[i]]).cRef.length||6!==sObjRef.dayOff||scheduleArr.push(stats.indexData.schedules[i]);return scheduleArr}function getCoursesForAutoBldr(cat){for(var cObjRef,courseDataClone={},len=stats.indexData.courses.length,i=0;i<len;i++)(cObjRef=courseData[stats.indexData.courses[i]]).cat===cat&&""===cObjRef.assgn&&(courseDataClone[stats.indexData.courses[i]]=cObjRef);return courseDataClone}function autoBldrBuildIt(cat){var el0,el2,el3,aWorker={},dataArr=[];try{aWorker=new Worker("autoBldr_14.min.js")}catch(e){return}el0=getScheduleIdsForAutoBldr(),cat=getCoursesForAutoBldr(cat),el2=stats.settings,el3=""+config.uiScheduleNumOfHrsPerDay,dataArr.push(el0,cat,el2,el3),el0=JSON.stringify(dataArr),aWorker.onmessage=function(result){autoBldrMakeAssignments(result)},aWorker.postMessage(el0)}function initAutoBuilder(elId){elId=Number(elId.substring(4))-1,elId=stats.catData[elId][0];!0===chkCatForAutoBldr(elId)&&autoBldrBuildIt(elId)}function chkCatForAutoBldr(cat){var cObjRef,i,coursesOfInterest=0,freeSchedules=getScheduleIdsForAutoBldr(),returnVal=!0,len=stats.indexData.courses.length;for(!1===catExists(cat)&&(returnVal=!1),"CLINIC"===cat&&(returnVal=!1),i=0;i<len;i++)(cObjRef=courseData[stats.indexData.courses[i]]).cat===cat&&""===cObjRef.assgn&&coursesOfInterest++;return!0===stats.settings.overrides.maxHours?(window.mscAlert({title:"",subtitle:"Please turn off the override for MAX. HOURS!"}),returnVal=!1):coursesOfInterest<stats.settings.maxHours/2?(window.mscAlert({title:"",subtitle:"Too few unassigned courses left to justify this action!"}),returnVal=!1):freeSchedules.length||(window.mscAlert({title:"",subtitle:"No empty schedules are available."}),returnVal=!1),returnVal}function autoBldrMakeAssignments(result){for(var hashMapsCrefLen,hashMapObjRef,sParam,cParam,ii,hashMaps=JSON.parse(result.data),schedulesToAssgn=Object.keys(hashMaps),schedulesToAssgnLen=schedulesToAssgn.length,i=0;i<schedulesToAssgnLen;i++){for(hashMapsCrefLen=(hashMapObjRef=hashMaps[sParam=schedulesToAssgn[i]]).cRef.length,ii=0;ii<hashMapsCrefLen;ii++)makeAssignment(sParam,cParam=hashMapObjRef.cRef[ii]),toggleColorsOnOff(sParam,cParam,"on");scheduleData[sParam].dayOff=hashMapObjRef.dayOff,docElId("off"+hashMapObjRef.dayOff+sParam).style.color="#2c3e50",updateCatListOnSchedule(sParam),checkTooFewCourses(sParam)}}function pdfCatColor(catListToArr,targetCat){var returnObj={text:" "+targetCat,color:config.pdfCourseColors[catListToArr.indexOf(targetCat)]||""};return catListToArr.length&&targetCat!==catListToArr[catListToArr.length-1]&&(returnObj.text=" "+targetCat+", "),returnObj}function addTchrsToClinicInstances(){for(var kRef,assigndClinics=stats.indexData.courses.map(function(el){if("CLINIC"===courseData[el].cat&&""!==courseData[el].assgn)return courseData[el]}).filter(function(el){return void 0!==el}),len=assigndClinics.length,i=0;i<len;i++)(kRef=assigndClinics[i]).tchr="unassigned",scheduleData[kRef.assgn].hasOwnProperty("tchr")&&""!==scheduleData[kRef.assgn].tchr&&(kRef.tchr=scheduleData[kRef.assgn].tchr);return assigndClinics}function formatClinicInstances(){var defArr,clinicsForPdfObj,i,insts=addTchrsToClinicInstances(),defs=stats.indexData.klinics.map(function(el){return el.name}),clinicsForPdf=[];for(uniqueValues(defs),i=0;i<defs.length;i++)(defArr=insts.filter(function(el){return el.name===defs[i]})).length&&((clinicsForPdfObj={}).def=defs[i],clinicsForPdfObj.inst=defArr,clinicsForPdf.push(clinicsForPdfObj));return clinicsForPdf}function makePDFinit(elId){var fileName,myWorker={},rightNow=cleanWsReturnUnderscores((new Date).toDateString()),rightNow=("dlklinicpdf"===elId?(fileName="PrintClinics_"+rightNow+".pdf",buildClinicsPDF):(fileName="PrintSchedules_"+rightNow+".pdf",buildPDF))();docElId(elId).className+=" disabled";try{myWorker=new Worker("pdfWorker.js")}catch(e){return}myWorker.onmessage=function(result){window.saveAs(result.data.pdfBlob,fileName),docElId(elId).className=cleanClssLstRemove(docElId(elId).className,"disabled")},myWorker.postMessage(rightNow)}function handleCourseFile(evt){evt=evt.target.files[0];"csv"!==evt.name.substring(evt.name.length-3)?(docElId("inputFile").reset(),window.mscAlert({title:"Error",subtitle:"File is not .csv!"})):window.Papa.parse(evt,{worker:!0,header:!0,dynamicTyping:!1,encoding:"",skipEmptyLines:!0,complete:function(results){for(var requiredHeaders=[csvStrings.courseCat,csvStrings.courseNum,csvStrings.courseTime,csvStrings.courseRm],missingHeader=[!1,""],i=0;i<requiredHeaders.length;i++)if(-1===results.meta.fields.indexOf(requiredHeaders[i])){missingHeader[0]=!0,missingHeader[1]=requiredHeaders[i];break}!0===missingHeader[0]?(courseData={},window.mscAlert({title:"Error",subtitle:'Your file is missing the required header: "'+missingHeader[1]+'"'})):convertCsvDataToCourseData(results.data,results.meta.fields),docElId("inputFile").reset(),hideEl("parsing")}})}function handleAddedCourses(evt){evt=evt.target.files[0];"csv"!==evt.name.substring(evt.name.length-3)?(docElId("freshFile").reset(),window.mscAlert({title:"Error",subtitle:"Not a valid .csv file."})):window.Papa.parse(evt,{worker:!0,header:!0,dynamicTyping:!1,encoding:"",skipEmptyLines:!0,complete:function(results){var i,requiredHeaders=[csvStrings.courseCat,csvStrings.courseNum,csvStrings.courseTime,csvStrings.courseRm],missingHeader=[!1,""],hasTeachers=!1;for(stats.newDepts=[],stats.newKlinicDefs=[],stats.newCourses=[],stats.overwriteCourses=[],i=0;i<requiredHeaders.length;i++)if(-1===results.meta.fields.indexOf(requiredHeaders[i])){missingHeader[0]=!0,missingHeader[1]=requiredHeaders[i];break}!0===missingHeader[0]?(removeNewCourseArrays(),window.mscAlert({title:"Error",subtitle:'Your file is missing the required header: "'+missingHeader[1]+'"'})):(-1!==results.meta.fields.indexOf(csvStrings.courseTchr)&&(hasTeachers=!0),convertNewAddedCsvData(results.data,results.meta.fields,hasTeachers)),docElId("freshFile").reset(),hideEl("parsing")}})}function handleTeacherFile(evt){evt=evt.target.files[0];"csv"!==evt.name.substring(evt.name.length-3)?(docElId("inputTCHRS").reset(),window.mscAlert({title:"Error",subtitle:"Not a valid .csv file!"})):window.Papa.parse(evt,{header:!0,worker:!0,dynamicTyping:!1,encoding:"",skipEmptyLines:!0,complete:function(results){if(results.data.length){var i;if(!results.data[0].hasOwnProperty("teachers"))return void window.mscAlert({title:"",subtitle:'File is missing the required header: "teachers"\n("강사명" is an optional ADMIN .csv display name).'});for(i=0;i<results.data.length;i++){var dupIndex,aName=cleanNameCharsOnly(cleanTrimTrailingWs(results.data[i].teachers)),aKRname=cleanNameCharsOnly(cleanTrimTrailingWs(results.data[i]["강사명"]))||"";""!==aName&&(!0===tchrExists(aName)?""!==aKRname&&(dupIndex=stats.teachers.map(function(el){return el.en}).indexOf(aName),stats.teachers[dupIndex].kor=aKRname):addNewPersonAsTchr(aName,aKRname))}}docElId("inputTCHRS").reset()}})}function handleDeptsFile(evt){evt=evt.target.files[0];"csv"!==evt.name.substring(evt.name.length-3)?(docElId("inputDEPTS").reset(),window.mscAlert({title:"Error",subtitle:"Not a valid .csv file!"})):window.Papa.parse(evt,{header:!0,worker:!0,dynamicTyping:!1,encoding:"",skipEmptyLines:!0,complete:function(results){if(results.data.length){var i;if(!results.data[0].hasOwnProperty("shortcode"))return void window.mscAlert({title:"",subtitle:'File is missing the required header: "shortcode"\n("description" is an optional header.)'});for(i=0;i<results.data.length;i++){var dupIndex,aDept=cleanKrCharsOnly(cleanTrimTrailingWs(results.data[i].shortcode)),aDscrptn=cleanDngrChars(cleanTrimTrailingWs(results.data[i].description))||"";""!==aDept&&(!0===deptExists(aDept)?""!==aDscrptn&&(dupIndex=stats.indexData.depts.map(function(el){return el.shortcode}).indexOf(aDept),stats.indexData.depts[dupIndex].description=aDscrptn):addNewDepartment(aDept,aDscrptn))}}docElId("inputDEPTS").reset()}})}function parseJSONSettingsReset(result){var newStats;try{newStats=JSON.parse(result)[0],backUpSettings(),chkSettingsAndAssgn(newStats)}catch(e){return window.mscAlert({title:"Error",subtitle:"The JSON file you have supplied cannot be used."}),void restoreSettings()}updateSettingsInputVals(),setOverrideControls(),displayUpdatedKlinicBtns(),closeSettingsScreen(),window.mscAlert({title:"Success!",subtitle:"Settings, departments, groups, teachers and clinic definitions have been loaded from file."})}function handleJSONSettingsReset(evt){var reader,evt=evt.target.files[0];"json"!==evt.name.substring(evt.name.length-4)?(docElId("uploadJSON").reset(),window.mscAlert({title:"Error",subtitle:"Not a .json file!"})):((reader=new window.FileReader).onload=function(){parseJSONSettingsReset(reader.result)},reader.readAsText(evt),docElId("uploadJSON").reset())}function mockCoursesForTestJSONwithAutoBldr(cat){for(var cObjRef,courseDataClone={},len=stats.indexData.courses.length,i=0;i<len;i++)(cObjRef=courseData[stats.indexData.courses[i]]).cat===cat&&(courseDataClone[stats.indexData.courses[i]]={},courseDataClone[stats.indexData.courses[i]].assign="",courseDataClone[stats.indexData.courses[i]].cat=cObjRef.cat,courseDataClone[stats.indexData.courses[i]].dayhr=cObjRef.dayhr,courseDataClone[stats.indexData.courses[i]].dept=cObjRef.dept,courseDataClone[stats.indexData.courses[i]].duration=cObjRef.duration,courseDataClone[stats.indexData.courses[i]].name=cObjRef.name,courseDataClone[stats.indexData.courses[i]].rm=cObjRef.rm,courseDataClone[stats.indexData.courses[i]].times=cObjRef.times,"ninety"===cObjRef.duration)&&(courseDataClone[stats.indexData.courses[i]].allowFollow=cObjRef.allowFollow);return courseDataClone}function testJSONwithAutoBldr(){var el0,el1,el2,el3,i,aWorker={},dataArr=[],mockSettings=JSON.parse(JSON.stringify(stats.settings));for(mockSettings.overrides.maxHours=!1,i=0;i<stats.catData.length;i++)"CLINIC"!==stats.catData[i][0]&&(aWorker=new Worker("autoBldr_14.min.js"),el0=stats.indexData.schedules,el1=mockCoursesForTestJSONwithAutoBldr(stats.catData[i][0]),el2=mockSettings,el3=""+config.uiScheduleNumOfHrsPerDay,(dataArr=[]).push(el0,el1,el2,el3),el0=JSON.stringify(dataArr),aWorker.onmessage=function(result){},aWorker.onerror=function(e){throw e.preventDefault(),new Error("Cannot autoBld with this JSON.")},aWorker.postMessage(el0))}function updateCsvStringsFromJSONfile(fileObj){Object.keys(fileObj).forEach(function(prop){"string"==typeof fileObj[prop]&&""!==fileObj[prop]&&void 0!==csvStrings[prop]&&(csvStrings[prop]=fileObj[prop])})}function parseJSONresultFromFile(result,setOnly,errNum){var fileObj;try{fileObj=JSON.parse(result),!0===setOnly?(courseData={},scheduleData={},templateStats(),chkSettingsAndAssgn(fileObj[0])):(stats=fileObj[0],courseData=fileObj[1],scheduleData=fileObj[2],updateCsvStringsFromJSONfile(fileObj[3]),config.uiTimeInputStartHr=fileObj[4].uiTimeInputStartHr,config.uiScheduleNumOfHrsPerDay=fileObj[4].uiScheduleNumOfHrsPerDay,testJSONwithAutoBldr())}catch(e){return void resetFromBadJson(errNum)}try{loadStateFromData(!0)}catch(e){return resetFromBadJson(errNum),void resetTheWholeUI()}exitParsingScreen()}function handleJSONFile(evt){var reader,evt=evt.target.files[0],setOnly=docElId("settingsOnly").checked;"json"!==evt.name.substring(evt.name.length-4)?(docElId("inputJSON").reset(),docElId("settingsOnly").checked=!1,window.mscAlert({title:"Error",subtitle:"Not a .json file!"})):((reader=new window.FileReader).onload=function(){parseJSONresultFromFile(reader.result,setOnly,0)},reader.readAsText(evt),docElId("inputJSON").reset(),docElId("settingsOnly").checked=!1)}function handleRenamedCourses(evt){evt=evt.target.files[0];"csv"!==evt.name.substring(evt.name.length-3)?(docElId("inputRENAME").reset(),window.mscAlert({title:"Error",subtitle:"Not a .csv file!"})):window.Papa.parse(evt,{header:!0,dynamicTyping:!1,encoding:"",skipEmptyLines:!0,complete:function(results){var arr=[];if(results.data.length){if(!results.data[0].hasOwnProperty(csvStrings.oldNum)||!results.data[0].hasOwnProperty(csvStrings.newNum))return void window.mscAlert({title:"",subtitle:'File is missing the required headers: "'+csvStrings.oldNum+'" and "'+csvStrings.newNum+'".'});for(var i=0;i<results.data.length;i++)arr.push([cleanNumCharsOnly(cleanTrimTrailingWs(results.data[i][csvStrings.oldNum])),cleanNumCharsOnly(cleanTrimTrailingWs(results.data[i][csvStrings.newNum]))])}populateNewCourseNameInputs(arr),docElId("inputRENAME").reset()}})}function chkCoursesParsed(refObj,bool){refObj=chkCoursesforError(refObj,void 0);0<refObj&&window.mscAlert({title:"",subtitle:refObj+' course(s) contain(s) exceptions and cannot be imported.\nPlease refer to the "CSV_ERRORS" file download for details.'}),(!0===bool?buildStats:prepInsertNewCoursesFromCSV)()}function convertNewAddedCsvData(csvObj,headers,hasTeachers){for(var newCourseObj,rObj,record,len=csvObj.length,teachers=stats.teachers,errorArr=[],i=0;i<len;i++)if("CLINIC"===(record=csvObj[i])[csvStrings.courseCat])try{if((newCourseObj={cat:"CLINIC"}).name=record[csvStrings.courseNum],newCourseObj.fullname=newCourseObj.name,newCourseObj.rm={},newCourseObj.rm.a=cleanRemoveKrChars(cleanDngrCharsAndWs(record[csvStrings.courseRm])),newCourseObj.dept=singleDept(cleanKrCharsOnly(record[csvStrings.courseRm])),""===newCourseObj.dept||""===newCourseObj.name||""===newCourseObj.rm.a)throw new Error("Parsed value is empty string");stats.newKlinicDefs.push(JSON.parse(JSON.stringify(newCourseObj)))}catch(e){errorArr.push(record[csvStrings.courseCat]);continue}else try{if(newCourseObj={assgn:""},rObj=parseCsvTimeString(record[csvStrings.courseTime]),newCourseObj.dayhr=convertDayHr(rObj),newCourseObj.times=reduceTimes(rObj),newCourseObj.duration=rObj.type,"ninety"===newCourseObj.duration&&(newCourseObj.allowFollow=isNinetyBools(rObj.charArr[4],rObj.charArr[9])),newCourseObj.cat=cleanMultiWsWithSingleWs(cleanDngrChars(record[csvStrings.courseCat])),newCourseObj.dept=singleDept(record[csvStrings.courseRm]),newCourseObj.name=cleanNumCharsOnly(record[csvStrings.courseNum]),newCourseObj.rm=splitAndCleanRooms(record[csvStrings.courseRm],rObj.type,newCourseObj.dept),""===newCourseObj.cat||""===newCourseObj.dept||""===newCourseObj.name||""===newCourseObj.rm.a)throw new Error("Parsed value is empty string");!0===hasTeachers&&null==teachers.filter(function(el){return el.en===record[csvStrings.courseTchr]||el.kor===record[csvStrings.courseTchr]})[0]&&""!==record[csvStrings.courseTchr]&&stats.teachers.push({en:record[csvStrings.courseTchr],kor:record[csvStrings.courseTchr]}),stats.newCourses.push(newCourseObj)}catch(e){errorArr.push(csvObj[i]);continue}errorArr.length&&(window.mscAlert({title:"",subtitle:'Some courses contain exceptions and cannot be imported.\nPlease refer to the "CSV_ERRORS" file download for details.'}),exportCsvErrors(headers,errorArr)),chkCoursesParsed(stats.newCourses,!1)}function convertCsvDataToCourseData(csvObj,headers){var idx,rObj,record,newcObj,i,len=csvObj.length,errorArr=[];for(getConfigFromParsingScreen(),i=0;i<len;i++)if("CLINIC"!==(record=csvObj[i])[csvStrings.courseCat])try{if(idx="c"+(i+1),newcObj={assgn:""},rObj=parseCsvTimeString(record[csvStrings.courseTime]),newcObj.dayhr=convertDayHr(rObj),newcObj.times=reduceTimes(rObj),newcObj.duration=rObj.type,"ninety"===newcObj.duration&&(newcObj.allowFollow=isNinetyBools(rObj.charArr[4],rObj.charArr[9])),newcObj.cat=cleanMultiWsWithSingleWs(cleanDngrChars(record[csvStrings.courseCat])),newcObj.dept=singleDept(record[csvStrings.courseRm]),newcObj.name=cleanNumCharsOnly(record[csvStrings.courseNum]),newcObj.rm=splitAndCleanRooms(record[csvStrings.courseRm],rObj.type,newcObj.dept),""===newcObj.cat||""===newcObj.dept||""===newcObj.name||""===newcObj.rm.a)throw new Error("Parsed value is empty string");courseData[idx]=newcObj}catch(e){errorArr.push(csvObj[i]);continue}errorArr.length&&(window.mscAlert({title:"",subtitle:'Some courses contain exceptions and cannot be imported.\nPlease refer to the "CSV_ERRORS" file download for details.'}),exportCsvErrors(headers,errorArr)),chkCoursesParsed(courseData,!0)}function chkOneCourseForError(prop,idx){return!(!idx.hasOwnProperty(prop)||"assgn"!==prop&&""===idx[prop]||"name"===prop&&(idx[prop].length!==config.courseNameNumLength||Number(idx[prop])<1||Number.isNaN(Number(idx[prop])))||"dayhr"===prop&&idx[prop][0].identical(idx[prop][1]))}function chkCoursesforError(refObj,isArr){for(var flag,ii,csvChk=0,objIndexes=Object.keys(refObj),reqProps=["assgn","cat","dayhr","dept","duration","name","rm","times"],reqLen=reqProps.length,i=(objIndexes=!0===isArr?objIndexes.map(function(el){return Number(el)}):objIndexes).length-1;0<=i;i--){for(flag=!0,ii=0;ii<reqLen;ii++)chkOneCourseForError(reqProps[ii],refObj[objIndexes[i]])||(flag=!1);!1===flag&&(csvChk+=1,!0===isArr?refObj.splice(i,1):delete refObj[objIndexes[i]])}return csvChk}function splitAndCleanRooms(rmStr,cType,dept){var room={},rmStr=cleanDngrCharsAndWs(rmStr).split(dept).filter(function(el){return""!==el});return room.a=rmStr[0],1<rmStr.length&&("onehour"===cType||"ninety"===cType)&&(room.b=rmStr[1]),room}function singleDept(str){var str=str.split(/[^\u3130-\u318F\uAC00-\uD7AF]/).filter(function(el){return""!==el}),dept="error";return dept=str.length?str[0]:dept}function splitTimeStr(str){var rObj={charArr:[],type:"error"},krChars=str.split(/[^\u3130-\u318F\uAC00-\uD7AF]/).filter(function(el){return""!==el}),str=str.split(/[^0-9]/).filter(function(el){return""!==el}),kLen=krChars.length,nLen=str.length;return 2!==nLen&&4!==nLen&&8!==nLen||(2===kLen&&8===nLen&&(str.splice(0,0,krChars[0]),str.splice(5,0,krChars[1]),rObj.type="1"),1===kLen&&(4===nLen&&(rObj.type="2"),2===nLen&&(rObj.type="3"),str.unshift(krChars[0])),rObj.charArr=str),rObj}function timeWithinBounds(num,end){return num>=Number(config.uiTimeInputStartHr)&&num<end}function parseCsvTimeString(str){var str=getDuration(str),bool=!1,validEndNum=Number(config.uiTimeInputStartHr)+Number(config.uiScheduleNumOfHrsPerDay),validEndNum={onehour:validEndNum,ninety:validEndNum-1,twohour:validEndNum-1,threehour:validEndNum-2,klinichour:validEndNum};if(!0!==(bool="error"!==str.type&&(bool=timeWithinBounds(Number(str.charArr[1]),validEndNum[str.type]),"klinichour"!==str.type)&&(bool=timeWithinBounds(Number(str.charArr[3]),validEndNum[str.type]),"twohour"!==str.type)&&"threehour"!==str.type?timeWithinBounds(Number(str.charArr[6]),validEndNum[str.type])&&timeWithinBounds(Number(str.charArr[8]),validEndNum[str.type]):bool))throw new Error("Unexpected day/time values");return str}function getDuration(str){var numDiff,svnChar,ninChar,nthDiff,str=splitTimeStr(str),minChar=str.charArr[2];return"error"!==str.type&&("3"===str.type&&"00"===minChar?str.type="klinichour":("00"===minChar&&(numDiff=Number(str.charArr[3])-Number(str.charArr[1]),"50"===str.charArr[4]&&("2"===str.type&&(1===numDiff&&(str.type="twohour"),2===numDiff)&&(str.type="threehour"),"1"===str.type)&&(nthDiff=Number(str.charArr[8])-Number(str.charArr[6]),svnChar=str.charArr[7],ninChar=str.charArr[9],0===numDiff)&&0===nthDiff&&"00"===svnChar&&"50"===ninChar&&(str.type="onehour"),"15"===str.charArr[4])&&"1"===str.type&&1===numDiff&&(nthDiff=Number(str.charArr[8])-Number(str.charArr[6]),svnChar=str.charArr[7],ninChar=str.charArr[9],1===nthDiff)&&(str.type="ninety"),"30"===minChar&&"1"===str.type&&(numDiff=Number(str.charArr[3])-Number(str.charArr[1]),"45"===str.charArr[4])&&1===numDiff&&(nthDiff=Number(str.charArr[8])-Number(str.charArr[6]),svnChar=str.charArr[7],ninChar=str.charArr[9],1===nthDiff)&&(str.type="ninety"))),str}function isNinetyBools(rObj4,rObj9){var bools=[];return bools[0]=Boolean(!1),bools[1]=Boolean(!1),"15"===rObj4&&(bools[0]=Boolean(!0)),"15"===rObj9&&(bools[1]=Boolean(!0)),bools}function reduceTimes(rObj){var timeStr="";return"error"!==rObj.type&&(timeStr+=rObj.charArr[0]+""+rObj.charArr[1]+":"+rObj.charArr[2],"klinichour"!==rObj.type)&&("twohour"!==rObj.type&&"threehour"!==rObj.type||(timeStr+="-"+rObj.charArr[3]+":"+rObj.charArr[4]),"onehour"!==rObj.type&&"ninety"!==rObj.type||(timeStr+=","+rObj.charArr[5]+rObj.charArr[6]+":"+rObj.charArr[7])),timeStr}function convertDayHr(rObj){var weekObj={"월":0,"화":1,"수":2,"목":3,"금":4,"토":5},matrix=[[],[]],startHr=Number(config.uiTimeInputStartHr);if("error"!==rObj.type&&(matrix[0][0]=weekObj[rObj.charArr[0]],matrix[0][1]=Number(rObj.charArr[1])-startHr,"klinichour"!==rObj.type&&("twohour"!==rObj.type&&"threehour"!==rObj.type||(matrix[1][0]=weekObj[rObj.charArr[0]],matrix[1][1]=Number(rObj.charArr[3])-startHr),"onehour"!==rObj.type&&"ninety"!==rObj.type||(matrix[1][0]=weekObj[rObj.charArr[5]],matrix[1][1]=Number(rObj.charArr[6])-startHr)),"klinichour"===rObj.type&&(matrix[1][0]=weekObj[rObj.charArr[0]],matrix[1][1]=Number(rObj.charArr[1])-startHr),matrix[0][0]===matrix[1][0])&&matrix[0][1]===matrix[1][1]&&(rObj.type="error"),"error"===rObj.type)throw new Error("Unexpected day/time values");return matrix}function changeTchr(sParam){editSelectedTchr(sParam),hideEl("tchrsee"+sParam),showEl("tchrchg"+sParam)}function clearAssgndtchr(sParam){var el=docElId("tchrset"+sParam);"unassigned"!==el.textContent&&(el.textContent="unassigned",scheduleData[sParam].tchr="",noClrBtnIfUnassigned(sParam))}function saveTchrChange(sParam){var stsRef,len,i;if(stats.teachers.length){var assigndTchr=docElId("tchredt"+sParam).options[docElId("tchredt"+sParam).selectedIndex].value;if(""!==assigndTchr){for(len=stats.indexData.schedules.length,i=0;i<len;i++)if(stsRef=stats.indexData.schedules[i],scheduleData[stsRef].hasOwnProperty("tchr")&&stsRef!==sParam&&scheduleData[stsRef].tchr===assigndTchr)return window.mscAlert({title:"",subtitle:assigndTchr+" has already been assigned to schedule "+stsRef}),clearAssgndtchr(sParam),hideEl("tchrchg"+sParam),void showEl("tchrsee"+sParam);docElId("tchrset"+sParam).textContent=assigndTchr}else docElId("tchrset"+sParam).textContent="unassigned";scheduleData[sParam].tchr=assigndTchr}hideEl("tchrchg"+sParam),noClrBtnIfUnassigned(sParam),showEl("tchrsee"+sParam)}function noClrBtnIfUnassigned(sParam){(""!==scheduleData[sParam].tchr&&scheduleData[sParam].hasOwnProperty("tchr")?showEl:hideEl)("tchrclr"+sParam)}function editSelectedTchr(sParam){var newSecondOpt,i,selectTarget=docElId("tchredt"+sParam),frag=document.createDocumentFragment(),newFirstOpt=document.createElement("option"),len=stats.teachers.length;if(emptyContent(selectTarget),newFirstOpt.value="",newFirstOpt.textContent="select teacher",frag.appendChild(newFirstOpt),len)for(i=0;i<len;i++)(newSecondOpt=document.createElement("option")).value=""+stats.teachers[i].en,newSecondOpt.textContent=newSecondOpt.value,frag.appendChild(newSecondOpt);if(selectTarget.appendChild(frag),selectTarget.options[0].disabled=!0,scheduleData[sParam].hasOwnProperty("tchr")&&""!==scheduleData[sParam].tchr)for(i=1;i<selectTarget.options.length;i++)if(scheduleData[sParam].tchr===selectTarget.options[i].value){selectTarget.selectedIndex=i;break}}function showTchrsForEditing(){var statsRef,i,len=stats.indexData.schedules.length;for(tchrShowToggleOff(),i=0;i<len;i++)noClrBtnIfUnassigned(statsRef=stats.indexData.schedules[i]),showTchr(statsRef),showEl("tchrsee"+statsRef)}function hideTchrsForEditing(){var statsRef,i,len=stats.indexData.schedules.length;for(tchrShowToggleOn(),i=0;i<len;i++)hideEl("tchrsee"+(statsRef=stats.indexData.schedules[i])),hideTchr(statsRef),hideEl("tchrchg"+statsRef)}function tchrExists(tchr){var i,exists=!1,len=stats.teachers.length;if(len)for(i=0;i<len;i++)if(stats.teachers[i].en.toLowerCase()===tchr.toLowerCase()){exists=!0;break}return exists}function showUpdateTchrs(){var statsRef,i,len=stats.indexData.schedules.length;for(displayTchrList(),hideEl("displayOverrides"),hideEl("left"),hideEl("right"),initTchrListeners(),showEl("tchrs-section"),i=0;i<len;i++)docElId(statsRef=stats.indexData.schedules[i]).classList.contains("show-teacher")&&(showEl("tchrsee"+statsRef),hideEl("tchrchg"+statsRef))}function exitUpdateTchrs(){emptyContent(docElId("alltchrs")),hideEl("tchrs-section"),removeTchrListeners(),showEl("displayOverrides"),showEl("left"),showEl("right")}function newBlankTchr(){addNewPersonAsTchr("","")}function saveUpdatedTchrs(){var tchrObj,len,statsRef,i,alltchrs=docElId("alltchrs").childNodes;for(stats.teachers=[],i=0;i<alltchrs.length;i++)1==alltchrs[i].nodeType&&""!==alltchrs[i].childNodes[0].value&&void 0!==alltchrs[i].childNodes[0].value&&((tchrObj={}).en=alltchrs[i].childNodes[0].value,tchrObj.kor=alltchrs[i].childNodes[1].value,stats.teachers.push(tchrObj));if(stats.teachers.length){for(i=0;i<stats.teachers.length;i++)stats.teachers[i].en=cleanTrimTrailingWs(cleanNameCharsOnly(stats.teachers[i].en)),stats.teachers[i].kor=cleanTrimTrailingWs(cleanNameCharsOnly(stats.teachers[i].kor));stats.teachers.sort(function(a,b){return a.en.localeCompare(b.en)}),stats.teachers=uniqueObjs(stats.teachers,"en")}for(len=stats.indexData.schedules.length,i=0;i<len;i++)statsRef=stats.indexData.schedules[i],!scheduleData[statsRef].hasOwnProperty("tchr")||""===scheduleData[statsRef].tchr||stats.teachers.length&&-1!==stats.teachers.map(function(el){return el.en}).indexOf(scheduleData[statsRef].tchr)||clearAssgndtchr(statsRef);exitUpdateTchrs()}function deptExists(dept){var i,exists=!1,len=stats.indexData.depts.length;if(len)for(i=0;i<len;i++)if(stats.indexData.depts[i].shortcode===dept){exists=!0;break}return exists}function newBlankDept(){addNewDepartment("","")}function deleteDepartmentChk(deptCode){for(var statsRef,canDelete=!0,len=stats.indexData.courses.length,i=0;i<len;i++)if(statsRef=stats.indexData.courses[i],courseData[statsRef].dept===deptCode){canDelete=!1;break}return canDelete}function deleteDeptChkUI(elId){var canDelete=!0,elId=cleanKrCharsOnly(docElId(elId).value);return""!==elId&&!0===deptExists(elId)&&!0!==deleteDepartmentChk(elId)&&(canDelete=!1,window.mscAlert({title:"",subtitle:"The department: "+elId+" is currently assigned to one or more courses and cannot be deleted."})),canDelete}function saveUpdatedDepts(){for(var newShortcode,newDescription,targetIndex,deptObj,grpsRef,targetShortcode,ii,iii,alldepts=docElId("deptEDIT").childNodes,newDeptList=[],deletedList=[],len=alldepts.length,i=0;i<len;i++)1==alldepts[i].nodeType&&(newShortcode=cleanKrCharsOnly(alldepts[i].childNodes[0].value),newDescription=cleanDngrChars(alldepts[i].childNodes[1].value),targetIndex=stats.indexData.depts.map(function(el){return el.shortcode}).indexOf(newShortcode),void 0!==newShortcode)&&""!==newShortcode&&((deptObj={}).shortcode=newShortcode,deptObj.description=newDescription,newDeptList.push(deptObj),-1===targetIndex?stats.indexData.depts.push(deptObj):stats.indexData.depts[targetIndex].description=newDescription);for((len=stats.indexData.depts.length)&&(stats.indexData.depts.sort(function(a,b){return a.shortcode.localeCompare(b.shortcode)}),stats.indexData.depts=uniqueArrOfObjs(stats.indexData.depts,"shortcode")),i=0;i<len;i++)targetShortcode=stats.indexData.depts[i].shortcode,-1===newDeptList.map(function(el){return el.shortcode}).indexOf(targetShortcode)&&!0===deleteDepartmentChk(targetShortcode)&&deletedList.push(targetShortcode);for(len=deletedList.length,i=0;i<len;i++)for(ii=stats.indexData.depts.length-1;0<=ii;ii--)stats.indexData.depts[ii].shortcode===deletedList[i]&&stats.indexData.depts.splice(ii,1);if(populateNewCourseDepts(),(grpsRef=stats.settings.deptGrps).length&&len)for(i=0;i<len;i++)for(ii=0;ii<grpsRef.length;ii++)for(iii=grpsRef[ii].length-1;0<=iii;iii--)grpsRef[ii][iii]===deletedList[i]&&grpsRef[ii].splice(iii,1);chkDeptGrpsAfterEdit(),(docElId("setting-section").classList.contains("nodisplay")?displayUpdatedDeptGroups:(getAllDeptsOnUI(),rebuildDeptGrpString))(),exitEDITdepts()}function deptHelpInfo(sParam){for(var uniqueDepts,assgndDepts=[],elRef=scheduleData[sParam].cRef,len=elRef.length,i=0;i<len;i++)assgndDepts.push(courseData[elRef[i]].dept);for(assgndDepts.sort(),len=(uniqueDepts=uniqueValues(assgndDepts)).length,i=0;i<len;i++)uniqueDepts[i]="\n"+uniqueDepts[i]+" = "+deptRef(uniqueDepts[i]);return uniqueDepts}function deptRef(dept){var lookupValue=stats.indexData.depts.filter(function(el){return el.shortcode===dept})[0];return null==lookupValue?"":lookupValue.description}function getNewDeptsFromCSV(){for(var deptObj,len=stats.newCourses.length,i=0;i<len;i++)null!=stats.newCourses[i]&&-1===stats.indexData.depts.map(function(el){return el.shortcode}).indexOf(stats.newCourses[i].dept)&&((deptObj={}).shortcode=stats.newCourses[i].dept,deptObj.description="",stats.newDepts.push(deptObj));1<stats.newDepts.length&&(stats.newDepts.sort(function(a,b){return a.shortcode.localeCompare(b.shortcode)}),stats.newDepts=uniqueArrOfObjs(stats.newDepts,"shortcode"))}function pushNewDeptsFromCSV(){var i,len=stats.newDepts.length;if(len){for(i=0;i<len;i++)stats.indexData.depts.push(stats.newDepts[i]);1<stats.indexData.depts.length&&stats.indexData.depts.sort(function(a,b){return a.shortcode.localeCompare(b.shortcode)}),stats.newDepts=[]}delete stats.newDepts}function defineDeptGrp(optId,bool){var grpIndex=Number(docElId("newgroupid").dataset.grpindex),optId=docElId(optId),deptName=optId.dataset.deptname,stsRef=stats.settings.deptGrps;!0===bool?(optId.style.backgroundColor="#3498db",optId.style.color="#ffffff",optId.style.borderColor="#3498db",stsRef.length&&stsRef[grpIndex]||stats.settings.deptGrps.push([]),-1===stsRef[grpIndex].indexOf(deptName)&&stats.settings.deptGrps[grpIndex].push(deptName)):(optId.style.backgroundColor="",optId.style.color="",optId.style.borderColor="",(stsRef=stats.settings.deptGrp)[grpIndex]&&stsRef[grpIndex].length&&-1!==stsRef[grpIndex].indexOf(deptName)&&stats.settings.deptGrps[grpIndex].splice(stats.settings.deptGrps[grpIndex].indexOf(deptName),1))}function deleteDeptGroupViaUI(el){var indexForDeletion;el.target!==el.currentTarget&&"remove"==el.target.id.substring(0,6)&&(indexForDeletion=Number(el.target.id.substring(6)),stats.settings.deptGrps[indexForDeletion])&&rebuildDeptGrpDefinitions(indexForDeletion),el.stopPropagation()}function rebuildDeptGrpDefinitions(indexForDeletion){stats.settings.deptGrps.splice(indexForDeletion,1),docElId("newgroupid").dataset.grpindex=stats.settings.deptGrps.length,rebuildDeptGrpString()}function defineKlinics(){stats.indexData.depts.length?(hideEl("displayOverrides"),docElId("left").style.visibility="hidden",docElId("right").style.visibility="hidden",initKlinicListeners(),initKlinicsEditing(),showEl("defineklinics")):window.mscAlert({title:"",subtitle:"Please define at least one department first.\n(New course or category -> Edit departments)"})}function exitUpdateKlinics(){hideEl("defineklinics"),removeKlinicListeners(),editorHandlerOff(),docElId("left").style.visibility="visible",docElId("right").style.visibility="visible",showEl("displayOverrides")}function clearKlinicInputs(elId){elId=elId.substring(6);docElId("klnm_"+elId).value="",docElId("klfn_"+elId).value="",hideEl("kl_"+elId)}function dupsChk(dupsArr,bool){var i;if(!0===bool)for(i=0;i<dupsArr.length;i++)dupsArr[i]=dupsArr[i].toLowerCase();return dupsArr.length!==uniqueValues(dupsArr).length}function holdKlinic(){docElId("klinicHold").checked?stats.tempKlinic.isHeld=!0:stats.tempKlinic.isHeld=!1}function klinicLock(state){docElId("klinicHold").checked="on"===state,holdKlinic()}function klinicDayHrToStr(dayHrId){return""+config.monToSatKr[dayHrId[0]]+("0"+(dayHrId[1]+Number(config.uiTimeInputStartHr))).slice(-2)+":00"}function klinicCatChk(){var i,len=stats.catData.length;if(len)for(i=0;i<len;i++)if("CLINIC"===stats.catData[i][0])return;stats.catData.push(["CLINIC",0,buildDefaultScheduleUiArr(0)]),displayNewCat(len=stats.catData.length),docElId("courselist"+len).setAttribute("class","show")}function makeNewKlinicRef(elId,tempKlinicName){var container,i,newcParam=createOneKlinic(elId,tempKlinicName),len=stats.catData.length;if(null!=newcParam){for(i=0;i<len;i++)if(stats.catData[i][0]===courseData[newcParam[1]].cat){container=i+1;break}displayNewCourseRef(newcParam[1],container),setAssignmentViaUI(newcParam[0],newcParam[1])}}function findInKlinics(el){el.target!==el.currentTarget&&"kldel_"===el.target.id.substring(0,6)&&clearKlinicInputs(el.target.id)}function pushNewKlinicDefsFromCSV(){var i,len=stats.newKlinicDefs.length;if(len){for(catExists("CLINIC")||createNewCat(!1,"CLINIC"),i=0;i<len;i++)-1===stats.indexData.klinics.map(function(el){return el.name}).indexOf(stats.newKlinicDefs[i].name)&&stats.indexData.klinics.push(stats.newKlinicDefs[i]);stats.indexData.klinics.sort(function(a,b){return a.name.localeCompare(b.name)}),stats.newKlinicDefs=[]}delete stats.newKlinicDefs}function chkLocalStorage(){var stats=window.localStorage.getItem("lastStats"),cData=window.localStorage.getItem("lastCourseData"),sData=window.localStorage.getItem("lastScheduleData"),csvStr=window.localStorage.getItem("lastCsvStrs"),cfg=window.localStorage.getItem("lastCfg");null===stats||null===cData||null===sData||null===cfg?window.mscAlert({title:"",subtitle:"No previous session available."}):parseJSONresultFromFile("["+stats+","+cData+","+sData+(null!==csvStr?","+csvStr:",{}")+(","+cfg+"]"),!1,1)}function saveToLocalStorage(){var removeCount,cfg,i;if(!isObjEmpty(stats)&&stats.hasOwnProperty("catData")){if(stats.catData.length){for(i=stats.catData.length-1;0<=i;i--)"$deleted"===stats.catData[i][0].substring(0,8)&&stats.catData.splice(i,1);for(removeCount=0,stats.indexData.schedules.length>stats.indexData.courses.length/(stats.settings.maxHours/2)&&(removeCount=stats.indexData.schedules.length-Math.round(stats.indexData.courses.length/(stats.settings.maxHours/2))),i=stats.indexData.schedules.length-1;0<=i;i--)if(!scheduleData[stats.indexData.schedules[i]].cRef.length&&6===scheduleData[stats.indexData.schedules[i]].dayOff){if(--removeCount<=0)break;delete scheduleData[stats.indexData.schedules[i]],stats.indexData.schedules.splice(i,1)}}(cfg={}).uiTimeInputStartHr=config.uiTimeInputStartHr,cfg.uiScheduleNumOfHrsPerDay=config.uiScheduleNumOfHrsPerDay,window.localStorage.clear(),window.localStorage.setItem("lastStats",JSON.stringify(stats)),window.localStorage.setItem("lastCourseData",JSON.stringify(courseData)),window.localStorage.setItem("lastScheduleData",JSON.stringify(scheduleData)),window.localStorage.setItem("lastCsvStrs",JSON.stringify(csvStrings)),window.localStorage.setItem("lastCfg",JSON.stringify(cfg))}}function resetFromBadJson(errNum){stats={},courseData={},scheduleData={},csvStrings={courseCat:setDefaultCsvString("courseCat"),courseNum:setDefaultCsvString("courseNum"),courseTime:setDefaultCsvString("courseTime"),courseRm:setDefaultCsvString("courseRm"),courseTchr:setDefaultCsvString("courseTchr"),oldNum:setDefaultCsvString("oldNum"),newNum:setDefaultCsvString("newNum")},getConfigFromParsingScreen(),docElId("inputJSON").reset(),docElId("settingsOnly").checked=!1,docElId("configStartHr").disabled=!1,docElId("configNumOfHrsPerDay").disabled=!1,showEl("parsing"),window.mscAlert({title:"",subtitle:["The JSON file you have supplied cannot be used.","The last saved session is unusable and has been deleted."][errNum]}),1===errNum&&window.localStorage.clear()}function backUpSettings(){window.localStorage.setItem("statsBkUp",JSON.stringify(stats))}function restoreSettings(){var storedStats=JSON.parse(window.localStorage.getItem("statsBkUp"));stats={},isObjEmpty(storedStats)||(stats=storedStats),window.localStorage.removeItem("statsBkUp")}function createFileAndDownload(fileName,fileType,data){fileName=fileName+"_"+cleanWsReturnUnderscores((new Date).toDateString())+"."+fileType,data="csv"===fileType?window.Papa.unparse(data):data,data=new Blob([data],{type:config.uriTypes[fileType]});window.saveAs(data,fileName)}function exportCsvErrors(headers,arr){var csvObj={fields:[],data:[]};csvObj.fields=headers,csvObj.data=arr,createFileAndDownload("CSV_ERRORS","csv",csvObj)}function dayhrAsStr(num,modifier){return("0"+(num+Number(config.uiTimeInputStartHr)+modifier).toString()).slice(-2)}function saveCourseDataAsCSV(){for(var kTchrIdx,cRef,csvObj={fields:[csvStrings.courseCat,csvStrings.courseNum,csvStrings.courseTchr,"대상학과",csvStrings.courseTime,csvStrings.courseRm],data:[]},replaceVal=["월","화","수","목","금","토"],len=stats.indexData.courses.length,tMap={},record=[],i=0;i<len;i++)cRef=courseData[stats.indexData.courses[i]],tMap.tmeStr="",tMap.rmStr="",tMap.numStr="00",record=[cRef.cat,cRef.name,"","","",""],tMap.krDay0=replaceVal[cRef.dayhr[0][0]],tMap.krDay1=replaceVal[cRef.dayhr[1][0]],tMap.dyhr01=cRef.dayhr[0][1],tMap.dyhr11=cRef.dayhr[1][1],tMap.sRef=scheduleData[cRef.assgn],""!==cRef.assgn&&tMap.sRef.hasOwnProperty("tchr")&&(-1!==(kTchrIdx=stats.teachers.map(function(el){return el.en}).indexOf(tMap.sRef.tchr))&&""!==stats.teachers[kTchrIdx].kor?record[2]=stats.teachers[kTchrIdx].kor:record[2]=tMap.sRef.tchr),"onehour"===cRef.duration&&(tMap.numStr=dayhrAsStr(tMap.dyhr01,0),tMap.tmeStr+=tMap.krDay0+"("+tMap.numStr+":00∼"+tMap.numStr+":50) ",tMap.numStr=dayhrAsStr(tMap.dyhr11,0),tMap.tmeStr+=tMap.krDay1+"("+tMap.numStr+":00∼"+tMap.numStr+":50)"),"twohour"!==cRef.duration&&"threehour"!==cRef.duration||(tMap.numStr=dayhrAsStr(tMap.dyhr01,0),tMap.tmeStr+=tMap.krDay0+"("+tMap.numStr+":00∼","twohour"===cRef.duration&&(tMap.numStr=dayhrAsStr(tMap.dyhr01,1)),"threehour"===cRef.duration&&(tMap.numStr=dayhrAsStr(tMap.dyhr01,2)),tMap.tmeStr+=tMap.numStr+":50)"),"ninety"===cRef.duration&&(tMap.numStr=dayhrAsStr(tMap.dyhr01,0),tMap.tmeStr+=tMap.krDay0+"("+tMap.numStr,tMap.numStr=dayhrAsStr(tMap.dyhr01,1),!0===cRef.allowFollow[0]&&(tMap.tmeStr+=":00∼"+tMap.numStr+":15) "),!1===cRef.allowFollow[0]&&(tMap.tmeStr+=":30∼"+tMap.numStr+":45) "),tMap.numStr=dayhrAsStr(tMap.dyhr11,0),tMap.tmeStr+=tMap.krDay1+"("+tMap.numStr,tMap.numStr=dayhrAsStr(tMap.dyhr11,1),!0===cRef.allowFollow[1]&&(tMap.tmeStr+=":00∼"+tMap.numStr+":15)"),!1===cRef.allowFollow[1])&&(tMap.tmeStr+=":30∼"+tMap.numStr+":45)"),"klinichour"===cRef.duration&&(tMap.numStr=dayhrAsStr(tMap.dyhr01,0),tMap.tmeStr+=tMap.krDay0+"("+tMap.numStr+":00∼"+tMap.numStr+":50)"),record[4]=tMap.tmeStr,tMap.rmStr=cRef.dept+cRef.rm.a,cRef.rm.hasOwnProperty("b")&&cRef.rm.a!==cRef.rm.b&&(tMap.rmStr+=" "+cRef.dept+cRef.rm.b),record[5]=tMap.rmStr,csvObj.data.push(record);createFileAndDownload("AllCourseData_","csv",csvObj)}function saveSessionAsJSON(){var i,removeCount=0,statsClone=JSON.parse(JSON.stringify(stats)),scheduleDataClone=JSON.parse(JSON.stringify(scheduleData)),cfg={uiTimeInputStartHr:config.uiTimeInputStartHr,uiScheduleNumOfHrsPerDay:config.uiScheduleNumOfHrsPerDay},TEXTdoc=[];if(statsClone.catData.length)for(i=statsClone.catData.length-1;0<=i;i--)"$deleted"===statsClone.catData[i][0].substring(0,8)&&statsClone.catData.splice(i,1);for(statsClone.indexData.schedules.length>statsClone.indexData.courses.length/(statsClone.settings.maxHours/2)&&(removeCount=statsClone.indexData.schedules.length-Math.round(statsClone.indexData.courses.length/(statsClone.settings.maxHours/2))),i=statsClone.indexData.schedules.length-1;0<=i;i--)if(!scheduleDataClone[statsClone.indexData.schedules[i]].cRef.length&&6===scheduleDataClone[statsClone.indexData.schedules[i]].dayOff){if(--removeCount<=0)break;delete scheduleDataClone[statsClone.indexData.schedules[i]],statsClone.indexData.schedules.splice(i,1)}TEXTdoc.push(statsClone),TEXTdoc.push(courseData),TEXTdoc.push(scheduleDataClone),TEXTdoc.push(csvStrings),TEXTdoc.push(cfg),createFileAndDownload("Schedules_","json",JSON.stringify(TEXTdoc))}function addDeptsFromGrpArrIfNotExist(arr){var el,i,len=arr.length;if(len&&stats.hasOwnProperty("indexData")&&stats.indexData.hasOwnProperty("depts"))for(i=0;i<arr.length;i++)!0!==deptExists(el=arr[i])&&stats.indexData.depts.push({shortcode:el,description:""})}function chkSettingsAndAssgn(jsonObj){var idx,objRef,arrRef,i,ii;if(!jsonObj.hasOwnProperty("settings"))throw new Error("Prop 'settings' is undefined.");if(!jsonObj.settings.hasOwnProperty("overrides"))throw new Error("Prop 'overrides' is undefined.");if("day"!==jsonObj.settings.deptGrpsSetBy&&"week"!==jsonObj.settings.deptGrpsSetBy||(stats.settings.deptGrpsSetBy=jsonObj.settings.deptGrpsSetBy),jsonObj.settings.maxHours<=5*config.uiScheduleNumOfHrsPerDay&&(stats.settings.maxHours=jsonObj.settings.maxHours),jsonObj.settings.maxHrsPerDay<=config.uiScheduleNumOfHrsPerDay&&(stats.settings.maxHrsPerDay=jsonObj.settings.maxHrsPerDay),2!==jsonObj.settings.maxSeqHrs&&3!==jsonObj.settings.maxSeqHrs||(stats.settings.maxSeqHrs=jsonObj.settings.maxSeqHrs),Object.keys(jsonObj.settings.overrides).forEach(function(prop){"boolean"==typeof jsonObj.settings.overrides[prop]&&void 0!==stats.settings.overrides[prop]&&(stats.settings.overrides[prop]=jsonObj.settings.overrides[prop])}),jsonObj.settings.hasOwnProperty("deptGrps")&&jsonObj.settings.deptGrps.length)for(i=0;i<jsonObj.settings.deptGrps.length;i++)if((arrRef=jsonObj.settings.deptGrps[i].map(function(el){return cleanKrCharsOnly(el)}).filter(function(elem){return""!==elem})).length){for(idx=-1,ii=0;ii<stats.settings.deptGrps.length;ii++)if(arrRef.identical(stats.settings.deptGrps[ii])){idx=1;break}1!==idx&&(addDeptsFromGrpArrIfNotExist(arrRef),stats.settings.deptGrps.push(arrRef))}if(jsonObj.hasOwnProperty("teachers")&&jsonObj.teachers.length)for(i=0;i<jsonObj.teachers.length;i++){if(!jsonObj.teachers[i].hasOwnProperty("en"))throw new Error("Prop 'en' is undefined.");jsonObj.teachers[i].en=cleanNameCharsOnly(jsonObj.teachers[i].en),""!==(objRef=jsonObj.teachers[i]).en&&(!1===tchrExists(objRef.en)?stats.teachers.push(objRef):stats.teachers[idx].kor=objRef.kor||stats.teachers[idx].kor)}if(jsonObj.hasOwnProperty("indexData")){if(jsonObj.indexData.hasOwnProperty("klinics")&&jsonObj.indexData.klinics.length)for(i=0;i<jsonObj.indexData.klinics.length;i++){if(!jsonObj.indexData.klinics[i].hasOwnProperty("name"))throw new Error("Prop 'name' is undefined.");if(!jsonObj.indexData.klinics[i].hasOwnProperty("fullname"))throw new Error("Prop 'fullname' is undefined.");if(!jsonObj.indexData.klinics[i].hasOwnProperty("dept"))throw new Error("Prop 'dept' is undefined.");if(!jsonObj.indexData.klinics[i].hasOwnProperty("rm"))throw new Error("Prop 'rm' is undefined.");if(!jsonObj.indexData.klinics[i].rm.hasOwnProperty("a"))throw new Error("Prop 'rm.a' is undefined.");if(jsonObj.indexData.klinics[i].dept=cleanKrCharsOnly(jsonObj.indexData.klinics[i].dept),jsonObj.indexData.klinics[i].rm.a=cleanRemoveKrChars(cleanDngrCharsAndWs(jsonObj.indexData.klinics[i].rm.a)),""===jsonObj.indexData.klinics[i].dept)throw new Error("Value of 'dept' is an empty string.");if(""===jsonObj.indexData.klinics[i].rm.a)throw new Error("Value of 'rm.a' is an empty string.");objRef=jsonObj.indexData.klinics[i],-1===(idx=stats.indexData.klinics.map(function(el){return el.name}).indexOf(objRef.name))?(jsonObj.indexData.hasOwnProperty("depts")&&!1===deptExists(jsonObj.indexData.klinics[i].dept)&&jsonObj.indexData.depts.push(jsonObj.indexData.klinics[i].dept),stats.indexData.klinics.push(objRef)):(stats.indexData.klinics[idx].fullname=objRef.fullname,stats.indexData.klinics[idx].dept=objRef.dept,stats.indexData.klinics[idx].rm={},stats.indexData.klinics[idx].rm.a=objRef.rm.a)}if(jsonObj.indexData.hasOwnProperty("depts")&&jsonObj.indexData.depts.length)for(i=0;i<jsonObj.indexData.depts.length;i++){if(!jsonObj.indexData.depts[i].hasOwnProperty("shortcode"))throw new Error("Prop 'shortcode' is undefined.");jsonObj.indexData.depts[i].shortcode=cleanKrCharsOnly(jsonObj.indexData.depts[i].shortcode),""!==(objRef=jsonObj.indexData.depts[i]).shortcode&&(!1===deptExists(objRef.shortcode)?stats.indexData.depts.push(objRef):stats.indexData.depts[idx].description=objRef.description||stats.indexData.depts[idx].description)}}}function getErrorsForCreateOneCourse(idx,cName){cName=["Please choose a "+config.courseNameNumLength+" digit course name greater than zero.","A course named : "+cName+" already exists.\nPlease choose a different name.","Please define all parameters.","Classes cannot have overlapping times!","Both classes cannot start at the same time!"];window.mscAlert({title:"",subtitle:cName[idx]})}function createOneCourse(){var i,dParam=defineNewCourseDuration(),valObj=defineNewCourseStrings(dParam),dayHrMapParam=getNewDayHrMap(dParam),newCourseId="c1",len=stats.indexData.courses.length;if(len&&(newCourseId="c"+(Number(stats.indexData.courses[len-1].substring(1))+1)),valObj.newName.length!==config.courseNameNumLength||Number(valObj.newName)<1||Number.isNaN(Number(valObj.newName)))return getErrorsForCreateOneCourse(0),"nada";for(i=0;i<len;i++)if(courseData[stats.indexData.courses[i]].name===valObj.newName)return getErrorsForCreateOneCourse(1,valObj.newName),"nada";if(""===valObj.newName||""===valObj.newCat||""===valObj.newDept||""===valObj.newRm.a)return getErrorsForCreateOneCourse(2),"nada";if("ninety"===dParam&&dayHrMapParam[0][0][0]===dayHrMapParam[0][1][0])if(dayHrMapParam[0][0][1]+1===dayHrMapParam[0][1][1]){if(!0!==dayHrMapParam[1][0]||!0===dayHrMapParam[1][0]&&!1!==dayHrMapParam[1][1])return getErrorsForCreateOneCourse(3),"nada"}else if(dayHrMapParam[0][0][1]===dayHrMapParam[0][1][1]+1&&(!0!==dayHrMapParam[1][1]||!0===dayHrMapParam[1][1]&&!1!==dayHrMapParam[1][0]))return getErrorsForCreateOneCourse(3),"nada";if(dayHrMapParam[0][0].identical(dayHrMapParam[0][1]))return getErrorsForCreateOneCourse(4),"nada";for(stats.indexData.courses.push(newCourseId),courseData[newCourseId]={},courseData[newCourseId].cat=valObj.newCat,courseData[newCourseId].dept=valObj.newDept,courseData[newCourseId].rm={},courseData[newCourseId].rm.a=valObj.newRm.a,valObj.newRm.hasOwnProperty("b")&&(courseData[newCourseId].rm.b=valObj.newRm.b),courseData[newCourseId].dayhr=dayHrMapParam[0],courseData[newCourseId].name=valObj.newName,courseData[newCourseId].times=valObj.newTimes,courseData[newCourseId].duration=dParam,courseData[newCourseId].assgn="",dayHrMapParam[1].length&&(courseData[newCourseId].allowFollow=dayHrMapParam[1]),i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===courseData[newCourseId].cat){stats.catData[i][1]+=1,stats.catData[i][2][courseData[newCourseId].dayhr[0][0]][courseData[newCourseId].dayhr[0][1]]+=1,stats.catData[i][2][courseData[newCourseId].dayhr[1][0]][courseData[newCourseId].dayhr[1][1]]+=1,"threehour"===courseData[newCourseId].duration&&(stats.catData[i][2][courseData[newCourseId].dayhr[0][0]][courseData[newCourseId].dayhr[0][1]+1]+=1);break}return newCourseId}function createOneCourseFromCSV(newCourseId,cObj){var i;for(stats.indexData.courses.push(newCourseId),courseData[newCourseId]={},courseData[newCourseId].cat=cObj.cat,courseData[newCourseId].dept=cObj.dept,courseData[newCourseId].rm={},courseData[newCourseId].rm.a=cObj.rm.a,cObj.rm.hasOwnProperty("b")&&(courseData[newCourseId].rm.b=cObj.rm.b),courseData[newCourseId].dayhr=cObj.dayhr,courseData[newCourseId].name=cObj.name,courseData[newCourseId].times=cObj.times,courseData[newCourseId].duration=cObj.duration,courseData[newCourseId].assgn="",cObj.hasOwnProperty("allowFollow")&&(courseData[newCourseId].allowFollow=cObj.allowFollow),i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===courseData[newCourseId].cat){stats.catData[i][1]+=1,stats.catData[i][2][courseData[newCourseId].dayhr[0][0]][courseData[newCourseId].dayhr[0][1]]+=1,stats.catData[i][2][courseData[newCourseId].dayhr[1][0]][courseData[newCourseId].dayhr[1][1]]+=1,"threehour"===courseData[newCourseId].duration&&(stats.catData[i][2][courseData[newCourseId].dayhr[0][0]][courseData[newCourseId].dayhr[0][1]+1]+=1);break}}function insertNewCoursesFromCSV(bool){var ovwrRef,cRef,cParam,sParam,i,ii,highestCourseNum=0;if(pushNewDeptsFromCSV(),!0===bool)for(i=stats.overwriteCourses.length-1;0<=i;i--)for(ii=stats.indexData.courses.length-1;0<=i;ii--)if(ovwrRef=stats.overwriteCourses[i],cRef=courseData[stats.indexData.courses[ii]],ovwrRef.name===cRef.name){ovwrRef.cat!==cRef.cat&&(stats.newCourses.push(ovwrRef),stats.overwriteCourses.splice(i,1),deleteCourseNoWarning(stats.indexData.courses[ii]));break}if(stats.indexData.courses.length&&(highestCourseNum=Number(stats.indexData.courses[stats.indexData.courses.length-1].substring(1))),stats.newCourses.length)for(i=0;i<stats.newCourses.length;i++)catExists((cRef=stats.newCourses[i]).cat)||createNewCat(!1,cRef.cat),createOneCourseFromCSV("c"+ ++highestCourseNum,cRef);if(pushNewKlinicDefsFromCSV(),!0===bool)for(i=0;i<stats.overwriteCourses.length;i++)cParam=objKeyFromPropVal((ovwrRef=stats.overwriteCourses[i]).name,courseData),(sParam=""+(cRef=courseData[cParam]).assgn)&&removeAssignmentViaUI(sParam,cParam),cRef.dept=ovwrRef.dept,cRef.rm={},cRef.rm.a=ovwrRef.rm.a,ovwrRef.rm.hasOwnProperty("b")&&(cRef.rm.b=ovwrRef.rm.b),cRef.dayhr=ovwrRef.dayhr,cRef.times=ovwrRef.times,cRef.duration=ovwrRef.duration,ovwrRef.hasOwnProperty("allowFollow")&&(cRef.allowFollow=ovwrRef.allowFollow),sParam&&(makeAssignment(sParam,cParam),canAssignHereChk(sParam,cParam)||(toggleColorsOnOff(sParam,cParam,"on"),updateCatListOnSchedule(sParam),checkTooFewCourses(sParam,cParam)));isObjEmpty(scheduleData)?(stats.indexData.schedules=[],defineInitBlankSchedules(!0)):defineInitBlankSchedules(!1),removeNewCourseArrays(),resetTheWholeUI(),loadStateFromData(!0),exitChangesToCourse()}function updateKlinicInstances(klinicObj){for(var sRef,cRef,i=0;i<stats.indexData.courses.length;i++)sRef=stats.indexData.courses[i],"CLINIC"===(cRef=courseData[sRef]).cat&&cRef.name===klinicObj.name&&(cRef.fullname=klinicObj.fullname,cRef.dept=klinicObj.dept,cRef.rm={},cRef.rm.a=klinicObj.rm.a,rebuildKlinicReference(sRef))}function errorsForSaveUpdatedKlinics(idx){window.mscAlert({title:"",subtitle:["Each nickname can contain only English or Korean characters.","Please complete each full name with an appropriate description.","Please select the department.","Please check that each nickname is unique","Please check that each definition is unique."][idx]})}function saveUpdatedKlinics(){for(var kObj,kDefEl,dupNameChk,dupParamsChk,kIdx,ii,allKlinicDefs=docElId("klinic-section").childNodes,holdingArr=[],removalsArr=[],i=0;i<allKlinicDefs.length;i++)1==(kDefEl=allKlinicDefs[i]).nodeType&&((kObj={}).name=cleanRemoveAllWs(cleanNameCharsOnly(kDefEl.childNodes[0].value)),kObj.fullname=cleanDngrCharsAndWs(kDefEl.childNodes[1].value),kObj.dept=kDefEl.childNodes[2].value,kObj.rm={},kObj.rm.a=cleanAlphaNumericAndDashOnlyChars(kDefEl.childNodes[3].value),holdingArr.push(kObj));if(holdingArr.length){for(dupNameChk=[],dupParamsChk=[],i=holdingArr.length-1;0<=i;i--)if(""===holdingArr[i].name&&""===holdingArr[i].fullname)holdingArr.splice(i,1);else{if(""===holdingArr[i].name)return void errorsForSaveUpdatedKlinics(0);if(""===holdingArr[i].fullname)return void errorsForSaveUpdatedKlinics(1);if(""===holdingArr[i].dept)return void errorsForSaveUpdatedKlinics(2);dupNameChk.push(holdingArr[i].name),dupParamsChk.push(""+holdingArr[i].fullname+holdingArr[i].dept+holdingArr[i].rm.a)}if(!0===dupsChk(dupNameChk,!1))return void errorsForSaveUpdatedKlinics(3);if(!0===dupsChk(dupParamsChk,!0))return void errorsForSaveUpdatedKlinics(4)}for(1<holdingArr.length&&holdingArr.sort(function(a,b){return a.name.localeCompare(b.name)}),i=0;i<stats.indexData.klinics.length;i++)-1===(kIdx=holdingArr.map(function(el){return el.name}).indexOf(stats.indexData.klinics[i].name))?removalsArr.push(stats.indexData.klinics[i].name):updateKlinicInstances(holdingArr[kIdx]);if(removalsArr.length)for(i=removalsArr.length-1;0<=i;i--)for(ii=stats.indexData.courses.length-1;0<=ii;ii--)kObj=stats.indexData.courses[ii],"CLINIC"===courseData[kObj].cat&&courseData[kObj].name===removalsArr[i]&&deleteCourseNoWarning(kObj);for(stats.indexData.klinics=[],i=0;i<holdingArr.length;i++)stats.indexData.klinics.push(holdingArr[i]);exitUpdateKlinics()}function createOneKlinic(elId,tempKlinicName){var dayHrArr,dayHrId,kIdx,i,elId=buildTokens(elId),newCourseId="c1";if(4===elId.length&&0===elId[1]&&(dayHrId=[elId[2],elId[3]],(dayHrArr=[]).push(dayHrId,dayHrId),stats.indexData.courses.length&&(newCourseId="c"+(Number(stats.indexData.courses[stats.indexData.courses.length-1].substring(1))+1)),kIdx=stats.indexData.klinics.map(function(el){return el.name}).indexOf(tempKlinicName),stats.indexData.klinics.length)&&-1!==kIdx){for(tempKlinicName=stats.indexData.klinics[kIdx],stats.indexData.courses.push(newCourseId),courseData[newCourseId]={},courseData[newCourseId].cat="CLINIC",courseData[newCourseId].dept=tempKlinicName.dept,courseData[newCourseId].rm={},courseData[newCourseId].rm.a=tempKlinicName.rm.a,courseData[newCourseId].dayhr=dayHrArr,courseData[newCourseId].name=tempKlinicName.name,courseData[newCourseId].fullname=tempKlinicName.fullname,courseData[newCourseId].times=klinicDayHrToStr(dayHrId),courseData[newCourseId].duration="klinichour",courseData[newCourseId].assgn="",i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===courseData[newCourseId].cat){stats.catData[i][1]+=1,stats.catData[i][2][courseData[newCourseId].dayhr[0][0]][courseData[newCourseId].dayhr[0][1]]+=1;break}return!1===stats.tempKlinic.isHeld&&(stats.tempKlinic.kbtn=""),[elId[0],newCourseId]}}function preFlightBuildStats(){for(var cObjRef,kObj,uniqueNewNames=[],klinicDefinitions=[],noOfKlinics=0,courseKeys=Object.keys(courseData),i=0;i<courseKeys.length;i++)"CLINIC"===(cObjRef=courseData[courseKeys[i]]).cat?(noOfKlinics+=1,(kObj={}).name=cObjRef.name,kObj.fullname=cObjRef.name,kObj.dept=cObjRef.dept,kObj.rm={},kObj.rm.a=cObjRef.rm.a,klinicDefinitions.push(kObj)):uniqueNewNames.push(cObjRef.name);return uniqueNewNames.sort(),uniqueNewNames=uniqueValues(uniqueNewNames),courseKeys.length-noOfKlinics!==uniqueNewNames.length?(stats={},courseData={},scheduleData={},resetTheWholeUI(),window.mscAlert({title:"",subtitle:"Please check that each course has a unique name (ID).\nSome new course names are duplicates."}),!1):!(klinicDefinitions.length&&0<noOfKlinics)||(klinicDefinitions.sort(function(a,b){return a.name.localeCompare(b.name)}),uniqueArrOfObjs(klinicDefinitions,"name"))}function displayNewCourseRef(cParam,container){var frag=document.createDocumentFragment(),firstDiv=document.createElement("div"),secondDiv=document.createElement("div"),thirdDiv=document.createElement("div"),fourthDiv=document.createElement("div"),firstSpan=document.createElement("span"),secondSpan=document.createElement("span"),thirdSpan=document.createElement("span"),fourthSpan=document.createElement("span"),elText=courseData[cParam].name+" - "+courseData[cParam].dept+courseData[cParam].rm.a;courseData[cParam].rm.hasOwnProperty("b")&&(elText+="/"+courseData[cParam].dept+courseData[cParam].rm.b),elText+=" - "+courseData[cParam].times,"ninety"===courseData[cParam].duration&&(elText+=" - (90분)"),elText=document.createTextNode(elText),firstDiv.id="contain"+cParam,firstDiv.className="row",secondDiv.className="col-lg-12",thirdDiv.id="ref"+cParam,thirdDiv.className="whitecircle",fourthDiv.id="edredit-"+cParam,fourthDiv.className="nodisplay",firstSpan.id="edrinit-"+cParam,firstSpan.className="btn-xs btn-warning pull-left nodisplay",firstSpan.textContent="Edit",secondSpan.id="edrsave-"+cParam,secondSpan.className="btn-xs btn-primary pull-left nodisplay",secondSpan.textContent="Save",thirdSpan.id="sSgn"+cParam,thirdSpan.className="sSgnd",fourthSpan.id="edrdel-"+cParam,fourthSpan.className="btn btn-xs btn-danger pull-right nodisplay",fourthSpan.textContent="✖","CLINIC"===courseData[cParam].cat&&(fourthDiv.className+=" disabled",firstSpan.className+=" disabled",secondSpan.className+=" disabled",fourthSpan.className+=" disabled"),thirdDiv.appendChild(elText),thirdDiv.appendChild(thirdSpan),secondDiv.appendChild(firstSpan),secondDiv.appendChild(secondSpan),secondDiv.appendChild(thirdDiv),secondDiv.appendChild(fourthDiv),secondDiv.appendChild(fourthSpan),firstDiv.appendChild(secondDiv),frag.appendChild(firstDiv),docElId("courselist"+container).appendChild(frag),displayAutoBuilderIcon()}function getDataForUpdateDataFromChanges(cParam){var valsObj={};return valsObj.name=docElId("edrname-"+cParam).value,valsObj.dept=docElId("edrdept-"+cParam).value,valsObj.rmA=docElId("edrrm-"+cParam).value,valsObj.rmB=null!==docElId("edrrmB-"+cParam)?docElId("edrrmB-"+cParam).value:"",valsObj.timeDay1=""+docElId("edrday1-"+cParam).value+docElId("edrstart1-"+cParam).value,valsObj.timeDay2=""+docElId("edrday2-"+cParam).value+docElId("edrstart2-"+cParam).value,valsObj.idxDay1=docElId("edrday1-"+cParam).selectedIndex,valsObj.idxStart1=docElId("edrstart1-"+cParam).selectedIndex,valsObj.idxDay2=docElId("edrday2-"+cParam).selectedIndex,valsObj.idxStart2=docElId("edrstart2-"+cParam).selectedIndex,valsObj}function errorsForGetEditorValuesOnSave(idx){var errMsg=["A course with that name already exists!","Please choose a "+config.courseNameNumLength+" digit course name greater than zero.","Both classes cannot start at the same time!","Please define all parameters with appropriate values"];window.mscAlert({title:"",subtitle:errMsg[idx]})}function getEditorValuesOnSave(cParam){var uniqueName,valsObj=getDataForUpdateDataFromChanges(cParam),cObjRef=courseData[cParam],sParam="";"CLINIC"!==cObjRef.cat&&(valsObj.name=cleanNumCharsOnly(valsObj.name),uniqueName=findcRefByCourseName(valsObj.name),valsObj.rmA=cleanDngrCharsAndWs(valsObj.rmA),valsObj.rmB=cleanDngrCharsAndWs(valsObj.rmB),void 0!==uniqueName&&uniqueName!==cParam?errorsForGetEditorValuesOnSave(0):valsObj.name.length!==config.courseNameNumLength||Number(valsObj.name)<1||Number.isNaN(Number(valsObj.name))?errorsForGetEditorValuesOnSave(1):isSameDayHrSelected(cParam)?errorsForGetEditorValuesOnSave(2):""===valsObj.rmA||""===valsObj.name?errorsForGetEditorValuesOnSave(3):(""!==cObjRef.assgn&&removeAssignmentViaUI(sParam=""+cObjRef.assgn,cParam),hideEditingControls(cParam),updateDataFromChanges(cParam,valsObj)&&(rebuildcReference(cParam),reAssignAfterChange(sParam,cParam))))}function updateDataFromChanges(cParam,valsObj){var catIndex,i,cObjRef=courseData[cParam];if("CLINIC"!==cObjRef.cat){for(i=0;i<stats.catData.length;i++)if(stats.catData[i][0]===cObjRef.cat){catIndex=i;break}return cObjRef.name=valsObj.name,cObjRef.dept=valsObj.dept,cObjRef.rm.a=valsObj.rmA,cObjRef.rm.hasOwnProperty("b")&&delete cObjRef.rm.b,""!==valsObj.rmB&&valsObj.rmB!==cObjRef.rm.a&&(cObjRef.rm.b=valsObj.rmB),cParam=valsObj.timeDay1,"twohour"!==cObjRef.duration&&"threehour"!==cObjRef.duration&&(cParam+=","+valsObj.timeDay2),"threehour"===cObjRef.duration&&(cParam+="-"+(valsObj.idxStart1+11)+":50"),"twohour"===cObjRef.duration&&(cParam+="-"+(valsObj.idxStart1+10)+":50"),cObjRef.times=cParam,(cParam=[[],[]])[0].push(cObjRef.dayhr[0][0]),cParam[0].push(cObjRef.dayhr[0][1]),cParam[1].push(cObjRef.dayhr[1][0]),cParam[1].push(cObjRef.dayhr[1][1]),--stats.catData[catIndex][2][cParam[0][0]][cParam[0][1]],--stats.catData[catIndex][2][cParam[1][0]][cParam[1][1]],"threehour"===cObjRef.duration&&--stats.catData[catIndex][2][cParam[0][0]][cParam[0][1]+1],cObjRef.dayhr[0][0]=valsObj.idxDay1,"ninety"===cObjRef.duration?(cObjRef.dayhr[1][0]=valsObj.idxDay2,valsObj.idxStart1%2==1?(cObjRef.dayhr[0][1]=(valsObj.idxStart1-1)/2,cObjRef.allowFollow[0]=!1):(cObjRef.dayhr[0][1]=valsObj.idxStart1/2,cObjRef.allowFollow[0]=!0),valsObj.idxStart2%2==1?(cObjRef.dayhr[1][1]=(valsObj.idxStart2-1)/2,cObjRef.allowFollow[1]=!1):(cObjRef.dayhr[1][1]=valsObj.idxStart2/2,cObjRef.allowFollow[1]=!0)):(cObjRef.dayhr[0][1]=valsObj.idxStart1,"twohour"===cObjRef.duration||"threehour"===cObjRef.duration?(cObjRef.dayhr[1][0]=valsObj.idxDay1,"twohour"===cObjRef.duration&&(cObjRef.dayhr[1][1]=valsObj.idxStart1+1),"threehour"===cObjRef.duration&&(cObjRef.dayhr[1][1]=valsObj.idxStart1+2)):(cObjRef.dayhr[1][0]=valsObj.idxDay2,cObjRef.dayhr[1][1]=valsObj.idxStart2)),stats.catData[catIndex][2][cObjRef.dayhr[0][0]][cObjRef.dayhr[0][1]]+=1,stats.catData[catIndex][2][cObjRef.dayhr[1][0]][cObjRef.dayhr[1][1]]+=1,"threehour"===cObjRef.duration&&(stats.catData[catIndex][2][cObjRef.dayhr[0][0]][cObjRef.dayhr[0][1]+1]+=1),!0}}function formatTimeStrForNinetyMinCourse(time){var timeArr={},time=time.split(/[^(0-9)]/g).filter(function(el){return""!==el});return timeArr.a=time[0]+":"+time[1]+"-"+(Number(time[0])+1)+":"+(Number(time[1])+15),timeArr.b=time[2]+":"+time[3]+"-"+(Number(time[2])+1)+":"+(Number(time[3])+15),timeArr}function buildPDF(){for(var pdfTable,pdfDepts,pdfHeader,grid,cStrB,cStrA,cDetailsColor,drtnStr,statsRef,sObjRef,cObjRef,catListToArr,str,ii,iii,pdfObj={pageSize:"A4",content:[],styles:{default:{fontSize:10,alignment:"center"}}},len=stats.indexData.schedules.length,i=0;i<len;i++)if(statsRef=stats.indexData.schedules[i],(sObjRef=scheduleData[statsRef]).cRef.length){for(catListToArr=getCatListForSchedule(statsRef).split(", "),(pdfHeader={text:[]}).text.push(sObjRef.display+" - "),ii=0;ii<catListToArr.length;ii++)pdfHeader.text.push(pdfCatColor(catListToArr,catListToArr[ii]));for(pdfHeader.text.push("\n"),grid=buildDefaultScheduleUiArr(""),(pdfTable={style:"default",table:{widths:[],body:[]}}).table.body.push(["","Monday","Tuesday","Wednesday","Thursday","Friday"]),pdfTable.table.body.push([config.pdfBlankHr,"","","","",""]),ii=0;ii<grid[0].length;ii++)str="\n"+(config.uiTimeInputStartHr+ii)+":00-"+(config.uiTimeInputStartHr+ii)+":50",str+="\n("+(ii+1)+")",pdfTable.table.body.push([str]);for(pdfDepts={pageBreak:"after",text:[]},ii=0;ii<sObjRef.cRef.length;ii++)cStrB=""+(cObjRef=courseData[scheduleData[statsRef].cRef[ii]]).name,cStrA=""+cObjRef.name,cDetailsColor=pdfCatColor(catListToArr,cObjRef.cat),"CLINIC"===cObjRef.cat&&(cStrA=""+cObjRef.fullname),cStrA+="\n"+cObjRef.cat+"\n"+cObjRef.dept+cObjRef.rm.a,cStrB+="\n"+cObjRef.cat+"\n"+cObjRef.dept,cObjRef.rm.hasOwnProperty("b")?cStrB+=""+cObjRef.rm.b:cStrB+=""+cObjRef.rm.a,cObjRef.hasOwnProperty("allowFollow")&&(cStrA+="\n("+(drtnStr=formatTimeStrForNinetyMinCourse(cObjRef.times)).a+")",cStrB+="\n("+drtnStr.b+")"),grid[cObjRef.dayhr[0][0]][cObjRef.dayhr[0][1]]={text:cStrA,color:cDetailsColor.color},cObjRef.rm.hasOwnProperty("b")?grid[cObjRef.dayhr[1][0]][cObjRef.dayhr[1][1]]={text:cStrB,color:cDetailsColor.color}:grid[cObjRef.dayhr[1][0]][cObjRef.dayhr[1][1]]={text:cStrA,color:cDetailsColor.color},"threehour"===cObjRef.duration&&(grid[cObjRef.dayhr[0][0]][cObjRef.dayhr[0][1]+1]={text:cStrA,color:cDetailsColor.color});for(sObjRef.hasOwnProperty("tchr")&&""!==sObjRef.tchr&&pdfHeader.text.push("Instructor: "+sObjRef.tchr),pdfHeader.text.push("\n\n"),sObjRef.hasOwnProperty("isSat")?(pdfTable.table.widths=["15%","14.166%","14.166%","14.166%","14.166%","14.166%","14.166%"],pdfTable.table.body[0].push("Saturday"),pdfTable.table.body[1].push("")):pdfTable.table.widths=["15%","17%","17%","17%","17%","17%"],ii=2;ii<pdfTable.table.body.length;ii++)for(iii=0;iii<pdfTable.table.widths.length-1;iii++)pdfTable.table.body[ii].push(grid[iii][ii-2]);pdfDepts.text=deptHelpInfo(statsRef),pdfObj.content.push(pdfHeader),pdfObj.content.push(pdfTable),pdfObj.content.push(pdfDepts)}return JSON.stringify(pdfObj)}function buildClinicsPDF(){for(var str,cDetails,ii,iii,clinicObj=formatClinicInstances(),pdfObj={pageSize:"A4",content:[],styles:{default:{fontSize:10,alignment:"center"}}},len=clinicObj.length,i=0;i<len;i++)if(clinicObj[i].inst.length){var clinicName=clinicObj[i].inst[0].fullname,enDept=deptRef(clinicObj[i].inst[0].dept),clinicName={text:(clinicName=""===clinicName?clinicObj[i].def:clinicName)+" clinic - "+clinicObj[i].inst[0].rm.a+" "+enDept+"\n\n"},pdfTable={style:"default",table:{widths:[],body:[]}},grid=buildDefaultScheduleUiArr("");for((pdfTable={style:"default",table:{widths:[],body:[]}}).table.body.push(["","Monday","Tuesday","Wednesday","Thursday","Friday"]),pdfTable.table.body.push([config.pdfBlankHr,"","","","",""]),ii=0;ii<grid[0].length;ii++)str="\n"+(config.uiTimeInputStartHr+ii)+":00-"+(config.uiTimeInputStartHr+ii)+":50",str+="\n("+(ii+1)+")",pdfTable.table.body.push([str]);for(enDept={pageBreak:"after",text:[]},ii=0;ii<clinicObj[i].inst.length;ii++)(cDetails={text:"\n"}).text+=""+clinicObj[i].inst[ii].tchr,"unassigned"===clinicObj[i].inst[ii].tchr&&(cDetails.color=config.pdfCourseColors[2]),grid[clinicObj[i].inst[ii].dayhr[0][0]][clinicObj[i].inst[ii].dayhr[0][1]].hasOwnProperty("text")&&(cDetails.color=config.pdfCourseColors[1],cDetails.text+=grid[clinicObj[i].inst[ii].dayhr[0][0]][clinicObj[i].inst[ii].dayhr[0][1]].text),grid[clinicObj[i].inst[ii].dayhr[0][0]][clinicObj[i].inst[ii].dayhr[0][1]]=cDetails;for(clinicObj[i].inst.hasOwnProperty("isSat")?(pdfTable.table.widths=["15%","14.166%","14.166%","14.166%","14.166%","14.166%","14.166%"],pdfTable.table.body[0].push("Saturday"),pdfTable.table.body[1].push("")):pdfTable.table.widths=["15%","17%","17%","17%","17%","17%"],ii=2;ii<pdfTable.table.body.length;ii++)for(iii=0;iii<pdfTable.table.widths.length-1;iii++)pdfTable.table.body[ii].push(grid[iii][ii-2]);pdfObj.content.push(clinicName),pdfObj.content.push(pdfTable),pdfObj.content.push(enDept)}return JSON.stringify(pdfObj)}function resetTheWholeUI(){var frag=document.createDocumentFragment(),frag2=document.createDocumentFragment(),newOpt=document.createElement("option"),newOpt2=document.createElement("option");emptyContent(docElId("schedule-instances")),emptyContent(docElId("references")),emptyContent(docElId("newcoursecat")),emptyContent(docElId("newcoursedept")),newOpt.textContent="select",newOpt.value="",newOpt2.textContent="select",newOpt2.value="",frag.appendChild(newOpt),frag2.appendChild(newOpt2),docElId("newcoursecat").appendChild(frag),docElId("newcoursedept").appendChild(frag2),docElId("newcoursecat").options[0].disabled=!0,docElId("newcoursedept").options[0].disabled=!0}function makeNewCourseRef(){var container,newcParam,i,len=stats.catData.length;if(len){if("nada"!==(newcParam=createOneCourse())){for(docElId("newcoursename").value="",docElId("newcourseroom").value="",docElId("newcourseroomB").value="",docElId("newcoursecat").selectedIndex=0,docElId("newcoursedept").selectedIndex=0,docElId("newdayone").selectedIndex=0,docElId("newhrsone").selectedIndex=0,docElId("newdaytwo").selectedIndex=0,i=docElId("newhrstwo").selectedIndex=0;i<len;i++)if(stats.catData[i][0]===courseData[newcParam].cat){container=i+1;break}displayNewCourseRef(newcParam,container),window.mscConfirm({title:"Success!",subtitle:"Course: "+courseData[newcParam].name+" has been created.\nCreate another?",cancelText:"Exit",onOk:function(){},onCancel:function(){exitChangesToCourse(),scrollToCourse(newcParam)}})}}else window.mscAlert({title:"",subtitle:"At least one category must be defined before a course can be created."})}function defineTimeArrForPopulateClassTimes(){for(var hr,times={arr:[],lastEl:""},arrLen=config.uiScheduleNumOfHrsPerDay-1,i=0;i<arrLen;i++)hr=("0"+(config.uiTimeInputStartHr+i)).slice(-2),times.arr.push(hr+":00"),times.arr.push(hr+":30");return times.lastEl+=config.uiTimeInputStartHr+(config.uiScheduleNumOfHrsPerDay-1)+":00",times}function populateClassTimes(durationTime){var newOpt,newOpt2,newSecondOpt,newSecondOpt2,newLastOpt2,arrEl,i,times=defineTimeArrForPopulateClassTimes(),timeArr=times.arr,len=timeArr.length,frag=document.createDocumentFragment(),frag2=document.createDocumentFragment();if(emptyContent(docElId("newhrsone")),emptyContent(docElId("newhrstwo")),"ninety"===durationTime)for(i=0;i<len;i++)arrEl=timeArr[i],newOpt=document.createElement("option"),newOpt2=document.createElement("option"),newOpt.value=arrEl,newOpt.textContent=arrEl,newOpt2.value=arrEl,newOpt2.textContent=arrEl,frag.appendChild(newOpt),frag2.appendChild(newOpt2);else{for(i=0;i<len;i+=2)arrEl=timeArr[i],newSecondOpt=document.createElement("option"),newSecondOpt2=document.createElement("option"),newSecondOpt.value=arrEl,newSecondOpt.textContent=arrEl,newSecondOpt2.value=arrEl,newSecondOpt2.textContent=arrEl,frag.appendChild(newSecondOpt),frag2.appendChild(newSecondOpt2);"threehour"===durationTime&&frag.removeChild(frag.lastChild),"onehour"===durationTime&&(durationTime=document.createElement("option"),newLastOpt2=document.createElement("option"),durationTime.value=times.lastEl,durationTime.textContent=times.lastEl,newLastOpt2.value=times.lastEl,newLastOpt2.textContent=times.lastEl,frag.appendChild(durationTime),frag2.appendChild(newLastOpt2))}docElId("newhrsone").appendChild(frag),docElId("newhrstwo").appendChild(frag2)}function disableUIforDeletedCat(catNumber){var frag=document.createDocumentFragment(),firstSpan=document.createElement("span"),secondSpan=document.createElement("span"),recycleSpan=document.createElement("span");emptyContent(docElId("catcontain"+catNumber)),emptyContent(docElId("catref"+catNumber)),emptyContent(docElId("courselist"+catNumber)),firstSpan.id="catedt"+catNumber,firstSpan.className="catedt btn-xs btn-warning pull-left nodisplay",firstSpan.textContent="Edit",firstSpan.style.display="none",secondSpan.id="bldr"+catNumber,secondSpan.className="autobuilder pull-right icon-flash nodisplay",secondSpan.style.display="none",recycleSpan.id="recycle"+catNumber,recycleSpan.className="pull-right recycler icon-recycle",recycleSpan.style.display="none",frag.appendChild(firstSpan),frag.appendChild(secondSpan),frag.appendChild(recycleSpan),docElId("catref"+catNumber).appendChild(frag),docElId("list"+catNumber).style.display="none",docElId("catcontain"+catNumber).style.display="none",docElId("catref"+catNumber).style.display="none",docElId("courselist"+catNumber).style.display="none"}function newScheduleUI(newScheduleId,day){var i,ii,arr=buildDefaultScheduleUiArr(0),daysArr=config.monToSatEn.slice(),percent="p16c",frag=document.createDocumentFragment(),firstDiv=document.createElement("div"),secondDiv=document.createElement("div"),thirdDiv=document.createElement("div"),fourthDiv=document.createElement("div"),fifthDiv=document.createElement("div"),sixthDiv=document.createElement("div"),seventhDiv=document.createElement("div"),twelfthDiv=document.createElement("div"),firstSpan=document.createElement("span"),recycleSpan=document.createElement("span"),secondSpan=document.createElement("span"),thirdSpan=document.createElement("span"),fourthSpan=document.createElement("span"),newSelect=document.createElement("select"),newOpt=document.createElement("option");for("Sat"!==day&&(arr.pop(),daysArr.pop(),percent="p20c"),firstDiv.id=""+newScheduleId,firstDiv.className="col-lg-3 col-md-3 col-sm-3 col-xs-3 bordered",secondDiv.className="row text-center",secondDiv.style.paddingLeft="43px",secondDiv.textContent=scheduleData[newScheduleId].display,firstSpan.id="del"+newScheduleId,firstSpan.className="btn btn-xs btn-danger pull-right",firstSpan.textContent="✖",recycleSpan.id="reset"+newScheduleId,recycleSpan.className="btn btn-xs icon-recycle pull-right",thirdDiv.className="row text-center",fourthDiv.id="tchrsee"+newScheduleId,fourthDiv.className="tchrsee nodisplay",secondSpan.id="tchrclr"+newScheduleId,secondSpan.className="btn-xs btn-warning pull-left",secondSpan.textContent="Clear",thirdSpan.id="tchrset"+newScheduleId,thirdSpan.className="btn-xs btn-whiteBlue tchrset",thirdSpan.textContent="unassigned",fifthDiv.id="tchrchg"+newScheduleId,fifthDiv.className="tchrchg nodisplay",fourthSpan.id="tchrsve"+newScheduleId,fourthSpan.className="btn btn-xs btn-primary pull-left",fourthSpan.textContent="Save",newSelect.id="tchredt"+newScheduleId,newSelect.className="select-styles tchredt",newOpt.value="",newOpt.textContent="select teacher",sixthDiv.id="catlist"+newScheduleId,sixthDiv.className="row text-center cat-list",seventhDiv.className="row text-center dayofweek "+percent,twelfthDiv.className="row text-center "+percent,secondDiv.appendChild(firstSpan),secondDiv.appendChild(recycleSpan),fourthDiv.appendChild(secondSpan),fourthDiv.appendChild(thirdSpan),newSelect.appendChild(newOpt),fifthDiv.appendChild(fourthSpan),fifthDiv.appendChild(newSelect),thirdDiv.appendChild(fourthDiv),thirdDiv.appendChild(fifthDiv),i=0;i<daysArr.length;i++){var eighthDiv=document.createElement("div");eighthDiv.textContent=daysArr[i],seventhDiv.appendChild(eighthDiv)}for(firstDiv.appendChild(secondDiv),firstDiv.appendChild(thirdDiv),firstDiv.appendChild(sixthDiv),firstDiv.appendChild(seventhDiv),i=0;i<arr[0].length;i++){var tenthDiv=document.createElement("div");for(tenthDiv.className="row text-center "+percent,ii=0;ii<arr.length;ii++){var eleventhDiv=document.createElement("div");eleventhDiv.id=newScheduleId+"c0d"+[ii]+"t"+[i],eleventhDiv.textContent="0",tenthDiv.appendChild(eleventhDiv)}firstDiv.appendChild(tenthDiv)}for(i=0;i<daysArr.length;i++){var thirteenthDiv=document.createElement("div");thirteenthDiv.id="off"+[i]+newScheduleId,thirteenthDiv.className="dayoff",thirteenthDiv.textContent="▲",twelfthDiv.appendChild(thirteenthDiv)}firstDiv.appendChild(twelfthDiv),frag.appendChild(firstDiv),docElId("schedule-instances").appendChild(frag),docElId("tchredt"+newScheduleId).options[0].disabled=!0,stats.indexData.schedules.length&&docElId(stats.indexData.schedules[0]).classList.contains("show-teacher")&&(showEl("tchrsee"+newScheduleId),showTchr(newScheduleId),noClrBtnIfUnassigned(newScheduleId))}function displayNewCat(catNumber){var frag=document.createDocumentFragment(),firstDiv=document.createElement("div"),secondDiv=document.createElement("div"),thirdDiv=document.createElement("div"),fourthDiv=document.createElement("div"),firstSpan=document.createElement("span"),secondSpan=document.createElement("span"),thirdSpan=document.createElement("span"),fourthSpan=document.createElement("span"),recycleSpan=document.createElement("span"),newInput=document.createElement("input"),newCatVal=stats.catData[catNumber-1][0],newText=document.createTextNode(newCatVal);firstDiv.id="list"+catNumber,firstDiv.className=setColorFromCat(newCatVal,!0)+"courselist",secondDiv.id="catcontain"+catNumber,secondDiv.className="nodisplay",thirdDiv.id="catref"+catNumber,fourthDiv.id="courselist"+catNumber,fourthDiv.className="hide",firstSpan.id="catsve"+catNumber,firstSpan.className="btn btn-xs btn-primary pull-left",firstSpan.textContent="Rename",newInput.type="text",newInput.id="catchg"+catNumber,newInput.className="inputstyle btn-xs","CLINIC"===newCatVal&&(newInput.className+=" disabled",firstSpan.textContent="Delete only"),newInput.value=newCatVal,secondSpan.id="catdel"+catNumber,secondSpan.className="btn btn-xs btn-danger pull-right",secondSpan.textContent="✖",thirdSpan.id="catedt"+catNumber,thirdSpan.className="catedt btn-xs btn-warning pull-left nodisplay",thirdSpan.textContent="Edit",fourthSpan.id="bldr"+catNumber,fourthSpan.className="autobuilder pull-right icon-flash nodisplay",recycleSpan.id="recycle"+catNumber,recycleSpan.className="pull-right recycler icon-recycle",secondDiv.appendChild(firstSpan),secondDiv.appendChild(newInput),secondDiv.appendChild(secondSpan),thirdDiv.appendChild(thirdSpan),thirdDiv.appendChild(newText),thirdDiv.appendChild(fourthSpan),thirdDiv.appendChild(recycleSpan),firstDiv.appendChild(secondDiv),firstDiv.appendChild(thirdDiv),frag.appendChild(firstDiv),frag.appendChild(fourthDiv),docElId("references").appendChild(frag)}function populateNewCourseCats(){var newSecondOpt,stsRef,i,frag=document.createDocumentFragment(),newFirstOpt=document.createElement("option");for(emptyContent(docElId("newcoursecat")),newFirstOpt.value="",newFirstOpt.textContent="select",frag.appendChild(newFirstOpt),i=0;i<stats.catData.length;i++)"CLINIC"!==(stsRef=stats.catData[i][0])&&"$deleted"!==stsRef.substring(0,8)&&((newSecondOpt=document.createElement("option")).value=""+stsRef,newSecondOpt.textContent=stsRef,frag.appendChild(newSecondOpt));docElId("newcoursecat").appendChild(frag),docElId("newcoursecat").options[0].disabled=!0,docElId("newcoursecat").options[0].selected=!0}function populateNewCourseDepts(){var newSecondOpt,i,frag=document.createDocumentFragment(),newFirstOpt=document.createElement("option");for(emptyContent(docElId("newcoursedept")),newFirstOpt.value="",newFirstOpt.textContent="select",frag.appendChild(newFirstOpt),i=0;i<stats.indexData.depts.length;i++)(newSecondOpt=document.createElement("option")).value=""+stats.indexData.depts[i].shortcode,newSecondOpt.textContent=newSecondOpt.value,frag.appendChild(newSecondOpt);docElId("newcoursedept").appendChild(frag),docElId("newcoursedept").options[0].disabled=!0,docElId("newcoursedept").options[0].selected=!0}function openRenameAllCourses(cParam){var frag=document.createDocumentFragment(),newSpan=document.createElement("span"),newInput=document.createElement("input"),newText=document.createTextNode(" -> ");newSpan.textContent=courseData[cParam].name,newSpan.style.paddingLeft="60px",newInput.id="newName-"+cParam,newInput.type="number",newInput.className="btn-xs",newInput.style.width="60px",newInput.style.verticalAlign="middle",newInput.style.padding="2px",newInput.value="",newInput.maxLength=config.courseNameNumLength,newInput.minLength=config.courseNameNumLength,newInput.min=Math.pow(10,config.courseNameNumLength-1).toString().split("").reverse().join(""),newInput.max=""+(Math.pow(10,config.courseNameNumLength)-1),frag.appendChild(newSpan),frag.appendChild(newText),frag.appendChild(newInput),docElId("edredit-"+cParam).appendChild(frag)}function getAllDeptsOnUI(){var firstSpan,i,frag=document.createDocumentFragment();for(emptyContent(docElId("alldepartments")),i=0;i<stats.indexData.depts.length;i++)(firstSpan=document.createElement("span")).id="opt"+[i+1],firstSpan.dataset.deptname=""+stats.indexData.depts[i].shortcode,firstSpan.className="btn btn-xs btn-dept",firstSpan.textContent=stats.indexData.depts[i].shortcode,frag.appendChild(firstSpan);docElId("alldepartments").appendChild(frag)}function newBlankKlinic(){var deptOpt,i,newId=docElId("klinic-section").childNodes.length,frag=document.createDocumentFragment(),container=document.createElement("div"),firstInput=document.createElement("input"),secondInput=document.createElement("input"),firstSelect=document.createElement("select"),thirdInput=document.createElement("input"),secondSpan=document.createElement("span"),firstOpt=document.createElement("option");for(secondSpan.id="kldel_"+newId,secondSpan.className="btn btn-xs btn-danger deletex pull-right",secondSpan.textContent="✖",container.id="kl_"+newId,firstInput.id="klnm_"+newId,firstInput.type="text",firstInput.className="btn-xs",firstInput.style.width="90px",firstInput.style.verticalAlign="middle",firstInput.style.padding="2px",firstInput.value="",firstInput.maxLength=8,firstInput.placeholder="nickname",secondInput.id="klfn_"+newId,secondInput.type="text",secondInput.className="inputStyle",secondInput.style.width="160px",secondInput.style.verticalAlign="middle",secondInput.style.padding="2px",secondInput.value="",secondInput.maxLength=32,secondInput.placeholder="full .pdf name",firstSelect.id="kldp_"+newId,firstSelect.className="select-styles",firstSelect.style.marginRight="1px",thirdInput.id="klrm_"+newId,thirdInput.type="text",thirdInput.className="inputStyle",thirdInput.style.width="80px",thirdInput.style.verticalAlign="middle",thirdInput.style.padding="2px",thirdInput.value="",thirdInput.maxLength=8,thirdInput.placeholder="room",firstOpt.value="",firstOpt.textContent="dept",firstSelect.appendChild(firstOpt),i=0;i<stats.indexData.depts.length;i++)(deptOpt=document.createElement("option")).value=""+stats.indexData.depts[i].shortcode,deptOpt.textContent=deptOpt.value,firstSelect.appendChild(deptOpt);container.appendChild(firstInput),container.appendChild(secondInput),container.appendChild(firstSelect),container.appendChild(thirdInput),container.appendChild(secondSpan),frag.appendChild(container),docElId("klinic-section").appendChild(frag),docElId("kldp_"+newId).options[0].disabled=!0}function displayUpdatedKlinicBtns(){var frag,newSpan,elName,i;if(emptyContent(docElId("klinicscontainer")),stats.tempKlinic.kbtn="",stats.indexData.klinics.length){for(frag=document.createDocumentFragment(),klinicCatChk(),i=0;i<stats.indexData.klinics.length;i++)newSpan=document.createElement("span"),elName=stats.indexData.klinics[i].name,newSpan.id="kbtn_"+elName,newSpan.className="btn btn-xs btn-whiteBlue",newSpan.textContent=elName,newSpan.style.marginRight="5px",frag.appendChild(newSpan);docElId("klinicscontainer").appendChild(frag),showEl("klinicHolder"),showEl("klinicscontainer")}else hideEl("klinicHolder")}function rebuildDeptGrpString(){var newDiv,newSpan,stsRef,i,ii,frag=document.createDocumentFragment();for(emptyContent(docElId("allgroups")),i=0;i<stats.settings.deptGrps.length;i++){for(newDiv=document.createElement("div"),(newSpan=document.createElement("span")).id="remove"+i,newSpan.className="btn btn-xs btn-danger",newSpan.textContent="delete",newDiv.textContent="(",stsRef=stats.settings.deptGrps[i],ii=0;ii<stsRef.length-1;ii++)newDiv.textContent+=stsRef[ii]+", ";newDiv.textContent+=stsRef[stsRef.length-1]+") ",newDiv.appendChild(newSpan),frag.appendChild(newDiv)}docElId("allgroups").appendChild(frag)}function displayDeptList(){var newDiv,newInput,newInput2,newSpan,i,frag=document.createDocumentFragment();for(emptyContent(docElId("deptEDIT")),i=0;i<stats.indexData.depts.length;i++)newDiv=document.createElement("div"),newInput=document.createElement("input"),newInput2=document.createElement("input"),newSpan=document.createElement("span"),newDiv.id="dpts"+[i],newInput.type="text",newInput.id="deptnm"+[i],newInput.className="inputstylenarrow disabled",newInput.value=stats.indexData.depts[i].shortcode,newInput.maxLength=8,newInput.placeholder="shortcode",newInput2.type="text",newInput2.id="ddesc"+[i],newInput2.className="inputstyle",newInput2.value=stats.indexData.depts[i].description,newInput2.maxLength=32,newInput2.placeholder="description",newSpan.id="deptdel"+[i],newSpan.className="btn btn-xs btn-danger deletex pull-right",newSpan.textContent="✖",newDiv.appendChild(newInput),newDiv.appendChild(newInput2),newDiv.appendChild(newSpan),frag.appendChild(newDiv);docElId("deptEDIT").appendChild(frag)}function addNewDepartment(str,dscrptn){var newId=docElId("deptEDIT").childNodes.length,frag=document.createDocumentFragment(),newDiv=document.createElement("div"),newInput=document.createElement("input"),newInput2=document.createElement("input"),newSpan=document.createElement("span");newDiv.id="dpts"+newId,newInput.type="text",newInput.id="deptnm"+newId,newInput.className="inputstylenarrow",newInput.value=str,newInput.maxLength=8,newInput.placeholder="shortcode",newInput2.type="text",newInput2.id="ddesc"+newId,newInput2.className="inputstyle",newInput2.value=dscrptn,newInput2.maxLength=32,newInput2.placeholder="description",newSpan.id="deptdel"+newId,newSpan.className="btn btn-xs btn-danger deletex",newSpan.textContent="✖",newDiv.appendChild(newInput),newDiv.appendChild(newInput2),newDiv.appendChild(newSpan),frag.appendChild(newDiv),docElId("deptEDIT").appendChild(frag)}function setDeptGrpViaUI(){var frag,newDiv,newSpan,i,grpIndex=Number(docElId("newgroupid").dataset.grpindex),stsRef=stats.settings.deptGrps[grpIndex],allDeptsChildren=docElId("alldepartments").childNodes;if(stsRef&&stsRef.length){for(frag=document.createDocumentFragment(),newDiv=document.createElement("div"),(newSpan=document.createElement("span")).id="remove"+grpIndex,newSpan.className="btn btn-xs btn-danger",newSpan.textContent="delete",newDiv.textContent="(",i=0;i<stsRef.length-1;i++)newDiv.textContent+=stsRef[i]+", ";newDiv.textContent+=stsRef[stsRef.length-1]+") ",newDiv.appendChild(newSpan),frag.appendChild(newDiv),docElId("allgroups").appendChild(frag),docElId("newgroupid").dataset.grpindex=stats.settings.deptGrps.length}for(i=0;i<allDeptsChildren.length;i++)1==allDeptsChildren[i].nodeType&&(allDeptsChildren[i].style.backgroundColor="",allDeptsChildren[i].style.color="",allDeptsChildren[i].style.borderColor="")}function displayTchrList(){var newDiv,newInput,newInputKR,newSpan,i,frag=document.createDocumentFragment();for(emptyContent(docElId("alltchrs")),i=0;i<stats.teachers.length;i++)newDiv=document.createElement("div"),newInput=document.createElement("input"),newInputKR=document.createElement("input"),newSpan=document.createElement("span"),newDiv.id="prsn"+[i],newInput.type="text",newInput.id="prsnnm"+[i],newInput.className="inputstyle",newInput.value=stats.teachers[i].en,newInput.maxLength=32,newInputKR.type="text",newInputKR.id="prsnKR"+[i],newInputKR.className="inputstyle",newInputKR.value=stats.teachers[i].kor,newInputKR.maxLength=32,newInputKR.placeholder="csv name",newSpan.id="prsndel"+[i],newSpan.className="btn btn-xs btn-danger deletex pull-right",newSpan.textContent="✖",newDiv.appendChild(newInput),newDiv.appendChild(newInputKR),newDiv.appendChild(newSpan),frag.appendChild(newDiv);docElId("alltchrs").appendChild(frag)}function addNewPersonAsTchr(str,KR){var newId=docElId("alltchrs").childNodes.length,frag=document.createDocumentFragment(),newDiv=document.createElement("div"),newInput=document.createElement("input"),newInputKR=document.createElement("input"),newSpan=document.createElement("span");newDiv.id="prsn"+newId,newInput.type="text",newInput.id="prsnnm"+newId,newInput.className="inputstyle",newInput.value=str,newInput.maxLength=32,newInput.placeholder="new teacher",newInputKR.type="text",newInputKR.id="prsnKR"+newId,newInputKR.className="inputstyle",newInputKR.value=KR,newInputKR.maxLength=32,newInputKR.placeholder="csv name",newSpan.id="prsndel"+newId,newSpan.className="btn btn-xs btn-danger deletex",newSpan.textContent="✖",newDiv.appendChild(newInput),newDiv.appendChild(newInputKR),newDiv.appendChild(newSpan),frag.appendChild(newDiv),docElId("alltchrs").appendChild(frag)}function initKlinicsEditing(){var frag,len,kcRef,container,firstInput,secondInput,firstSelect,thirdInput,secondSpan,firstOpt,deptOpt,depart,i,ii;if(emptyContent(docElId("klinic-section")),stats.indexData.klinics.length){for(frag=document.createDocumentFragment(),len=stats.indexData.klinics.length,i=0;i<len;i++){for(container=document.createElement("div"),firstInput=document.createElement("input"),secondInput=document.createElement("input"),firstSelect=document.createElement("select"),thirdInput=document.createElement("input"),secondSpan=document.createElement("span"),firstOpt=document.createElement("option"),kcRef=stats.indexData.klinics[i],secondSpan.id="kldel_"+i,secondSpan.className="btn btn-xs btn-danger deletex pull-right",secondSpan.textContent="✖",container.id="kl_"+i,firstInput.id="klnm_"+i,firstInput.type="text",firstInput.className="btn-xs disabled",firstInput.style.width="90px",firstInput.style.verticalAlign="middle",firstInput.style.padding="2px",firstInput.value=kcRef.name,secondInput.id="klfn_"+i,secondInput.type="text",secondInput.className="inputStyle",secondInput.style.width="160px",secondInput.style.verticalAlign="middle",secondInput.style.padding="2px",secondInput.value=kcRef.fullname,secondInput.maxLength=32,secondInput.placeholder="full .pdf name",firstSelect.id="kldp_"+i,firstSelect.className="select-styles",firstSelect.style.marginRight="1px",thirdInput.id="klrm_"+i,thirdInput.type="text",thirdInput.className="inputStyle",thirdInput.style.width="80px",thirdInput.style.verticalAlign="middle",thirdInput.style.padding="2px",thirdInput.value=kcRef.rm.a,thirdInput.maxLength=8,thirdInput.placeholder="room",firstOpt.value="",firstOpt.textContent="dept",firstSelect.appendChild(firstOpt),ii=0;ii<stats.indexData.depts.length;ii++)(deptOpt=document.createElement("option")).value=stats.indexData.depts[ii].shortcode,deptOpt.textContent=deptOpt.value,firstSelect.appendChild(deptOpt);container.appendChild(firstInput),container.appendChild(secondInput),container.appendChild(firstSelect),container.appendChild(thirdInput),container.appendChild(secondSpan),frag.appendChild(container)}for(docElId("klinic-section").appendChild(frag),i=0;i<stats.indexData.klinics.length;i++)for((depart=docElId("kldp_"+i)).options[0].disabled=!0,ii=1;ii<depart.options.length;ii++)if(stats.indexData.klinics[i].dept===depart.options[ii].value){depart.selectedIndex=ii;break}}}function rebuildcReference(cParam){var cObjRef=courseData[cParam],frag=document.createDocumentFragment(),firstSpan=document.createElement("span"),elText=cObjRef.name+" - "+cObjRef.dept+cObjRef.rm.a,idStr="ref"+cParam;cObjRef.rm.hasOwnProperty("b")&&(elText+="/"+cObjRef.dept+cObjRef.rm.b),elText+=" - "+cObjRef.times,emptyContent(docElId(idStr)),"ninety"===cObjRef.duration&&(elText+=" - (90분)"),firstSpan.id="sSgn"+cParam,firstSpan.className="sSgnd",cObjRef=document.createTextNode(elText),frag.appendChild(cObjRef),frag.appendChild(firstSpan),docElId(idStr).appendChild(frag)}function rebuildKlinicReference(cParam){var cRef=courseData[cParam],newIdOne=""+cRef.assgn+cParam+"d"+cRef.dayhr[0][0]+"t"+cRef.dayhr[0][1],frag=document.createDocumentFragment(),firstSpan=document.createElement("span");docElId(newIdOne).textContent=cRef.name+"("+cRef.dept+")",emptyContent(docElId("ref"+cParam)),newIdOne=cRef.name+" - "+cRef.dept+cRef.rm.a+" - "+cRef.times,newIdOne=document.createTextNode(newIdOne),firstSpan.id="sSgn"+cParam,firstSpan.className="sSgnd",frag.appendChild(newIdOne),frag.appendChild(firstSpan),docElId("ref"+cParam).appendChild(frag),docElId("sSgn"+cParam).textContent=""+cRef.assgn}function initEditing(cParam){var times,timeArr,dayArr,frag,firstInput,secondInput,secondInputB,firstSelect,secondSelect,thirdSelect,fourthSelect,fifthSelect,newSpan,opt1,opt2,opt3,opt4,opt5,opt6,opt7,opt8,opt9,i;if("CLINIC"!==courseData[cParam].cat){for(timeArr=(times=defineTimeArrForPopulateClassTimes()).arr,dayArr=config.monToSatKr.slice(),frag=document.createDocumentFragment(),firstInput=document.createElement("input"),secondInput=document.createElement("input"),firstSelect=document.createElement("select"),secondSelect=document.createElement("select"),thirdSelect=document.createElement("select"),fourthSelect=document.createElement("select"),fifthSelect=document.createElement("select"),newSpan=document.createElement("span"),emptyContent(docElId("edredit-"+cParam)),firstInput.id="edrname-"+cParam,firstInput.type="number",firstInput.className="btn-xs",firstInput.style.width="60px",firstInput.style.verticalAlign="middle",firstInput.style.padding="2px",firstInput.value=courseData[cParam].name,firstInput.maxLength=config.courseNameNumLength,firstInput.minLength=config.courseNameNumLength,firstInput.min=Math.pow(10,config.courseNameNumLength-1).toString().split("").reverse().join(""),firstInput.max=""+(Math.pow(10,config.courseNameNumLength)-1),firstSelect.id="edrdept-"+cParam,firstSelect.className="select-styles",firstSelect.style.marginRight="1px",secondInput.id="edrrm-"+cParam,secondInput.type="text",secondInput.className="inputStyle",secondInput.style.width="80px",secondInput.style.verticalAlign="middle",secondInput.style.padding="2px",secondInput.value=courseData[cParam].rm.a,"onehour"!==courseData[cParam].duration&&"ninety"!==courseData[cParam].duration||((secondInputB=document.createElement("input")).id="edrrmB-"+cParam,secondInputB.type="text",secondInputB.className="inputStyle",secondInputB.style.width="80px",secondInputB.style.verticalAlign="middle",secondInputB.style.padding="2px",secondInputB.value=courseData[cParam].rm.b||courseData[cParam].rm.a),secondSelect.id="edrday1-"+cParam,secondSelect.className="select-styles",thirdSelect.id="edrday2-"+cParam,thirdSelect.className="select-styles",fourthSelect.id="edrstart1-"+cParam,fourthSelect.className="select-styles",fifthSelect.id="edrstart2-"+cParam,fifthSelect.className="select-styles",newSpan.id="edrduration-"+cParam,"ninety"===courseData[cParam].duration&&(newSpan.textContent=" 90분(2)"),"twohour"===courseData[cParam].duration&&(newSpan.textContent=" 2시간(1)"),"threehour"===courseData[cParam].duration&&(newSpan.textContent=" 3시간(1)"),"onehour"===courseData[cParam].duration&&(newSpan.textContent=" 1시간(2)"),i=0;i<stats.indexData.depts.length;i++)(opt1=document.createElement("option")).value=stats.indexData.depts[i].shortcode,opt1.textContent=opt1.value,firstSelect.appendChild(opt1);for(i=0;i<dayArr.length;i++)opt2=document.createElement("option"),opt3=document.createElement("option"),opt2.value=dayArr[i],opt2.textContent=opt2.value,opt3.value=opt2.value,opt3.textContent=opt2.value,secondSelect.appendChild(opt2),thirdSelect.appendChild(opt3);if("ninety"===courseData[cParam].duration)for(i=0;i<timeArr.length;i++)opt4=document.createElement("option"),opt5=document.createElement("option"),opt4.value=timeArr[i],opt4.textContent=opt4.value,opt5.value=opt4.value,opt5.textContent=opt5.value,fourthSelect.appendChild(opt4),fifthSelect.appendChild(opt5);else{for(i=0;i<timeArr.length;i+=2)opt6=document.createElement("option"),opt7=document.createElement("option"),opt6.value=timeArr[i],opt6.textContent=opt6.value,opt7.value=opt6.value,opt7.textContent=opt6.value,fourthSelect.appendChild(opt6),fifthSelect.appendChild(opt7);"threehour"===courseData[cParam].duration&&fourthSelect.removeChild(fourthSelect.lastChild),"onehour"===courseData[cParam].duration&&(opt8=document.createElement("option"),opt9=document.createElement("option"),opt8.value=times.lastEl,opt8.textContent=times.lastEl,opt9.value=times.lastEl,opt9.textContent=times.lastEl,fourthSelect.appendChild(opt8),fifthSelect.appendChild(opt9))}frag.appendChild(firstInput),frag.appendChild(firstSelect),frag.appendChild(secondInput),"onehour"!==courseData[cParam].duration&&"ninety"!==courseData[cParam].duration||frag.appendChild(secondInputB),frag.appendChild(secondSelect),frag.appendChild(fourthSelect),frag.appendChild(thirdSelect),frag.appendChild(fifthSelect),frag.appendChild(newSpan),docElId("edredit-"+cParam).appendChild(frag),setEditingDefaultVals(cParam)}}function hideEl(elId){docElId(elId).classList.contains("nodisplay")||(docElId(elId).className+=" nodisplay")}function showEl(elId){docElId(elId).className=docElId(elId).className.replace(/(?:^|\s)nodisplay(?!\S)/g,"")}function showTchr(elId){docElId(elId).classList.contains("show-teacher")||(docElId(elId).className+=" show-teacher")}function hideTchr(elId){docElId(elId).className=cleanClssLstRemove(docElId(elId).className,"show-teacher")}function showHideEl(el){el=docElId("courselist"+el.substring(6));"hide"!==el.getAttribute("class")?el.setAttribute("class","hide"):el.setAttribute("class","show")}function toggleBehaviorForUpdateCsvs(elId){var el=docElId(elId),isEditMode=el.classList.contains("btn-warning");!0===el.classList.contains("btn-primary")?updateCsvHdrs(!1,elId):!0===isEditMode&&updateCsvHdrs(!0,elId)}function toggleUpdateCsvA(){toggleBehaviorForUpdateCsvs("updateHdrsA")}function toggleUpdateCsvB(){toggleBehaviorForUpdateCsvs("updateHdrsB")}function closeSettingsScreen(){removeSettingsListeners(),getMaxHrsFromUser(),chkDeptGrpsAfterEdit(),updateSettingsUI(),hideEl("setting-section"),showEl("displayOverrides"),showEl("left"),showEl("right")}function showInfoA(){showEl("information"),hideEl("parsing")}function hideInfoA(){hideEl("information"),showEl("parsing")}function showInfoB(){showEl("information"),hideEl("displayOverrides"),hideEl("left"),hideEl("right")}function hideInfoB(){hideEl("information"),showEl("displayOverrides"),showEl("left"),showEl("right")}function showStats(){initStatsListener(),showEl("statistics"),hideEl("displayOverrides"),hideEl("left"),hideEl("right")}function hideStats(){removeStatsListener(),hideEl("statistics"),showEl("displayOverrides"),showEl("left"),showEl("right")}function addnewCourse(){hideEl("displayOverrides"),docElId("left").style.visibility="hidden",docElId("right").style.visibility="hidden",initNewCourseListeners(),showEl("newcoursemodal")}function addNewEmptyMtoFSchedule(){displayNewEmptySchedule("MtoF"),docElId("pagebottom").scrollIntoView({behavior:"smooth"})}function addNewEmptySatSchedule(){displayNewEmptySchedule("Sat"),docElId("pagebottom").scrollIntoView({behavior:"smooth"})}function genericChkBypass(prop,elId){!0===stats.settings.overrides[prop]?(stats.settings.overrides[prop]=!1,docElId(elId).className=cleanClssLstRemove(docElId(elId).className,"bypass")):(stats.settings.overrides[prop]=!0,docElId(elId).className+=" bypass")}function deptsChkBypass(){genericChkBypass("deptGrps","deptgrpsbyps")}function schedChkBypass(){genericChkBypass("maxHours","schedhrsbyps")}function dayChkBypass(){genericChkBypass("maxHrsPerDay","dayhrsbyps")}function seqChkBypass(){genericChkBypass("maxSeqHrs","seqhrsbyps")}function toggleXtraCourseInputs(state){docElId("select-styleF").style.visibility=state,docElId("select-styleG").style.visibility=state,docElId("newcourseroomB").style.visibility=state}function durationone(){populateClassTimes("onehour"),toggleXtraCourseInputs("visible")}function durationninety(){populateClassTimes("ninety"),toggleXtraCourseInputs("visible")}function durationtwo(){populateClassTimes("twohour"),toggleXtraCourseInputs("hidden")}function durationthree(){populateClassTimes("threehour"),toggleXtraCourseInputs("hidden")}function makeNewCat(){hideEl("chooseexistingcats"),showEl("choosenewcat")}function exitMakeNewCat(){showEl("chooseexistingcats"),hideEl("choosenewcat")}function updateDisplayAllCourses(){var cObjRef,statsRef,i,len=stats.indexData.courses.length;for(populateNewCourseOpts(),emptyContent(docElId("references")),displayAllCourseRefs(),i=0;i<len;i++)statsRef=stats.indexData.courses[i],""!==(cObjRef=courseData[statsRef]).assgn&&(toggleColorsOnOff(cObjRef.assgn,statsRef,"off"),toggleColorsOnOff(cObjRef.assgn,statsRef,"on")),"CLINIC"!==cObjRef.cat&&(docElId("edrinit-"+statsRef).style.display="inline-block",docElId("ref"+statsRef).style.display="inline-block")}function hideCatEdit(catNumber){showEl("catref"+catNumber),hideEl("catcontain"+catNumber)}function showCatEdit(catNumber){hideEl("catref"+catNumber),showEl("catcontain"+catNumber)}function buildTokens(idx){idx=idx.split(/[scdt]/).map(Number);return idx.shift(),idx}function shiftOrAltShiftWithClick(el,elId){var cParam=elId.substring(3);scrollToSchedule(elId),shiftKeyDepressed(el)&&("CLINIC"===courseData[cParam].cat?deleteCourseNoWarning(cParam):altKeyDepressed(el)?(stats.tempCparam=""+cParam,docElId(elId).style.backgroundColor="#2c3e50",docElId(elId).style.color="#ffffff"):removeAssignmentUsingcParam(cParam))}function hasClickedOnEditor(elId){var substr0_8=elId.substring(0,8),substr8=elId.substring(8);"edrinit-"===substr0_8?initEditing(substr8):"edrsave-"===substr0_8?getEditorValuesOnSave(substr8):"edrdel-"===elId.substring(0,7)&&destroyOneCourse(elId.substring(7))}function hasClickedOnCat(elId){var substr6=elId.substring(0,6),catname=elId.substring(6);switch(substr6){case"catedt":showCatEdit(catname);break;case"catsve":saveNewCatName(catname);break;case"catdel":triggerCatDelete(catname);break;case"catref":showHideEl(elId);break;default:return}}function findInList(el){var elId,tempCid;if(""!==stats.tempCparam){tempCid="ref"+stats.tempCparam;try{docElId(tempCid).style.backgroundColor="",docElId(tempCid).style.color=""}catch(e){stats.tempCparam=""}}if(klinicLock("off"),""!==stats.tempKlinic.kbtn&&(toggleKlinicBtn(null,"off"),stats.tempKlinic.kbtn=""),el.target!==el.currentTarget)switch((elId=el.target.id).substring(0,3)){case"rec":recycleOneCat(elId);break;case"bld":initAutoBuilder(elId);break;case"ref":shiftOrAltShiftWithClick(el,elId);break;case"cat":hasClickedOnCat(elId);break;case"edr":hasClickedOnEditor(elId);break;default:return}el.stopPropagation()}function toggleKlinicBtn(elId,state){var childEl,i,parentEl=docElId("klinicscontainer");if(parentEl.hasChildNodes())for(childEl=parentEl.childNodes,i=0;i<childEl.length;i++)childEl[i].className=cleanClssLstRemove(childEl[i].className,"active");"on"===state&&(docElId("kbtn_"+elId).className+=" active")}function handleScheduleClickedFromMap(el,elId){var cParam,tempKlinicName,elId=buildTokens(elId);4===elId.length&&(cParam="c0",0!==elId[1]&&(cParam="c"+elId[1]),0===elId[1]?""===stats.tempKlinic.kbtn?shiftKeyDepressed(el)&&altKeyDepressed(el)&&""!==stats.tempCparam?"CLINIC"!==courseData[stats.tempCparam].cat&&(setAssignmentViaUI(elId[0],stats.tempCparam),stats.tempCparam=""):toggleColor(el.target.id,elId):(tempKlinicName=""+stats.tempKlinic.kbtn,makeNewKlinicRef(el.target.id,tempKlinicName),!1===stats.tempKlinic.isHeld&&(stats.tempKlinic.kbtn="")):"CLINIC"!==courseData[cParam].cat?shiftKeyDepressed(el)?removeAssignmentUsingsParam(elId):toggleColor(el.target.id,elId):(toggleKlinicBtn(null,"off"),stats.tempKlinic.kbtn="",deleteCourseNoWarning(cParam)))}function findInMap(el){var substr3,tempCid;if(""!==stats.tempCparam){tempCid="ref"+stats.tempCparam;try{docElId(tempCid).style.backgroundColor="",docElId(tempCid).style.color=""}catch(e){stats.tempCparam=""}}""!==stats.tempKlinic.kbtn&&!1===stats.tempKlinic.isHeld&&toggleKlinicBtn(null,"off"),""===stats.tempKlinic.kbtn&&!1!==stats.tempKlinic.isHeld&&(klinicLock("off"),toggleKlinicBtn(null,"off")),el.target!==el.currentTarget&&("s"===(tempCid=el.target.id).substring(0,1)?handleScheduleClickedFromMap(el,tempCid):"del"===(substr3=tempCid.substring(0,3))?removeScheduleFromDisplay(tempCid):"off"===substr3?(shiftKeyDepressed(el)?resetDayOff:setNewDayOff)(tempCid):"tchr"===(substr3=tempCid.substring(0,4))?tchrAssgnments(tempCid):"rese"===substr3&&recycleOneSchedule(tempCid),el.stopPropagation())}function activateKlinicWhenClicked(el,elId){shiftKeyDepressed(el)?(stats.tempKlinic.kbtn="",toggleKlinicBtn(null,"off")):(stats.tempKlinic.kbtn=elId.substring(5),toggleKlinicBtn(stats.tempKlinic.kbtn,"on"))}function findInLeftMainUi(el){if(el.target!==el.currentTarget){var elId=el.target.id;if("kbtn_"===elId.substring(0,5))activateKlinicWhenClicked(el,elId);else switch(elId){case"addnewcourse":addnewCourse();break;case"renamer":initRenamingCourses();break;case"purger":purgeAllCourses();break;case"openklinics":defineKlinics();break;case"coursefinder":searchCourses();break;case"savenewCNames":verifyNewCourseNames();break;case"exitnewCNames":closeRenamingCourses();break;default:return}}el.stopPropagation()}function findInRightMainUi(el){if(el.target!==el.currentTarget){var elId=el.target.id;switch(elId){case"deptgrpsbyps":deptsChkBypass();break;case"dayhrsbyps":case"dayhrsset":dayChkBypass();break;case"downloadjson":saveSessionAsJSON();break;case"downloadcsv":saveCourseDataAsCSV();break;case"downloadpdf":case"dlklinicpdf":makePDFinit(elId);break;case"newmontofri":addNewEmptyMtoFSchedule();break;case"newmontosat":addNewEmptySatSchedule();break;case"schedhrsbyps":case"schedhrsset":schedChkBypass();break;case"seqhrsbyps":case"seqhrsset":seqChkBypass();break;case"open-settings":openSettings();break;case"updatenames":showUpdateTchrs();break;default:return}}el.stopPropagation()}function findInMakeNewCourse(el){if(el.target!==el.currentTarget)switch(el.target.id){case"newcoursecatmake":makeNewCat();break;case"savenewcat":createNewCat(!0,docElId("definenewcat").value);break;case"savecoursechanges":makeNewCourseRef();break;case"exitchoosenewcat":exitMakeNewCat();break;case"exitcoursechanges":exitChangesToCourse();break;default:return}el.stopPropagation()}function tchrAssgnments(el){var str=el.substring(4,7),sParam=el.substring(7);switch(str){case"set":changeTchr(sParam);break;case"clr":clearAssgndtchr(sParam);break;case"sve":saveTchrChange(sParam);break;default:return}}function shiftKeyDepressed(el){return!!el.shiftKey}function altKeyDepressed(el){return!!el.altKey}function clickedDayOff(el){for(var sParam=el.substring(4),i=0;i<5;i++)docElId("off"+i+sParam).style.color="";return scheduleData[sParam].hasOwnProperty("isSat")&&(docElId("off5"+sParam).style.color=""),docElId(el).style.color="#2c3e50",sParam}function toggleColor(el,elTokens){var replaceText,cParamFound,sParam="s"+elTokens[0],dayHrId=[elTokens[2],elTokens[3]];0===elTokens[1]&&("nada"!==(cParamFound=fillTimeWithFirstChoice(sParam,dayHrId))?(toggleColorsOnOff(sParam,cParamFound,"on"),updateCatListOnSchedule(sParam)):(docElId(el).textContent="X",replaceText=window.setTimeout(function(){docElId(el).textContent="0",window.clearTimeout(replaceText)},800))),0!==elTokens[1]&&("nada"!==(dayHrId=rotateToNextAvailableCourse(sParam,dayHrId,cParamFound="c"+elTokens[1]))?(toggleColorsOnOff(sParam,dayHrId,"on"),updateCatListOnSchedule(sParam)):removeAssignmentViaUI(sParam,cParamFound)),checkTooFewCourses(sParam)}function stopKlinicInterfering(){stats.indexData.klinics.length||(klinicLock("off"),toggleKlinicBtn(null,"off"),stats.tempKlinic.kbtn="")}function updateCatListOnSchedule(sParam){docElId("catlist"+sParam).textContent=getCatListForSchedule(sParam)}function setColorFromCat(catName,bool){for(var colorRef=config.alphabet,colorRefValue="",param=!0===bool?catName:courseData[catName].cat,len=stats.catData.length,i=0;i<len;i++)if(stats.catData[i][0]===param){if(i>=colorRef.length){colorRefValue=colorRef[i-colorRef.length];break}colorRefValue=colorRef[i];break}return colorRefValue}function toggleColorsOnOff(sParam,cParam,state){var oldIdOne,oldIdTwo,oldIdMid,newIdMid,newIdOne,newIdTwo,cObjRef=courseData[cParam];"off"===state?(oldIdOne=""+sParam+cParam+"d"+cObjRef.dayhr[0][0]+"t"+cObjRef.dayhr[0][1],oldIdTwo=""+sParam+cParam+"d"+cObjRef.dayhr[1][0]+"t"+cObjRef.dayhr[1][1],newIdOne=sParam+"c0d"+cObjRef.dayhr[0][0]+"t"+cObjRef.dayhr[0][1],newIdTwo=sParam+"c0d"+cObjRef.dayhr[1][0]+"t"+cObjRef.dayhr[1][1],"threehour"===cObjRef.duration&&(oldIdMid=""+sParam+cParam+"d"+cObjRef.dayhr[0][0]+"t"+(cObjRef.dayhr[0][1]+1),newIdMid=sParam+"c0d"+cObjRef.dayhr[0][0]+"t"+(cObjRef.dayhr[0][1]+1)),docElId(oldIdOne).setAttribute("id",newIdOne),docElId(newIdOne).className="",docElId(newIdOne).textContent="0","klinichour"!==cObjRef.duration&&(docElId(oldIdTwo).setAttribute("id",newIdTwo),docElId(newIdTwo).className="",docElId(newIdTwo).textContent="0"),"threehour"===cObjRef.duration&&(docElId(oldIdMid).setAttribute("id",newIdMid),docElId(newIdMid).className="",docElId(newIdMid).textContent="0")):(oldIdOne=sParam+"c0d"+cObjRef.dayhr[0][0]+"t"+cObjRef.dayhr[0][1],oldIdTwo=sParam+"c0d"+cObjRef.dayhr[1][0]+"t"+cObjRef.dayhr[1][1],newIdOne=""+sParam+cParam+"d"+cObjRef.dayhr[0][0]+"t"+cObjRef.dayhr[0][1],newIdTwo=""+sParam+cParam+"d"+cObjRef.dayhr[1][0]+"t"+cObjRef.dayhr[1][1],"threehour"===cObjRef.duration&&(oldIdMid=sParam+"c0d"+cObjRef.dayhr[0][0]+"t"+(cObjRef.dayhr[0][1]+1),newIdMid=""+sParam+cParam+"d"+cObjRef.dayhr[0][0]+"t"+(cObjRef.dayhr[0][1]+1)),docElId(oldIdOne).setAttribute("id",newIdOne),docElId(newIdOne).className="selected"+setColorFromCat(cParam,!1),docElId(newIdOne).textContent=cObjRef.name+"("+cObjRef.dept+")","klinichour"!==cObjRef.duration&&(docElId(oldIdTwo).setAttribute("id",newIdTwo),docElId(newIdTwo).className="selected"+setColorFromCat(cParam,!1),docElId(newIdTwo).textContent=cObjRef.name+"("+cObjRef.dept+")"),"threehour"===cObjRef.duration&&(docElId(oldIdMid).setAttribute("id",newIdMid),docElId(newIdMid).className="selected"+setColorFromCat(cParam,!1),docElId(newIdMid).textContent=cObjRef.name+"("+cObjRef.dept+")")),"init"!==state&&scrollToCourse(cParam),toggleCourseRef(cParam)}function findInTchrs(el){var dParam;el.target!==el.currentTarget&&"prsndel"==el.target.id.substring(0,7)&&(docElId("prsnnm"+(dParam=el.target.id.substring(7))).value="",docElId("prsn"+dParam).style.display="none"),el.stopPropagation()}function scrollToSchedule(el){var replaceColor,sParam=courseData[""+el.substring(3)].assgn;""!==sParam&&(docElId(sParam).scrollIntoView({behavior:"smooth",block:"center"}),docElId(sParam).className+=" highlight",replaceColor=window.setTimeout(function(){docElId(sParam).className=cleanClssLstRemove(docElId(sParam).className,"highlight"),window.clearTimeout(replaceColor)},3e3))}function scrollToCourse(cParam){"c0"!==cParam&&docElId("contain"+cParam).scrollIntoView({behavior:"smooth",block:"center"})}function toggleCourseRef(cParam){var activeColor,ref=docElId("ref"+cParam),sSgn=docElId("sSgn"+cParam);""===courseData[cParam].assgn?(ref.setAttribute("class","whitecircle"),sSgn.textContent=""):(activeColor="activecircle"+setColorFromCat(cParam,!1),ref.setAttribute("class",activeColor),sSgn.textContent=" "+courseData[cParam].assgn)}function displayAllCourseRefs(){for(var statsRef,catRef,tempAllCats=[],cLen=stats.catData.length,len=stats.indexData.courses.length,i=0;i<cLen;i++)catRef=stats.catData[i][0],displayNewCat(i+1),tempAllCats.push(catRef),"$deleted"===catRef.substring(0,8)&&disableUIforDeletedCat(i+1);for(i=0;i<len;i++)displayNewCourseRef(statsRef=stats.indexData.courses[i],tempAllCats.indexOf(courseData[statsRef].cat)+1);displayAutoBuilderIcon()}function displayAutoBuilderIcon(){for(var i=0;i<stats.catData.length;i++)"CLINIC"!==stats.catData[i][0]&&Number(stats.catData[i][1])>Number(stats.settings.maxHours)/2&&showEl("bldr"+[i+1])}function showOrHideEditingControls(cParam,bool){var str1="none",str2="inline-block",cObjRef=courseData[cParam];"CLINIC"!==cObjRef.cat&&(bool||(str2="none",str1="inline-block"),docElId("ref"+cParam).style.display=str1,docElId("edrinit-"+cParam).style.display=str1,"twohour"!==cObjRef.duration&&"threehour"!==cObjRef.duration||(docElId("edrday2-"+cParam).style.display="none",docElId("edrstart2-"+cParam).style.display="none"),docElId("edrsave-"+cParam).style.display=str2,docElId("edredit-"+cParam).style.display=str2,docElId("edrdel-"+cParam).style.display=str2)}function showEditingControls(cParam){showOrHideEditingControls(cParam,!0)}function hideEditingControls(cParam){showOrHideEditingControls(cParam,!1)}function displayUpdatedDeptGroups(){var i;if(docElId("deptgroupsset").textContent="",stats.settings.deptGrps.length){for(i=0;i<stats.settings.deptGrps.length-1;i++)docElId("deptgroupsset").textContent+=" "+stats.settings.deptGrps[i]+" -";docElId("deptgroupsset").textContent+=" "+stats.settings.deptGrps[stats.settings.deptGrps.length-1],showEl("deptgrpcontrol"),hideEl("nodeptgrps")}else hideEl("deptgrpcontrol"),showEl("nodeptgrps")}function updateSettingsUI(){docElId("schedhrsset").textContent=stats.settings.maxHours,docElId("dayhrsset").textContent=stats.settings.maxHrsPerDay,2===stats.settings.maxSeqHrs?docElId("seqhrsset").textContent="2-2-3(3)":docElId("seqhrsset").textContent="3-4-3(6)",togglebypassControlClass(stats.settings.overrides.deptGrps,"deptgrpsbyps"),displayUpdatedDeptGroups(),showEl("displayOverrides")}function exitChangesToCourse(){hideEl("newcoursemodal"),removeNewCourseListeners(),editorHandlerOff(),docElId("left").style.visibility="visible",docElId("right").style.visibility="visible",showEl("displayOverrides")}function findInDepts(el){var dParam,elId;el.target!==el.currentTarget&&"deptdel"==el.target.id.substring(0,7)&&!0===deleteDeptChkUI(elId="deptnm"+(dParam=el.target.id.substring(7)))&&(docElId(elId).value="",docElId("dpts"+dParam).style.display="none"),el.stopPropagation()}function findInScheduleSettings(el){el.target!==el.currentTarget&&"makegroup"===el.target.id&&setDeptGrpViaUI(),el.stopPropagation()}function findInDeptGroup(el){el.target!==el.currentTarget&&"opt"==el.target.id.substring(0,3)&&(el.shiftKey?defineDeptGrp(el.target.id,!1):defineDeptGrp(el.target.id,!0)),el.stopPropagation()}function openEditing(){var statsRef,i,len=stats.indexData.courses.length;for(docElId("left").style.width="40%",docElId("right").style.width="60%",docElId("rightsidesettings").style.width="60%",docElId("leftsidesettings").style.width="40%",docElId("right").className+=" disabled",docElId("rightsidesettings").className+=" disabled",i=0;i<len;i++)statsRef=stats.indexData.courses[i],"CLINIC"!==courseData[statsRef].cat&&(docElId("edrinit-"+statsRef).style.display="inline-block",docElId("ref"+statsRef).style.display="inline-block");for(i=0;i<stats.catData.length;i++)showEl("catedt"+[i+1])}function closeEditing(){var statsRef,i,len=stats.indexData.courses.length;for(docElId("left").style.width="",docElId("right").style.width="",docElId("rightsidesettings").style.width="",docElId("leftsidesettings").style.width="",docElId("right").className=cleanClssLstRemove(docElId("right").className,"disabled"),docElId("rightsidesettings").className=cleanClssLstRemove(docElId("rightsidesettings").className,"disabled"),i=0;i<len;i++)docElId("edredit-"+(statsRef=stats.indexData.courses[i])).hasChildNodes&&emptyContent(docElId("edredit-"+statsRef)),docElId("edrinit-"+statsRef).style.display="none",docElId("edrsave-"+statsRef).style.display="none",docElId("edredit-"+statsRef).style.display="none",docElId("edrdel-"+statsRef).style.display="none",docElId("ref"+statsRef).style.display="block";for(i=0;i<stats.catData.length;i++)hideEl("catcontain"+[i+1]),hideEl("catedt"+[i+1]),showEl("catref"+[i+1])}function initRenamingCourses(){var statsRef,i,len=stats.indexData.courses.length;for(hideEl("renamer"),i=0;i<len;i++)statsRef=stats.indexData.courses[i],"CLINIC"!==courseData[statsRef].cat&&(docElId("edredit-"+statsRef).hasChildNodes&&emptyContent(docElId("edredit-"+statsRef)),docElId("edrinit-"+statsRef).style.display="none",docElId("edrsave-"+statsRef).style.display="none",docElId("edrdel-"+statsRef).style.display="none",docElId("ref"+statsRef).style.display="none",docElId("edredit-"+statsRef).style.display="inline-block",openRenameAllCourses(statsRef));for(i=0;i<stats.catData.length;i++)showHideEl("catref"+[i+1]),hideEl("catedt"+[i+1]);showEl("newCNames"),hideEl("purger"),hideEl("addnewcourse"),hideEl("openklinics")}function closeRenamingCourses(){var statsRef,i,len=stats.indexData.courses.length;for(hideEl("newCNames"),i=0;i<len;i++)docElId("edredit-"+(statsRef=stats.indexData.courses[i])).style.display="none",docElId("edredit-"+statsRef).hasChildNodes&&emptyContent(docElId("edredit-"+statsRef)),docElId("ref"+statsRef).style.display="inline-block","CLINIC"!==courseData[statsRef].cat&&(docElId("edrinit-"+statsRef).style.display="inline-block");for(i=0;i<stats.catData.length;i++)showHideEl("catref"+[i+1]),showEl("catedt"+[i+1]);showEl("renamer"),showEl("purger"),showEl("addnewcourse"),showEl("openklinics")}function updateCsvHdrs(bool,elId){for(var elsArr=[],elsArr="updateHdrsA"===elId?["strHdr1","strHdr2","strHdr3","strHdr4"]:["strHdr5","strHdr6"],i=0;i<elsArr.length;i++)updateCsvString(elsArr[i]),docElId(elsArr[i]).disabled=!bool;!1===bool?(docElId(elId).className=cleanClssLstRemove(docElId(elId).className,"btn-primary"),docElId(elId).className+=" btn-warning",docElId(elId).textContent="edit headers",window.mscAlert({title:"",subtitle:"The csv headers have been updated."})):(docElId(elId).className=cleanClssLstRemove(docElId(elId).className,"btn-warning"),docElId(elId).className+=" btn-primary",docElId(elId).textContent="update headers")}function chkHrsPerScheduleInput(){var val=Number(docElId("hrsPerSchedule").value),color="";5*config.uiScheduleNumOfHrsPerDay<val&&(color="#d62c1a"),docElId("hrsPerSchedule").style.color=color}function chkHrsPerDayInput(){var val=Number(docElId("hrsPerDay").value),color="";config.uiScheduleNumOfHrsPerDay<val&&(color="#d62c1a"),docElId("hrsPerDay").style.color=color}function inputCourseCode(){var elId=docElId("newcoursename"),regexStr="^([0-9]{"+config.courseNameNumLength+"})$";elId.style.color=regExChkInputReturnColorStr(elId.value,regexStr)}function inputRmNum(){var elId=docElId("newcourseroom");elId.style.color=regExChkInputReturnColorStr(elId.value,"^([a-zA-Z0-9\\-\\u3130-\\u318F\\uAC00-\\uD7AF])")}function searchCourses(){var cParam,el=docElId("searchcourses");!new RegExp("^([0-9]{"+config.courseNameNumLength+"})$","g").test(el.value)||(el.style.color="",null==(cParam=findcRefByCourseName(el.value)))?(removeArrowpointer(),el.style.color="#d62c1a"):(showArrowpointer(cParam),scrollToCourse(cParam))}function showArrowpointer(cParam){removeArrowpointer(),docElId("contain"+cParam).className+=" arrow-pointer",stats.lastSearchItem=cParam}function removeArrowpointer(){var stsRef=stats.lastSearchItem,stsStr="contain"+stsRef;""!==stsRef&&void 0!==courseData[stsRef]&&(docElId(stsStr).className=cleanClssLstRemove(docElId(stsStr).className,"arrow-pointer"),stats.lastSearchItem="")}function updateScheduleDisplayNumbers(bool){for(var statsRef,len=stats.indexData.schedules.length,i=0;i<len;i++)statsRef=stats.indexData.schedules[i],scheduleData[statsRef].display="s"+(stats.indexData.schedules.indexOf(statsRef)+1);if(!0===bool)for(i=0;i<len;i++)statsRef=stats.indexData.schedules[i],document.getElementById(statsRef).childNodes[0].childNodes[0].textContent=scheduleData[statsRef].display}function togglebypassControlClass(propVal,elId){!0===propVal?docElId(elId).className+=" bypass":docElId(elId).className=cleanClssLstRemove(docElId(elId).className,"bypass")}function setOverrideControls(){togglebypassControlClass(stats.settings.overrides.deptGrps,"deptgrpsbyps"),togglebypassControlClass(stats.settings.overrides.maxHours,"schedhrsbyps"),togglebypassControlClass(stats.settings.overrides.maxHrsPerDay,"dayhrsbyps"),togglebypassControlClass(stats.settings.overrides.maxSeqHrs,"seqhrsbyps"),"week"===stats.settings.deptGrpsSetBy?docElId("deptGrpsWeekly").checked=!0:docElId("deptGrpsDaily").checked=!0,!0===stats.settings.overrides.multiCats?docElId("mlticatsyes").checked=!0:docElId("mlticatsno").checked=!0}function updateSettingsInputVals(){docElId("hrsPerSchedule").value=stats.settings.maxHours,docElId("hrsPerDay").value=stats.settings.maxHrsPerDay,2===stats.settings.maxSeqHrs?docElId("seqHrsTwo").checked=!0:docElId("seqHrsThree").checked=!0}function showEDITdepts(){displayDeptList(),docElId("setting-section").className+=" disabled",docElId("newcourseform").className+=" disabled",hideEl("hiddendeptopenL"),hideEl("hiddendeptopenR"),showEl("departments")}function exitEDITdepts(){hideEl("departments"),showEl("hiddendeptopenR"),showEl("hiddendeptopenL"),docElId("setting-section").className=cleanClssLstRemove(docElId("setting-section").className,"disabled"),docElId("newcourseform").className=cleanClssLstRemove(docElId("newcourseform").className,"disabled"),emptyContent(docElId("deptEDIT"))}function changeConfigAtParsingScreen(){var opt,i,slctStart=docElId("configStartHr"),container=docElId("configNumOfHrsPerDay"),slctStart=Number(slctStart.options[slctStart.selectedIndex].value),frag=document.createDocumentFragment();for(emptyContent(container),i=slctStart;i<23;i++)(opt=document.createElement("OPTION")).value=i+1,opt.textContent=("0"+opt.value).slice(-2)+":00",frag.appendChild(opt);container.appendChild(frag),(slctStart=container.options.length)<config.uiScheduleNumOfHrsPerDay?container.options[slctStart-1].selected=!0:container.options[config.uiScheduleNumOfHrsPerDay-1].selected=!0}function getConfigFromParsingScreen(){var startVal=Number(docElId("configStartHr").value),endVal=Number(docElId("configNumOfHrsPerDay").value);config.uiTimeInputStartHr=+startVal,config.uiScheduleNumOfHrsPerDay=endVal-startVal,9!==config.uiTimeInputStartHr&&(config.pdfBlankHr=""),docElId("configStartHr").disabled=!0,docElId("configNumOfHrsPerDay").disabled=!0}Array.prototype.identical=function(testArr){var i;if(this.length!==testArr.length)return!1;for(i=0;i<testArr.length;i++)if(this[i].identical){if(!this[i].identical(testArr[i]))return!1}else if(this[i]!==testArr[i])return!1;return!0},"onpagehide"in window?window.addEventListener("pagehide",saveToLocalStorage,!1):window.addEventListener("beforeunload",saveToLocalStorage,!1),initCoreApp();