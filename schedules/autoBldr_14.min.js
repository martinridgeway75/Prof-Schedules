!function(){"use strict";var B={},w={},x={};function f(e){for(var r,t=[],a=e.length,n=0;n<a;n++){for(r=n+1;r<a;r++)e[n]===e[r]&&(r=++n);t.push(e[n])}return t}function y(e,r,t){var a,n,d=w[x[e].cRef[t]],s=w[r];return s.hasOwnProperty("allowFollow")?d.hasOwnProperty("allowFollow")?function(e,r,t){for(var a=w[x[e].cRef[t]],n=w[r],d=[[n.dayhr[0][0],n.dayhr[0][1]+1],[n.dayhr[1][0],n.dayhr[1][1]+1]],s=[[a.dayhr[0][0],a.dayhr[0][1]+1],[a.dayhr[1][0],a.dayhr[1][1]+1]],u=0;u<2;u++){if(d[u].identical(a.dayhr[0]))return!0===n.allowFollow[u]&&!1===a.allowFollow[0];if(d[u].identical(a.dayhr[1]))return!0===n.allowFollow[u]&&!1===a.allowFollow[1];if(s[u].identical(n.dayhr[0]))return!0===a.allowFollow[u]&&!1===n.allowFollow[0];if(s[u].identical(n.dayhr[1]))return!0===a.allowFollow[u]&&!1===n.allowFollow[1]}return 1}(e,r,t):(n=[[s.dayhr[0][0],s.dayhr[0][1]+1],[s.dayhr[1][0],s.dayhr[1][1]+1]])[0].identical(d.dayhr[0])||n[1].identical(d.dayhr[1])||n[1].identical(d.dayhr[0])||n[0].identical(d.dayhr[1])?void 0:1:!d.hasOwnProperty("allowFollow")||(a=[[d.dayhr[0][0],d.dayhr[0][1]+1],[d.dayhr[1][0],d.dayhr[1][1]+1]],s.dayhr[0].identical(a[0])||s.dayhr[1].identical(a[1])||s.dayhr[1].identical(a[0])||s.dayhr[0].identical(a[1])?void 0:1)}function g(e){return""===w[e].assgn}function p(e,r){return w[r].dayhr[0][0]!==x[e].dayOff&&w[r].dayhr[1][0]!==x[e].dayOff}function v(e){for(var r,t=0,a=x[e].cRef.length,n=0;n<a;n++)"CLINIC"!==(r=w[x[e].cRef[n]]).cat&&("ninety"===r.duration||"threehour"===r.duration?t+=1.5:t+=1);return 2*t}function R(e){return e>Number(B.settings.maxHrsPerDay)}function O(e,r){var t,a,n,d,s,u,l,o,h,i,c,f,y=(t=0,a=new Array(config.uiScheduleNumOfHrsPerDay).fill(t),JSON.parse(JSON.stringify(new Array(6).fill(a)))),g=!1,p=!1;if(!0===B.settings.overrides.maxSeqHrs)return!0;if("CLINIC"===w[r].cat)return!0;for(d=w[r].dayhr[0][0],s=w[r].dayhr[1][0],u=w[r].dayhr[0][1],l=w[r].dayhr[1][1],f=0;f<x[e].cRef.length;f++)"CLINIC"!==(n=w[x[e].cRef[f]]).cat&&(o=n.dayhr[0][0],h=n.dayhr[1][0],i=n.dayhr[0][1],c=n.dayhr[1][1],d!==o&&d!==h&&s!==o&&s!==h||(y[o][i]+=1,y[h][c]+=1,"threehour"===n.duration&&(y[o][i+1]+=1)));return y[d][u]+=1,y[s][l]+=1,"twohour"===n.duration&&(g=!0),"threehour"===n.duration&&(y[d][u+1]+=1,p=g=!0),function(e,r,t){var a,n,d,s=!0,u=e.length;if(2===B.settings.maxSeqHrs)if(t){for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-2;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]&&a[d+2]===a[d+3]){s=!1;break}}else for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-1;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]){s=!1;break}if(3===B.settings.maxSeqHrs)if(r){for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-3;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]&&a[d+2]===a[d+3]&&a[d+3]===a[d+4]){s=!1;break}}else for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-2;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]&&a[d+2]===a[d+3]){s=!1;break}return s}(y,g,p)}function m(e,r){var t=w[r];return!!x[e].hasOwnProperty("isSat")||5!==t.dayhr[0][0]&&5!==t.dayhr[1][0]&&!x[e].hasOwnProperty("isSat")}function D(e,r){var t,a,n,d,s,u,l,o,h,i,c;if(!B.settings.deptGrps.length)return 1;if(!0===B.settings.overrides.deptGrps)return 1;if("CLINIC"===w[r].cat)return 1;for(t=function(e){for(var r,t=[],a=B.settings.deptGrps.length,n=0;n<a;n++)-1!==(r=B.settings.deptGrps[n]).indexOf(e)&&t.push(r);return t}(w[r].dept),a=[],d=x[e].cRef.length,i=0;i<d;i++)"CLINIC"!==(n=w[x[e].cRef[i]]).cat&&("week"===B.settings.deptGrpsSetBy&&a.push(n.dept),"day"===B.settings.deptGrpsSetBy&&(u=n.dayhr[0][0],l=n.dayhr[1][0],o=w[r].dayhr[0][0],h=w[r].dayhr[1][0],u!==o&&u!==h&&l!==o&&l!==h||a.push(n.dept)));for(a.push(w[r].dept),f(a),i=0;i<t.length;i++){for(c=s=0;c<a.length;c++)t[i].includes(a[c])&&s++;if(s===a.length)return 1}}function N(e,r){x[e].cRef.push(r),w[r].assgn=e}function s(e,r){var t,a,n,d,s,u,l,o,h,i,c,f;if(x[e].cRef.length){if(!1!=(d=r,-1===x[e].cRef.indexOf(d))&&!1!==g(r)&&!1!=(s=e,u=r,l=Number(B.settings.maxHours),o=2,!0===B.settings.overrides.maxHours||"CLINIC"===w[u].cat||("ninety"!==w[u].duration&&"threehour"!==w[u].duration||(o=3),v(s)+o<=l))&&!1!==p(e,r)&&!1!==function(e,r){var t,a,n,d,s,u,l,o;if(!0===B.settings.overrides.maxHrsPerDay)return!0;if("CLINIC"===w[r].cat)return!0;for(t=[0,0,0,0,0,0],n=x[e].cRef,d=w[r].dayhr[0][0],s=w[r].dayhr[1][0],o=0;o<n.length;o++)"CLINIC"!==(a=w[n[o]]).cat&&(u=a.dayhr[0][0],l=a.dayhr[1][0],d!==u&&d!==l&&s!==u&&s!==l||(t[u]+=1,t[l]+=1,"threehour"===a.duration&&(t[u]+=1)));return t[d]+=1,t[s]+=1,"threehour"===a.duration&&(t[d]+=1),!t.some(R)}(e,r)&&!1!==O(e,r)&&!1!==m(e,r)){for(t=0,a=x[e].cRef.length,n=0;n<a&&(h=r,i=n,f=c=void 0,c=w[x[e].cRef[i]],f=w[h],!(c.dayhr[0].identical(f.dayhr[0])||c.dayhr[1].identical(f.dayhr[1])||c.dayhr[1].identical(f.dayhr[0])||c.dayhr[0].identical(f.dayhr[1]))&&y(e,r,n)&&function(e,r,t){var a=w[x[e].cRef[t]],n=w[r],d=[];if("threehour"===n.duration){if(d.push(n.dayhr[0][0]),d.push(n.dayhr[0][1]+1),a.dayhr[0].identical(d)||a.dayhr[1].identical(d))return}else if(d.push(a.dayhr[0][0]),d.push(a.dayhr[0][1]+1),"threehour"===a.duration&&(n.dayhr[0].identical(d)||n.dayhr[1].identical(d)))return;return 1}(e,r,n));n++)t++;t===a&&D(e,r)&&N(e,r)}}else g(r)&&p(e,r)&&m(e,r)&&N(e,r)}function o(e,r){if(!x[e].cRef.length)throw new Error("Internal error: Attempted to remove an assignment that was never made: s"+e+", c"+r);var t,a;w[r].assgn===e&&-1!==x[e].cRef.indexOf(r)&&(t=e,w[a=r].assgn="",x[t].cRef.splice(x[t].cRef.indexOf(a),1))}function u(e){var r=v(e),t=!0;return(!x[e].cRef.length||r<B.settings.maxHours-1)&&(t=!1),t}function d(e,r){for(var t,a,n,d,s=[0,0,0,0,0,0],u=B.indexData.courses.length,l=0;l<u;l++)(t=w[B.indexData.courses[l]]).cat===e&&""===t.assgn&&(s[t.dayhr[0][0]]+=1,s[t.dayhr[1][0]]+=1);for(s.pop(),a=s.reduce(function(e,r){return e+r},0),n=Math.ceil(a/B.settings.maxHours),l=0;l<s.length;l++){if(!(0<s[l]))return s.fill(0),s[l]=n,[s,n,r];0<Math.round(a/s[l])?s[l]=a/s[l]:s[l]=0}for(d=s.reduce(function(e,r){return e+r},0),l=0;l<s.length;l++)s[l]=Math.round(s[l]/d*n);return[s,n,r]}function l(e){var r,t,a,n,d=[];if(B.autoBldr.schedules[e[2]].length)for(t=B.autoBldr.schedules[e[2]].length,n=0;n<t;n++)r=B.autoBldr.schedules[e[2]][n],x[r].cRef.length<B.settings.maxHours/2&&d.length<e[1]&&d.push(r);else for(t=B.indexData.schedules.length,n=0;n<t&&(r=B.indexData.schedules[n],d.length<e[1]);n++)x[r].cRef.length||d.push(r);for(n=0;n<d.length;n++)a=e[0].indexOf(e[0].reduce(function(e,r){return Math.max(e,r)})),x[d[n]].dayOff=a,0<e[0][a]&&--e[0][a];return d}function h(e){for(var r,t=e+"done",a=B.autoBldr.schedules[e].length-1;0<=a;a--)if(x[B.autoBldr.schedules[e][a]].cRef.length)if(!0!==u(B.autoBldr.schedules[e][a]))for(r=x[B.autoBldr.schedules[e][a]].cRef.length-1;0<=r;r--)o(B.autoBldr.schedules[e][a],x[B.autoBldr.schedules[e][a]].cRef[r]);else B.autoBldr[t].push(B.autoBldr.schedules[e][a])}function i(e,r){return Number(e.substring(1))-Number(r.substring(1))}function c(){for(var e,r=B.indexData.schedules.length,t=0;t<r;t++)0===(e=x[B.indexData.schedules[t]]).cRef.length&&(e.dayOff=6)}function b(e,r,t){B.autoBldr.courses=[],B.autoBldr.courses=function(e){for(var r,t,a,n=[],d=[],s=e.length,u=0;u<s;u++)t=[],r=w[e[u]],a=Number(r.rm.a.replace(/[^0-9]/g,"")),t.push(e[u],r.dept,r.dayhr[0][1],a),d.push(t);for(d.sort(function(e,r){return e[1].localeCompare(r[1])||e[2]-r[2]||e[3]-r[3]}),u=0;u<d.length;u++)n.push(d[u][0]);return n}(function(e){for(var r,t,a=[],n=B.indexData.courses.length,d=0;d<n;d++)r=B.indexData.courses[d],(t=w[r]).cat===e&&""===t.assgn&&a.push(r);return a}(e)),!0===t&&(h(r),B.autoBldr.schedules[r]=[],B.autoBldr.schedules[r]=l(d(e,r))),function(e){for(var r,t,a=B.autoBldr.schedules[e].length,n=B.autoBldr.courses.length,d=0;d<a;d++)if(!0!==u(r=B.autoBldr.schedules[e][d]))for(t=0;t<n;t++)s(r,B.autoBldr.courses[t])}(r),function(e){var r,t,a,n,d,s=[],u=[],l=B.autoBldr.schedules[e].length;for(n=0;n<l;n++)for(r=B.autoBldr.schedules[e][n],t=x[r],a=0;a<5;a++)if(s=[],t.dayOff!==a){for(d=0;d<t.cRef.length;d++)w[t.cRef[d]].dayhr[0][0]===a&&s.push([t.cRef[d],w[t.cRef[d]].dayhr[0][1]]),w[t.cRef[d]].dayhr[1][0]===a&&s.push([t.cRef[d],w[t.cRef[d]].dayhr[1][1]]);1<s.length&&(s.sort(function(e,r){return e[1]-r[1]}),s[s.length-2][1]<s[s.length-1][1]-3&&u.push(s[s.length-1][0]),s[0][1]<s[1][1]-3&&u.push(s[0][0]))}if((u=f(u)).length)for(n=0;n<u.length;n++)o(w[u[n]].assgn,u[n])}(r)}B.indexData={},B.indexData.schedules=[],B.indexData.courses=[],B.autoBldr={},B.autoBldr.schedules={},B.autoBldr.courses=[],B.settings={},Array.prototype.identical=function(e){var r;if(this.length!==e.length)return!1;for(r=0;r<e.length;r++)if(this[r].identical){if(!this[r].identical(e[r]))return!1}else if(this[r]!==e[r])return!1;return!0},onmessage=function(e){var r,t,a,n=JSON.parse(e.data);for(B.indexData.schedules=n[0],r=B.indexData.schedules.length,a=0;a<r;a++)t=B.indexData.schedules[a],x[t]={},x[t].cRef=[],x[t].dayOff=6;w=n[1],B.indexData.courses=Object.keys(w),B.settings=n[2],Number(n[3]),function(){var e=Object.keys(w)[0],r=w[e].cat,t="cat1",a=t+"done";B.hasOwnProperty("autoBldr")||(B.autoBldr={});B.autoBldr.hasOwnProperty("schedules")||(B.autoBldr.schedules={});B.autoBldr.schedules.hasOwnProperty(t)?B.hasOwnProperty("autoBldr")&&B.autoBldr.hasOwnProperty("schedules")&&B.autoBldr.schedules.hasOwnProperty(t)&&(B.autoBldr[a]=[],h(t),B.autoBldr.schedules[t]=[],B.autoBldr.schedules[t]=l(d(r,t))):(B.autoBldr.schedules[t]=[],B.autoBldr.schedules[t]=l(d(r,t)),B.autoBldr[a]=[]);!function(e,r){var t=0,a=+B.autoBldr.schedules[r].length;for(;t!==a;)t=+B.autoBldr.schedules[r].length,function(e,r){b(e,r,!1),b(e,r,!0)}(e,r),a=+B.autoBldr.schedules[r].length;!function(e,r){var t,a;for(h(r),c(),function(e){var r,t,a,n=[],d=e+"done";for(B.autoBldr[d].sort(i),f(B.autoBldr[d]),t=B.autoBldr[d].length-1;0<=t;t--)if(B.autoBldr.schedules[e].length){if(!(Number(B.autoBldr[d][t].substring(1))>Number(B.autoBldr.schedules[e][0].substring(1))))continue;for(a=x[B.autoBldr[d][t]].cRef.length-1;0<=a;a--)n.push(x[B.autoBldr[d][t]].cRef[a]);for(a=x[B.autoBldr[d][t]].cRef.length-1;0<=a;a--)o(B.autoBldr[d][t],x[B.autoBldr[d][t]].cRef[a]);for(B.autoBldr.schedules[e].push(B.autoBldr[d][t]),a=0;a<n.length;a++)s(B.autoBldr.schedules[e][0],n[a]);r=x[B.autoBldr[d][t]].dayOff,x[B.autoBldr.schedules[e][0]].dayOff=r,B.autoBldr.schedules[e].splice(0,1),B.autoBldr.schedules[e].sort(i)}delete B.autoBldr[d]}(r),B.autoBldr.schedules[r]=[],B.autoBldr.schedules[r]=l(d(e,r)),c(),B.autoBldr.schedules={},B.autoBldr.courses=[],t=B.indexData.schedules.slice(0),a=B.indexData.schedules.length-1;0<=a;a--)!0!==u(B.indexData.schedules[a])&&(delete x[B.indexData.schedules[a]],B.indexData.schedules.splice(a,1));for(a=0;a<B.indexData.schedules.length;a++)B.indexData.schedules[a]!==t[a]&&(Object.defineProperty(x,t[a],Object.getOwnPropertyDescriptor(x,B.indexData.schedules[a])),delete x[B.indexData.schedules[a]]);postMessage(JSON.stringify(x))}(e,r)}(r,t)}()}}();