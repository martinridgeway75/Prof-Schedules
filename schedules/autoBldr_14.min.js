!function(){"use strict";var B,w={},x={},v={};function f(e){for(var r,t=[],a=e.length,n=0;n<a;n++){for(r=n+1;r<a;r++)e[n]===e[r]&&(r=++n);t.push(e[n])}return t}function y(e,r,t){var a,n,d=x[v[e].cRef[t]],s=x[r];return s.hasOwnProperty("allowFollow")?d.hasOwnProperty("allowFollow")?function(e,r,t){for(var a=x[v[e].cRef[t]],n=x[r],d=[[n.dayhr[0][0],n.dayhr[0][1]+1],[n.dayhr[1][0],n.dayhr[1][1]+1]],s=[[a.dayhr[0][0],a.dayhr[0][1]+1],[a.dayhr[1][0],a.dayhr[1][1]+1]],u=0;u<2;u++){if(d[u].identical(a.dayhr[0]))return!0===n.allowFollow[u]&&!1===a.allowFollow[0];if(d[u].identical(a.dayhr[1]))return!0===n.allowFollow[u]&&!1===a.allowFollow[1];if(s[u].identical(n.dayhr[0]))return!0===a.allowFollow[u]&&!1===n.allowFollow[0];if(s[u].identical(n.dayhr[1]))return!0===a.allowFollow[u]&&!1===n.allowFollow[1]}return 1}(e,r,t):(n=[[s.dayhr[0][0],s.dayhr[0][1]+1],[s.dayhr[1][0],s.dayhr[1][1]+1]])[0].identical(d.dayhr[0])||n[1].identical(d.dayhr[1])||n[1].identical(d.dayhr[0])||n[0].identical(d.dayhr[1])?void 0:1:!d.hasOwnProperty("allowFollow")||(a=[[d.dayhr[0][0],d.dayhr[0][1]+1],[d.dayhr[1][0],d.dayhr[1][1]+1]],s.dayhr[0].identical(a[0])||s.dayhr[1].identical(a[1])||s.dayhr[1].identical(a[0])||s.dayhr[0].identical(a[1])?void 0:1)}function g(e){return""===x[e].assgn}function p(e,r){return x[r].dayhr[0][0]!==v[e].dayOff&&x[r].dayhr[1][0]!==v[e].dayOff}function R(e){for(var r,t=0,a=v[e].cRef.length,n=0;n<a;n++)"CLINIC"!==(r=x[v[e].cRef[n]]).cat&&("ninety"===r.duration||"threehour"===r.duration?t+=1.5:t+=1);return 2*t}function O(e){return e>Number(w.settings.maxHrsPerDay)}function m(e,r){var t,a,n,d,s,u,l,o,h,i,c,f,y=(t=0,a=new Array(B).fill(t),JSON.parse(JSON.stringify(new Array(6).fill(a)))),g=!1,p=!1;if(!0===w.settings.overrides.maxSeqHrs)return!0;if("CLINIC"===x[r].cat)return!0;for(d=x[r].dayhr[0][0],s=x[r].dayhr[1][0],u=x[r].dayhr[0][1],l=x[r].dayhr[1][1],f=0;f<v[e].cRef.length;f++)"CLINIC"!==(n=x[v[e].cRef[f]]).cat&&(o=n.dayhr[0][0],h=n.dayhr[1][0],i=n.dayhr[0][1],c=n.dayhr[1][1],d!==o&&d!==h&&s!==o&&s!==h||(y[o][i]+=1,y[h][c]+=1,"threehour"===n.duration&&(y[o][i+1]+=1)));return y[d][u]+=1,y[s][l]+=1,"twohour"===n.duration&&(g=!0),"threehour"===n.duration&&(y[d][u+1]+=1,p=g=!0),function(e,r,t){var a,n,d,s=!0,u=e.length;if(2===w.settings.maxSeqHrs)if(t){for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-2;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]&&a[d+2]===a[d+3]){s=!1;break}}else for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-1;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]){s=!1;break}if(3===w.settings.maxSeqHrs)if(r){for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-3;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]&&a[d+2]===a[d+3]&&a[d+3]===a[d+4]){s=!1;break}}else for(n=0;n<u;n++)for(a=e[n],d=0;d<a.length-2;d++)if(1===a[d]&&a[d]===a[d+1]&&a[d+1]===a[d+2]&&a[d+2]===a[d+3]){s=!1;break}return s}(y,g,p)}function D(e,r){var t=x[r];return!!v[e].hasOwnProperty("isSat")||5!==t.dayhr[0][0]&&5!==t.dayhr[1][0]&&!v[e].hasOwnProperty("isSat")}function b(e,r){var t,a,n,d,s,u,l,o,h,i,c;if(!w.settings.deptGrps.length)return 1;if(!0===w.settings.overrides.deptGrps)return 1;if("CLINIC"===x[r].cat)return 1;for(t=function(e){for(var r,t=[],a=w.settings.deptGrps.length,n=0;n<a;n++)-1!==(r=w.settings.deptGrps[n]).indexOf(e)&&t.push(r);return t}(x[r].dept),a=[],d=v[e].cRef.length,i=0;i<d;i++)"CLINIC"!==(n=x[v[e].cRef[i]]).cat&&("week"===w.settings.deptGrpsSetBy&&a.push(n.dept),"day"===w.settings.deptGrpsSetBy&&(u=n.dayhr[0][0],l=n.dayhr[1][0],o=x[r].dayhr[0][0],h=x[r].dayhr[1][0],u!==o&&u!==h&&l!==o&&l!==h||a.push(n.dept)));for(a.push(x[r].dept),f(a),i=0;i<t.length;i++){for(c=s=0;c<a.length;c++)t[i].includes(a[c])&&s++;if(s===a.length)return 1}}function N(e,r){v[e].cRef.push(r),x[r].assgn=e}function s(e,r){var t,a,n,d,s,u,l,o,h,i,c,f;if(v[e].cRef.length){if(!1!=(d=r,-1===v[e].cRef.indexOf(d))&&!1!==g(r)&&!1!=(s=e,u=r,l=Number(w.settings.maxHours),o=2,!0===w.settings.overrides.maxHours||"CLINIC"===x[u].cat||("ninety"!==x[u].duration&&"threehour"!==x[u].duration||(o=3),R(s)+o<=l))&&!1!==p(e,r)&&!1!==function(e,r){var t,a,n,d,s,u,l,o;if(!0===w.settings.overrides.maxHrsPerDay)return!0;if("CLINIC"===x[r].cat)return!0;for(t=[0,0,0,0,0,0],n=v[e].cRef,d=x[r].dayhr[0][0],s=x[r].dayhr[1][0],o=0;o<n.length;o++)"CLINIC"!==(a=x[n[o]]).cat&&(u=a.dayhr[0][0],l=a.dayhr[1][0],d!==u&&d!==l&&s!==u&&s!==l||(t[u]+=1,t[l]+=1,"threehour"===a.duration&&(t[u]+=1)));return t[d]+=1,t[s]+=1,"threehour"===a.duration&&(t[d]+=1),!t.some(O)}(e,r)&&!1!==m(e,r)&&!1!==D(e,r)){for(t=0,a=v[e].cRef.length,n=0;n<a&&(h=r,i=n,f=c=void 0,c=x[v[e].cRef[i]],f=x[h],!(c.dayhr[0].identical(f.dayhr[0])||c.dayhr[1].identical(f.dayhr[1])||c.dayhr[1].identical(f.dayhr[0])||c.dayhr[0].identical(f.dayhr[1]))&&y(e,r,n)&&function(e,r,t){var a=x[v[e].cRef[t]],n=x[r],d=[];if("threehour"===n.duration){if(d.push(n.dayhr[0][0]),d.push(n.dayhr[0][1]+1),a.dayhr[0].identical(d)||a.dayhr[1].identical(d))return}else if(d.push(a.dayhr[0][0]),d.push(a.dayhr[0][1]+1),"threehour"===a.duration&&(n.dayhr[0].identical(d)||n.dayhr[1].identical(d)))return;return 1}(e,r,n));n++)t++;t===a&&b(e,r)&&N(e,r)}}else g(r)&&p(e,r)&&D(e,r)&&N(e,r)}function o(e,r){if(!v[e].cRef.length)throw new Error("Internal error: Attempted to remove an assignment that was never made: s"+e+", c"+r);var t,a;x[r].assgn===e&&-1!==v[e].cRef.indexOf(r)&&(t=e,x[a=r].assgn="",v[t].cRef.splice(v[t].cRef.indexOf(a),1))}function u(e){var r=R(e),t=!0;return(!v[e].cRef.length||r<w.settings.maxHours-1)&&(t=!1),t}function d(e,r){for(var t,a,n,d,s=[0,0,0,0,0,0],u=w.indexData.courses.length,l=0;l<u;l++)(t=x[w.indexData.courses[l]]).cat===e&&""===t.assgn&&(s[t.dayhr[0][0]]+=1,s[t.dayhr[1][0]]+=1);for(s.pop(),a=s.reduce(function(e,r){return e+r},0),n=Math.ceil(a/w.settings.maxHours),l=0;l<s.length;l++){if(!(0<s[l]))return s.fill(0),s[l]=n,[s,n,r];0<Math.round(a/s[l])?s[l]=a/s[l]:s[l]=0}for(d=s.reduce(function(e,r){return e+r},0),l=0;l<s.length;l++)s[l]=Math.round(s[l]/d*n);return[s,n,r]}function l(e){var r,t,a,n,d=[];if(w.autoBldr.schedules[e[2]].length)for(t=w.autoBldr.schedules[e[2]].length,n=0;n<t;n++)r=w.autoBldr.schedules[e[2]][n],v[r].cRef.length<w.settings.maxHours/2&&d.length<e[1]&&d.push(r);else for(t=w.indexData.schedules.length,n=0;n<t&&(r=w.indexData.schedules[n],d.length<e[1]);n++)v[r].cRef.length||d.push(r);for(n=0;n<d.length;n++)a=e[0].indexOf(e[0].reduce(function(e,r){return Math.max(e,r)})),v[d[n]].dayOff=a,0<e[0][a]&&--e[0][a];return d}function h(e){for(var r,t=e+"done",a=w.autoBldr.schedules[e].length-1;0<=a;a--)if(v[w.autoBldr.schedules[e][a]].cRef.length)if(!0!==u(w.autoBldr.schedules[e][a]))for(r=v[w.autoBldr.schedules[e][a]].cRef.length-1;0<=r;r--)o(w.autoBldr.schedules[e][a],v[w.autoBldr.schedules[e][a]].cRef[r]);else w.autoBldr[t].push(w.autoBldr.schedules[e][a])}function i(e,r){return Number(e.substring(1))-Number(r.substring(1))}function c(){for(var e,r=w.indexData.schedules.length,t=0;t<r;t++)0===(e=v[w.indexData.schedules[t]]).cRef.length&&(e.dayOff=6)}function C(e,r,t){w.autoBldr.courses=[],w.autoBldr.courses=function(e){for(var r,t,a,n=[],d=[],s=e.length,u=0;u<s;u++)t=[],r=x[e[u]],a=Number(r.rm.a.replace(/[^0-9]/g,"")),t.push(e[u],r.dept,r.dayhr[0][1],a),d.push(t);for(d.sort(function(e,r){return e[1].localeCompare(r[1])||e[2]-r[2]||e[3]-r[3]}),u=0;u<d.length;u++)n.push(d[u][0]);return n}(function(e){for(var r,t,a=[],n=w.indexData.courses.length,d=0;d<n;d++)r=w.indexData.courses[d],(t=x[r]).cat===e&&""===t.assgn&&a.push(r);return a}(e)),!0===t&&(h(r),w.autoBldr.schedules[r]=[],w.autoBldr.schedules[r]=l(d(e,r))),function(e){for(var r,t,a=w.autoBldr.schedules[e].length,n=w.autoBldr.courses.length,d=0;d<a;d++)if(!0!==u(r=w.autoBldr.schedules[e][d]))for(t=0;t<n;t++)s(r,w.autoBldr.courses[t])}(r),function(e){var r,t,a,n,d,s=[],u=[],l=w.autoBldr.schedules[e].length;for(n=0;n<l;n++)for(r=w.autoBldr.schedules[e][n],t=v[r],a=0;a<5;a++)if(s=[],t.dayOff!==a){for(d=0;d<t.cRef.length;d++)x[t.cRef[d]].dayhr[0][0]===a&&s.push([t.cRef[d],x[t.cRef[d]].dayhr[0][1]]),x[t.cRef[d]].dayhr[1][0]===a&&s.push([t.cRef[d],x[t.cRef[d]].dayhr[1][1]]);1<s.length&&(s.sort(function(e,r){return e[1]-r[1]}),s[s.length-2][1]<s[s.length-1][1]-3&&u.push(s[s.length-1][0]),s[0][1]<s[1][1]-3&&u.push(s[0][0]))}if((u=f(u)).length)for(n=0;n<u.length;n++)o(x[u[n]].assgn,u[n])}(r)}w.indexData={},w.indexData.schedules=[],w.indexData.courses=[],w.autoBldr={},w.autoBldr.schedules={},w.autoBldr.courses=[],w.settings={},Array.prototype.identical=function(e){var r;if(this.length!==e.length)return!1;for(r=0;r<e.length;r++)if(this[r].identical){if(!this[r].identical(e[r]))return!1}else if(this[r]!==e[r])return!1;return!0},onmessage=function(e){var r,t,a,n=JSON.parse(e.data);for(w.indexData.schedules=n[0],r=w.indexData.schedules.length,a=0;a<r;a++)t=w.indexData.schedules[a],v[t]={},v[t].cRef=[],v[t].dayOff=6;x=n[1],w.indexData.courses=Object.keys(x),w.settings=n[2],B=Number(n[3]),function(){var e=Object.keys(x)[0],r=x[e].cat,t="cat1",a=t+"done";w.hasOwnProperty("autoBldr")||(w.autoBldr={});w.autoBldr.hasOwnProperty("schedules")||(w.autoBldr.schedules={});w.autoBldr.schedules.hasOwnProperty(t)?w.hasOwnProperty("autoBldr")&&w.autoBldr.hasOwnProperty("schedules")&&w.autoBldr.schedules.hasOwnProperty(t)&&(w.autoBldr[a]=[],h(t),w.autoBldr.schedules[t]=[],w.autoBldr.schedules[t]=l(d(r,t))):(w.autoBldr.schedules[t]=[],w.autoBldr.schedules[t]=l(d(r,t)),w.autoBldr[a]=[]);!function(e,r){var t=0,a=+w.autoBldr.schedules[r].length;for(;t!==a;)t=+w.autoBldr.schedules[r].length,function(e,r){C(e,r,!1),C(e,r,!0)}(e,r),a=+w.autoBldr.schedules[r].length;!function(e,r){var t,a;for(h(r),c(),function(e){var r,t,a,n=[],d=e+"done";for(w.autoBldr[d].sort(i),f(w.autoBldr[d]),t=w.autoBldr[d].length-1;0<=t;t--)if(w.autoBldr.schedules[e].length){if(!(Number(w.autoBldr[d][t].substring(1))>Number(w.autoBldr.schedules[e][0].substring(1))))continue;for(a=v[w.autoBldr[d][t]].cRef.length-1;0<=a;a--)n.push(v[w.autoBldr[d][t]].cRef[a]);for(a=v[w.autoBldr[d][t]].cRef.length-1;0<=a;a--)o(w.autoBldr[d][t],v[w.autoBldr[d][t]].cRef[a]);for(w.autoBldr.schedules[e].push(w.autoBldr[d][t]),a=0;a<n.length;a++)s(w.autoBldr.schedules[e][0],n[a]);r=v[w.autoBldr[d][t]].dayOff,v[w.autoBldr.schedules[e][0]].dayOff=r,w.autoBldr.schedules[e].splice(0,1),w.autoBldr.schedules[e].sort(i)}delete w.autoBldr[d]}(r),w.autoBldr.schedules[r]=[],w.autoBldr.schedules[r]=l(d(e,r)),c(),w.autoBldr.schedules={},w.autoBldr.courses=[],t=w.indexData.schedules.slice(0),a=w.indexData.schedules.length-1;0<=a;a--)!0!==u(w.indexData.schedules[a])&&(delete v[w.indexData.schedules[a]],w.indexData.schedules.splice(a,1));for(a=0;a<w.indexData.schedules.length;a++)w.indexData.schedules[a]!==t[a]&&(Object.defineProperty(v,t[a],Object.getOwnPropertyDescriptor(v,w.indexData.schedules[a])),delete v[w.indexData.schedules[a]]);postMessage(JSON.stringify(v))}(e,r)}(r,t)}()}}();